<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">

	<title>Facebook with C++ - SDKBOX</title>
        
        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../../../css/base.css?2" rel="stylesheet">
        <link rel="stylesheet" href="../../../css/highlight.css">
        <link href="../../../css/custom.css" rel="stylesheet">
        

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="http://sdkbox.com"><img src="http://www.cocos2d-x.org/s/sdkbox/SDKBOX_logo.png">Docs</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">

            <ul class="nav navbar-nav navbar-right">


            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../../..">简介</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Cocos <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../cocos/">安装方式</a>
</li>

                        
                            
<li >
    <a href="../../../installer/">命令行工具</a>
</li>

                        
                            
<li >
    <a href="../../../qa/cocos_creator/">Creator集成</a>
</li>

                        
                            
  
  <li class="dropdown-submenu">
    <a tabindex="-1" class="non-link">SDK插件</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../achievement/">Achievements</a>
</li>

        
            
  

        
            
<li >
    <a href="../../adcolony/">AdColony</a>
</li>

        
            
  

        
            
<li >
    <a href="../../admob/">AdMob</a>
</li>

        
            
  

        
            
<li >
    <a href="../../agecheq/">AgeCheq</a>
</li>

        
            
  

        
            
<li >
    <a href="../../appnext/">Appnext</a>
</li>

        
            
  

        
            
<li >
    <a href="../../appodeal/">Appodeal</a>
</li>

        
            
  

        
            
<li >
    <a href="../../amazon/">Amazon</a>
</li>

        
            
  

        
            
<li >
    <a href="../../apteligent/">Apteligent</a>
</li>

        
            
  

        
            
<li >
    <a href="../../bee7/">Bee7</a>
</li>

        
            
  

        
            
<li >
    <a href="../../chartboost/">Chartboost</a>
</li>

        
            
  

        
            
<li >
    <a href="../../ethwallet/">EthWallet</a>
</li>

        
            
<li >
    <a href="../">Facebook</a>
</li>

        
            
  

        
            
<li >
    <a href="../../gameroom/">Facebook Gameroom</a>
</li>

        
            
  

        
            
<li >
    <a href="../../firebase/">Firebase</a>
</li>

        
            
  

        
            
<li >
    <a href="../../flurryanalytics/">Flurry Analytics</a>
</li>

        
            
  

        
            
<li >
    <a href="../../fyber/">Fyber</a>
</li>

        
            
  

        
            
<li >
    <a href="../../googleanalytics/">Google Analytics</a>
</li>

        
            
  

        
            
<li >
    <a href="../../googleplay/">Google Play Game</a>
</li>

        
            
  

        
            
<li >
    <a href="../../hms/">Huawei Mobile Services</a>
</li>

        
            
  

        
            
<li >
    <a href="../../iap/">In-App Purchase</a>
</li>

        
            
  

        
            
<li >
    <a href="../../inmobi/">InMobi</a>
</li>

        
            
  

        
            
<li >
    <a href="../../kochava/">Kochava</a>
</li>

        
            
  

        
            
<li >
    <a href="../../leadbolt/">LeadBolt</a>
</li>

        
            
  

        
            
<li >
    <a href="../../leaderboard/">Leaderboard</a>
</li>

        
            
  

        
            
<li >
    <a href="../../misc/">Misc</a>
</li>

        
            
  

        
            
<li >
    <a href="../../playphone/">Playphone</a>
</li>

        
            
  

        
            
<li >
    <a href="../../review/">Ratings & Reviews</a>
</li>

        
            
  

        
            
<li >
    <a href="../../sdkboxads/">SDKBOX Ads</a>
</li>

        
            
  

        
            
<li >
    <a href="../../sdkboxplay/">SDKBOX Play</a>
</li>

        
            
  

        
            
<li >
    <a href="../../share/">Social Sharing</a>
</li>

        
            
  

        
            
<li >
    <a href="../../signinwithapple/">Sign in with Apple</a>
</li>

        
            
  

        
            
<li >
    <a href="../../tune/">Tune</a>
</li>

        
            
  

        
            
<li >
    <a href="../../unityads/">UnityAds</a>
</li>

        
            
  

        
            
<li >
    <a href="../../valuepotion/">Valuepotion</a>
</li>

        
            
  

        
            
<li >
    <a href="../../vungle/">Vungle</a>
</li>

        
            
  

        
            
<li >
    <a href="../../youtube/">Youtube</a>
</li>

        
            
  

        
    </ul>
  </li>
  

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Unity <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../unity/iap/">In-App Purchase</a>
</li>

                        
                            
<li >
    <a href="../../../unity/review/">Ratings & Reviews</a>
</li>

                        
                            
<li >
    <a href="../../../unity/socialshare/">SocialShare</a>
</li>

                        
                            
<li >
    <a href="../../../unity/googleanalytics/documentation/">Google Analytics</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Unreal <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../unreal/iap/">In-App Purchase</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">LiveOps <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../liveops/">使用介绍</a>
</li>

                        
                            
<li >
    <a href="../../../liveops/remote-config/">远程配置</a>
</li>

                        
                            
<li >
    <a href="../../../liveops/receipt-verification/">服务器端IAP订单校验</a>
</li>

                        
                            
<li >
    <a href="../../../liveops/catalog-management/">即时可购买项目管理</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">指南 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../qa/installgoogleplaystore/">GooglePlay安装指南</a>
</li>

                        
                            
<li >
    <a href="../../../qa/integration-admob-to-creator/">AdMob集成指南</a>
</li>

                        
                            
<li >
    <a href="../../../qa/install_sdkbox/">SDKBox安装</a>
</li>

                        
                            
<li >
    <a href="../../../qa/crypt-sdkbox-config/">保护 sdkbox_config.json</a>
</li>

                        
                            
<li >
    <a href="../../../qa/sdkboxplay_troubleshoot/">SDKBoxPlay相关问题</a>
</li>

                        
                            
<li >
    <a href="../../../qa/iap_troubleshoot/">IAP相关问题</a>
</li>

                        
                            
<li >
    <a href="../../../qa/sdkbox_installer_issue/">Installer相关问题</a>
</li>

                        
                        </ul>
                    </li>
                
                

                <li style="margin-left:30px">
 <a href="http://sdkbox-doc.github.io/en/">English</a>
                </li>
                
                </ul>
            




            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#_1">集成</a></li>
        <li class="main "><a href="#_2">重点注意事项</a></li>
            <li><a href="#_3">禁用应用程序安全传输策略</a></li>
            <li><a href="#bitcode">禁止 Bitcode 支持</a></li>
            <li><a href="#_4">游戏全屏配置</a></li>
            <li><a href="#canopenurl">canOpenURL 白名单</a></li>
        <li class="main "><a href="#faq">FAQ</a></li>
            <li><a href="#_5">额外的步骤</a></li>
            <li><a href="#json">JSON 配置</a></li>
            <li><a href="#_6">~~邀请朋友~~</a></li>
        <li class="main "><a href="#_7">使用</a></li>
            <li><a href="#facebook">初始化 Facebook</a></li>
            <li><a href="#facebook_1">使用 Facebook</a></li>
            <li><a href="#api">图谱API</a></li>
            <li><a href="#facebook_2">Facebook 事件</a></li>
        <li class="main "><a href="#api-reference">API Reference</a></li>
            <li><a href="#methods">Methods</a></li>
            <li><a href="#listeners">Listeners</a></li>
        <li class="main "><a href="#_11">手动集成</a></li>
        <li class="main "><a href="#ios_1">iOS 平台手动集成</a></li>
        <li class="main "><a href="#android_1">Android 平台手动集成</a></li>
            <li><a href="#_12">拷贝文件</a></li>
            <li><a href="#androidmanifestxml">编辑 AndroidManifest.xml</a></li>
            <li><a href="#stringsxml">编辑 strings.xml</a></li>
            <li><a href="#androidmk">编辑 Android.mk</a></li>
            <li><a href="#applicationmk-cocos2d-x-v30-v32">编辑 Application.mk （只限 Cocos2d-x v3.0 到 v3.2 版本）</a></li>
            <li><a href="#appactivityjava">修改 AppActivity.java</a></li>
            <li><a href="#release">混淆 (release模式下可选)</a></li>
        <li class="main "><a href="#facebook_3">Facebook 编译问题</a></li>
            <li><a href="#a">解决方法A</a></li>
            <li><a href="#b">解决方法B</a></li>
        <li class="main "><a href="#facebook_4">Facebook 编译问题</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<p><a href="../">&#8249; Facebook Doc Home</a></p>
<h1>Facebook 集成指南</h1>

<h4><em><b>For the C++ version of cocos2d-x v3.x</b> - (<a href="./../">all other versions</a>)</em></h4>

<h2 id="_1">集成</h2>
<p>用如下命令来集成 SDKBOX Facebook 插件,请确保您可以正常执行的 SDKBOX 安装器.</p>
<pre><code class="bash">sdkbox import facebook
</code></pre>

<!--
## ~~从 China 服务器下载~~ 服务器已停止
如果你在中国, 并且下载插件的速度比较慢, 可以尝试使用位于中国的服务器来下载, 查询插件, 使用方法为在你的 `sdkbox import` 后加 `--server china` 及可, 比如:

<pre><code class="bash">sdkbox import xxx  --server china
</code></pre>

xxx 为你的插件名字
-->

<h2 id="_2">重点注意事项</h2>
<p>如果您升级到了 Xcode7, 则需要以下额外步骤来确保插件工作正常:</p>
<h4 id="_3">禁用应用程序安全传输策略</h4>
<p>添加以下项到 plist:</p>
<pre><code>&lt;key&gt;NSAppTransportSecurity&lt;/key&gt;
&lt;dict&gt;
    &lt;key&gt;NSAllowsArbitraryLoads&lt;/key&gt;
    &lt;true/&gt;
&lt;/dict&gt;
</code></pre>

<p>添加后的文件内容看起来就像这样：</p>
<p><img alt="" src="../../../imgs/ATS.png" /></p>
<h4 id="bitcode">禁止 Bitcode 支持</h4>
<p>您必须禁止 <strong>Bitcode</strong> 的支持，否则将会编译失败。</p>
<h4 id="_4">游戏全屏配置</h4>
<p>如果您的游戏不同时支持横竖屏，则必须在 Xcode 中选中 <code>Requires full screen</code>，否则将不会通过 Apple 的审核。</p>
<h4 id="canopenurl">canOpenURL 白名单</h4>
<p>取决于您使用哪些插件。需要在 <code>info.plist</code> 的 <code>LSApplicationQueriesSchemes</code> 下添加名单。</p>
<!--## Configuration
### SDKBOX Cloud
SDKBOX Cloud enables developers to receive the benefits of a centralized application management interface, by helping to boost their applications with extended functionality. The two main features are: __Remote Application Management__ which provides the abilities of updating and testing, and __IAP Receipt Verification__.

Developers must register at Chukong’s website to get __developers credentials__. After receiving __developers credentials__, developers can register an unlimited number of __applications__. Each __application__ will have an associated __application token__ and a __application secret__. These are used to securely transmit new plugin configurations to the clients as well as grant access to all the remotely accessible services.

### Remote Application Configuration
SDKBOX allows developers to create a __Remote Application Configuration__ for each application they are developing.

Registering the applications’ allows for on-the-fly update of its plugin’s configuration. For example, it will allow the change of the Google Analytics tracking code, switch to a new AdColony campaign or add new in-app purchase products without rebuilding and redeploying your apps to the app stores.

To enable this cloud service in your applications is as easy as calling a single __init()__ function and passing in your __application token__ and __application secret__ that were provided when you created the app in the previous section.

<pre><code>sdkbox::init( &lt;application token&gt;, &lt;application secret&gt; );
</code></pre>

  __Note__: each application will have it’s own __application token__ and each configuration for each game will have it’s own __application secret__. The __application secret__ is the actual encryption key used to decipher the remote configuration.

When the developer updates a __Remote Application Configuration__ the application will automatically pull the new configuration and put it into effect. This means that you can update configuration information on the fly and everyone playing your game will get updated the next time the user starts the application!

To ensure security, during normal execution the new configuration is locally saved in the applications’s private folder, and the next time it restarts it is applied. Also, configurations are cyphered and its contents are not exposed, even if your application runs on a rooted/jailbroken device.
-->

<h2 id="faq">FAQ</h2>
<ol>
<li>切换 Facebook 登录方式，使用应用、浏览器方式登录, <a href="https://support.apple.com/en-us/HT201265">清理 Safari Cookie</a></li>
<li>切换 Facebook 登录账号, <a href="https://support.apple.com/en-us/HT201265">清理 Safari Cookie</a></li>
</ol>
<h3 id="_5">额外的步骤</h3>
<p>下面的步骤假定您已经注册为 Facbbook 开发者，并创建了一个 <strong>APP</strong></p>
<h4 id="ios">iOS的步骤</h4>
<ul>
<li>依<a href="https://developers.facebook.com/quickstarts/?platform=ios">iOS快速指导</a> 来配置您的 <strong>APP</strong></li>
<li>在 <code>AppController.mm</code> 中修改如下代码，不是 <code>AppDelegate.cpp</code> 中</li>
</ul>
<pre><code>- (void)applicationDidBecomeActive:(UIApplication *)application {
  [FBSDKAppEvents activateApp];
}

- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
  // ...

  //
  // **************************
  // !! 非常重要,非常重要,非常重要 !!
  // **************************
  //
  // 在 app-&gt;run() 前调用
  // [[FBSDKApplicationDelegate sharedInstance] application:didFinishLaunchingWithOptions

  [[FBSDKApplicationDelegate sharedInstance] application:application
                                      didFinishLaunchingWithOptions:launchOptions];
  app-&gt;run();
  return YES;
}

- (BOOL)application:(UIApplication *)application
            openURL:(NSURL *)url
            options:(NSDictionary&lt;UIApplicationOpenURLOptionsKey,id&gt; *)options {

  BOOL handled = [[FBSDKApplicationDelegate sharedInstance] application:application
    openURL:url
    sourceApplication:options[UIApplicationOpenURLOptionsSourceApplicationKey]
    annotation:options[UIApplicationOpenURLOptionsAnnotationKey]
  ];
  // Add any custom logic here.
  return handled;
}

- (BOOL)application:(UIApplication *)application
            openURL:(NSURL *)url
  sourceApplication:(NSString *)sourceApplication
         annotation:(id)annotation {

  BOOL handled = [[FBSDKApplicationDelegate sharedInstance] application:application
    openURL:url
    sourceApplication:sourceApplication
    annotation:annotation
  ];
  // Add any custom logic here.
  return handled;
}

</code></pre>

<p>在 Xcode8 iOS10 模拟器上，不能登录：</p>
<pre><code>Go to the `Project Target` and then `Capabilities` and switch `Keychain Sharing ON`.
</code></pre>

<p>http://stackoverflow.com/a/39788102/5443510</p>
<h4 id="android">Android的步骤</h4>
<ul>
<li>确保您的 <code>java -version</code> &gt;= 1.7</li>
<li>依<a href="https://developers.facebook.com/quickstarts/?platform=android">Android快速指导</a> 来配置您的 <strong>APP</strong></li>
<li>在 <code>res/values/strings.xml</code> 中给 <code>facebook_app_id</code> 赋值为您的 <code>Facebook App ID</code></li>
<li>在 <code>AndroidManifest.xml</code> 中给 <code>_replace_with_your_app_id_</code> 赋值为您的 <code>Facebook App ID</code></li>
<li>在 <code>project.properties</code> 中给 target 赋值为 <code>target=android-15</code></li>
</ul>
<h3 id="json">JSON 配置</h3>
<p>SDKBOX 安装器会为您自动生成一个 <code>sdkbox_config.json</code> 配置文件</p>
<p>下面给出一个例子,您可以打开/关闭Facebook的调试模式</p>
<pre><code class="json">&quot;Facebook&quot;:
{
    &quot;debug&quot;:true
}
</code></pre>

<h3 id="_6">~~邀请朋友~~</h3>
<ul>
<li>http://discuss.cocos2d-x.org/t/solved-invite-friends-with-using-cocos2dx-layer/34450</li>
</ul>
<p>https://developers.facebook.com/docs/ios/change-log-4x/</p>
<blockquote>
<p>The App Invites feature has been deprecated. (4.28.0 - November 7, 2017)</p>
</blockquote>
<h2 id="_7">使用</h2>
<h3 id="facebook">初始化 Facebook</h3>
<p>在您的代码合适的地方初始化插件, 我们建议您在 <code>AppDelegate::applicationDidFinishLaunching()</code> 或 <code>AppController:didFinishLaunchingWithOptions()</code> 中完成初始化. 请确保您包含了对应的头文件:</p>
<pre><code class="cpp">#include &quot;PluginFacebook/PluginFacebook.h&quot;
AppDelegate::applicationDidFinishLaunching()
{
     sdkbox::PluginFacebook::init();
}
</code></pre>

<h3 id="facebook_1">使用 Facebook</h3>
<h4 id="_8">登录</h4>
<p>用户在使用前需要登录到 Facebook.</p>
<pre><code class="cpp">sdkbox::PluginFacebook::login();
</code></pre>

<p>用户不想使用 Facebook 时，可以注销.</p>
<pre><code class="cpp">sdkbox::PluginFacebook::logout();
</code></pre>

<p>您可以检查是否已经登录</p>
<pre><code class="cpp">sdkbox::PluginFacebook::isLoggedIn();
</code></pre>

<blockquote>
<p>注意: 用户只需要登录一次, 除非他们注销</p>
</blockquote>
<h4 id="_9">权限</h4>
<p>Facebook 要求您在使用前去询问用户要相应的权限,比如 posting 相关的权益
就有两类权限, <strong>read</strong> and <strong>publish</strong>
您也可以通过<a href="https://developers.facebook.com/docs/facebook-login/permissions/v2.3#reference">这里</a>得到完整的信息</p>
<p>SDKBOX 提供最常用的几种权限:</p>
<ul>
<li>FB_PERM_READ_PUBLIC_PROFILE</li>
<li>FB_PERM_READ_EMAIL</li>
<li>FB_PERM_READ_USER_FRIENDS</li>
<li>FB_PERM_PUBLISH_POST</li>
</ul>
<p>要获取权限,您可以指定您想要权限,比如:</p>
<pre><code class="cpp">sdkbox::PluginFacebook::requestReadPermissions({FB_PERM_READ_PUBLIC_PROFILE, FB_PERM_READ_USER_FRIENDS});
sdkbox::PluginFacebook::requestPublishPermissions({FB_PERM_PUBLISH_POST});
</code></pre>

<h4 id="_10">分享</h4>
<p>提供了两种分享方式.</p>
<ul>
<li><strong>分享</strong> 会自动发布到用户的信息流中
分享联接:</li>
</ul>
<pre><code class="cpp">sdkbox::FBShareInfo info;
info.type  = FB_LINK;
info.link  = &quot;http://www.cocos2d-x.org&quot;;
info.title = &quot;cocos2d-x&quot;;
info.text  = &quot;Best Game Engine&quot;;
info.image = &quot;http://cocos2d-x.org/images/logo.png&quot;;
sdkbox::PluginFacebook::share(info);
</code></pre>

<p>分享图片:</p>
<pre><code class="cpp">sdkbox::FBShareInfo info;
info.type  = FB_PHOTO;
info.title = &quot;My Photo&quot;;
info.image = __path to image__;
sdkbox::PluginFacebook::share(info);
</code></pre>

<ul>
<li><strong>dialog</strong> 会显示一个对话框,让用户可以添加他们自己想说的话:</li>
</ul>
<p>显一个分享对话框:</p>
<pre><code class="cpp">sdkbox::FBShareInfo info;
info.type  = FB_LINK;
info.link  = &quot;http://www.cocos2d-x.org&quot;;
info.title = &quot;cocos2d-x&quot;;
info.text  = &quot;Best Game Engine&quot;;
info.image = &quot;http://cocos2d-x.org/images/logo.png&quot;;
sdkbox::PluginFacebook::dialog(info);
</code></pre>

<p>分享一个带有文字注解的图片:</p>
<pre><code class="cpp">sdkbox::FBShareInfo info;
info.type  = FB_PHOTO;
info.title = &quot;My Photo&quot;;
info.image = __path to image__;
sdkbox::PluginFacebook::dialog(info);
</code></pre>

<blockquote>
<p>注意: 分享带有文字注解的图片需要用户的手机上已安装了 <strong>Facebook</strong> 应用.</p>
</blockquote>
<h3 id="api">图谱API</h3>
<p>您可以通过 <code>api</code> 函数 执行<a href="https://developers.facebook.com/docs/graph-api/overview/">图谱API</a></p>
<p>比如,取好友列表:</p>
<pre><code>sdkbox::PluginFacebook::FBAPIParam params;
sdkbox::PluginFacebook::api(&quot;/me/friendlists&quot;, &quot;GET&quot;, params, &quot;/me/friendlists&quot;);
</code></pre>

<h3 id="facebook_2">Facebook 事件</h3>
<p>您可以接收 <code>Facebook</code> 事件，以对不同事件做不同的处理.</p>
<ul>
<li>让您的类继承 <code>sdkbox::FacebookListener</code> 并重写下面的函数:</li>
</ul>
<pre><code class="cpp">#include &quot;PluginFacebook/PluginFacebook.h&quot;
class MyClass : public sdkbox::FacebookListener
{
private:
  void onLogin(bool isLogin, const std::string&amp; msg);
  void onPermission(bool isLogin, const std::string&amp; msg);
  void onAPI(const std::string&amp; tag, const std::string&amp; jsonData);
  void onSharedSuccess(const std::string&amp; message);
  void onSharedFailed(const std::string&amp; message);
  void onSharedCancel();
};
</code></pre>

<ul>
<li>创建一个 <strong>listener</strong> 监听事件:</li>
</ul>
<pre><code class="cpp">sdkbox::PluginFacebook::setListener(this);
</code></pre>

<h2 id="api-reference">API Reference</h2>
<h3 id="methods">Methods</h3>
<pre><code class="cpp">static void init ( ) ;
</code></pre>

<blockquote>
<p>initialize the plugin instance.</p>
</blockquote>
<pre><code class="cpp">static void setListener ( FacebookListener * listener ) ;
</code></pre>

<blockquote>
<p>Set listener to listen for facebook events</p>
</blockquote>
<pre><code class="cpp">static FacebookListener * getListener ( ) ;
</code></pre>

<blockquote>
<p>Get the listener</p>
</blockquote>
<pre><code class="cpp">static void removeListener ( ) ;
</code></pre>

<blockquote>
<p>Remove the listener, and can't listen to events anymore</p>
</blockquote>
<pre><code class="cpp">static void login ( ) ;
</code></pre>

<blockquote>
<p>log in</p>
</blockquote>
<pre><code class="cpp">static void login ( std::vector &lt;std::string&gt; &amp; permissions ) ;
</code></pre>

<pre><code class="cpp">static void requestReadPermissions ( const std::vector &lt;std::string&gt; &amp; permissions ) ;
</code></pre>

<blockquote>
<p>log in with specific read permissions, conflict with publish permissions
https://developers.facebook.com/docs/facebook-login/permissions</p>
</blockquote>
<pre><code class="cpp">static void requestPublishPermissions ( const std::vector &lt;std::string&gt; &amp; permissions ) ;
</code></pre>

<blockquote>
<p>log in with specific public permissions
https://developers.facebook.com/docs/facebook-login/permissions</p>
</blockquote>
<pre><code class="cpp">static void logout ( ) ;
</code></pre>

<blockquote>
<p>log out</p>
</blockquote>
<pre><code class="cpp">static bool isLoggedIn ( ) ;
</code></pre>

<blockquote>
<p>Check whether the user logined or not</p>
</blockquote>
<pre><code class="cpp">static std::string getUserID ( ) ;
</code></pre>

<blockquote>
<p>get UserID</p>
</blockquote>
<pre><code class="cpp">static std::string getAccessToken ( ) ;
</code></pre>

<blockquote>
<p>get AccessToken</p>
</blockquote>
<pre><code class="cpp">static std::vector &lt;std::string&gt; getPermissionList ( ) ;
</code></pre>

<blockquote>
<p>get permissoin list</p>
</blockquote>
<pre><code class="cpp">static void share ( const FBShareInfo &amp; info ) ;
</code></pre>

<blockquote>
<p>share</p>
</blockquote>
<pre><code class="cpp">static void dialog ( const FBShareInfo &amp; info ) ;
</code></pre>

<blockquote>
<p>open a dialog of Facebook app or WebDialog (dialog with photo only avaible with native Facebook app)</p>
</blockquote>
<pre><code class="cpp">static std::string getSDKVersion ( ) ;
</code></pre>

<blockquote>
<p>return the version of Facebook SDK</p>
</blockquote>
<pre><code class="cpp">static void api ( const std::string &amp; path ,
                  const std::string &amp; method ,
                  const FBAPIParam &amp; params ,
                  const std::string &amp; tag ) ;
</code></pre>

<blockquote>
<p>use Facebook Open Graph api
https://developers.facebook.com/docs/ios/graph</p>
</blockquote>
<pre><code class="cpp">static void fetchFriends ( ) ;
</code></pre>

<blockquote>
<p>fetch friends data from Facebook</p>
</blockquote>
<p>Only friends who has installed the app are returned in API v2.0 and higher of Facebook. The "total_count" in summary represents the total number of friends, including those who haven't installed the app.
https://developers.facebook.com/docs/apps/changelog#v2_0</p>
<pre><code class="cpp">static std::vector &lt;FBGraphUser&gt; getFriends ( ) ;
</code></pre>

<blockquote>
<p>get friends info</p>
</blockquote>
<pre><code class="cpp">static bool canPresentWithFBApp ( const FBShareInfo &amp; info ) ;
</code></pre>

<blockquote>
<p>check whether can present Facebook App</p>
</blockquote>
<pre><code class="cpp">static void requestInvitableFriends ( const FBAPIParam &amp; ) ;
</code></pre>

<blockquote>
<p>Get a vector of invitable friends info which can be used to build a custom friends invite dialog.</p>
</blockquote>
<pre><code class="cpp">static void inviteFriendsWithInviteIds ( const std::vector &lt;std::string&gt; &amp; invite_ids ,
                                         const std::string &amp; title ,
                                         const std::string &amp; invite_text ) ;
</code></pre>

<blockquote>
<p>Invite friends based on the result obtained from a call to <code>requestInvitableFriends</code></p>
</blockquote>
<pre><code class="cpp">static void inviteFriends ( const std::string &amp; app_link_url ,
                            const std::string &amp; preview_image_url ) ;
</code></pre>

<blockquote>
<p>Use the default FB dialog to invite friends.</p>
</blockquote>
<pre><code class="cpp">static void setAppId ( const std::string&amp; appId );
</code></pre>

<blockquote>
<p>Set the Facebook App ID to be used by the FB SDK.</p>
</blockquote>
<pre><code class="cpp">static void setAppURLSchemeSuffix ( const std::string &amp; appURLSchemeSuffix );
</code></pre>

<blockquote>
<p>Set the app url scheme suffix used by the FB SDK.</p>
</blockquote>
<h3 id="listeners">Listeners</h3>
<pre><code class="cpp">void onLogin ( bool isLogin , const std::string &amp; msg );
</code></pre>

<pre><code class="cpp">void onSharedSuccess ( const std::string &amp; message );
</code></pre>

<pre><code class="cpp">void onSharedFailed ( const std::string &amp; message );
</code></pre>

<pre><code class="cpp">void onSharedCancel ( );
</code></pre>

<pre><code class="cpp">void onAPI ( const std::string &amp; key , const std::string &amp; jsonData );
</code></pre>

<pre><code class="cpp">void onPermission ( bool isLogin , const std::string &amp; msg );
</code></pre>

<pre><code class="cpp">void onFetchFriends ( bool ok , const std::string &amp; msg );
</code></pre>

<pre><code class="cpp">void onRequestInvitableFriends ( const FBInvitableFriendsInfo &amp; friends );
</code></pre>

<pre><code class="cpp">void onInviteFriendsWithInviteIdsResult ( bool result ,
                                          const std::string &amp; msg );
</code></pre>

<pre><code class="cpp">void onInviteFriendsResult ( bool result , const std::string &amp; msg );
</code></pre>

<pre><code class="cpp">void onGetUserInfo ( const FBGraphUser &amp; userInfo );
</code></pre>

<h2 id="_11">手动集成</h2>
<p>如果 <em>SDKBOX 安装器</em> 安装插件失败了，那么需要手动集成插件.如果安装器安装插件成功了,那么不需要，也没必要,按文档再手动集成一次.</p>
<p>下面列出的的步骤一般很少用到.如果你按下面的步骤完成了集成，请在完成集成后，再按步骤检查一次.</p>
<h2 id="ios_1">iOS 平台手动集成</h2>
<p>拖拽下列 framework 从 <code>Facebook</code> 插件包的 <strong>plugins/ios</strong> 目录到您的 Xcode 工程中，在添加 frameworks 的时候，请勾选 <code>Copy items if needed</code> 。</p>
<blockquote>
<p>sdkbox.framework</p>
<p>PluginFacebook.framework</p>
</blockquote>
<p>上面的 frameworks 依赖于大量其他 frameworks。如果您没有添加它们，您也需要添加下列这些 frameworks：</p>
<blockquote>
<p>Security.framework</p>
</blockquote>
<h2 id="android_1">Android 平台手动集成</h2>
<h3 id="_12">拷贝文件</h3>
<p>从插件安装包中的 <code>plugin/android/libs</code> 目录拷贝下列 <strong>jar</strong> 文件到您的工程的 <strong>proj.android/libs</strong> 目录。</p>
<blockquote>
<p>PluginFacebook.jar</p>
<p>sdkbox.jar</p>
</blockquote>
<ul>
<li>
<p>如果你使用 cocos2d-x 源码，拷贝 <strong>jar</strong> 文件到：</p>
<p>Android command-line:
<code>cocos2d/cocos/platform/android/java/libs</code></p>
<p>Android Studio:
<code>cocos2d/cocos/platform/android/libcocos2dx/libs</code></p>
</li>
<li>
<p>如果你使用 cocos2d-js 或者 lua ，拷贝 <strong>jar</strong> 文件到:</p>
<p>Android command-line:
<code>frameworks/cocos2d-x/cocos/platform/android/java/libs</code></p>
<p>Android Studio:
<code>frameworks/cocos2d-x/cocos/platform/android/libcocos2dx/libs</code></p>
</li>
<li>
<p>如果你使用 cocos2d-x 预编译包，拷贝 <strong>jar</strong> 文件到：</p>
<p>Android command-line:
<code>proj.android/libs</code></p>
</li>
</ul>
<p>从 <code>plugin/android/jni</code> 目录拷贝 <code>pluginfacebook</code> 以及 <code>sdkbox</code> 目录到您的工程的 <code>proj.android/jni</code> 目录。如果 <code>sdkbox</code> 目录在工程中已经存在，请覆盖它。</p>
<p>从 <code>plugin/android/libs</code> 拷贝 <code>facebook_lib</code> 目录到您的 <code>proj.android/libs/</code> 目录。</p>
<h3 id="androidmanifestxml">编辑 <code>AndroidManifest.xml</code></h3>
<p>在标签 <strong>application tag</strong> 上添加下列权限：</p>
<pre><code class="xml">  &lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;
</code></pre>

<p>还有一些必要的元数据标签需要添加：</p>
<pre><code class="xml">&lt;meta-data android:name=&quot;com.facebook.sdk.ApplicationId&quot; android:value=&quot;@string/facebook_app_id&quot;/&gt;
&lt;activity android:name=&quot;com.facebook.FacebookActivity&quot;
  android:configChanges=
         &quot;keyboard|keyboardHidden|screenLayout|screenSize|orientation&quot;
  android:theme=&quot;@android:style/Theme.Translucent.NoTitleBar&quot;
  android:label=&quot;@string/app_name&quot; /&gt;

  &lt;provider android:authorities=&quot;com.facebook.app.FacebookContentProvider__replace_with_your_app_id__&quot;
  android:name=&quot;com.facebook.FacebookContentProvider&quot;
  android:exported=&quot;true&quot; /&gt;
</code></pre>

<h3 id="stringsxml">编辑 strings.xml</h3>
<p>打开 <code>res/values/strings.xml</code>，添加一个新的名为 <code>facebook_app_id</code> 的字串，其值是您的 Facebook App ID。比如：</p>
<p><code>xml
    &lt;?xml version="1.0" encoding="utf-8"?&gt;
    &lt;resources&gt;
        &lt;string name="app_name"&gt;facebook&lt;/string&gt;
        &lt;string name="facebook_app_id"&gt;280194012150923&lt;/string&gt;
    &lt;/resources&gt;</code></p>
<h3 id="androidmk">编辑 <code>Android.mk</code></h3>
<p>编辑 <code>proj.android/jni/Android.mk</code>：</p>
<p>为 <strong>LOCAL_STATIC_LIBRARIES</strong> 添加额外的库：</p>
<pre><code>LOCAL_STATIC_LIBRARIES += PluginFacebook
LOCAL_STATIC_LIBRARIES += sdkbox
</code></pre>

<p>在所有 <strong>import-module</strong> 语句之前添加一条 call 语句：</p>
<pre><code>$(call import-add-path,$(LOCAL_PATH))
</code></pre>

<p>在最后添加额外的 <strong>import-module</strong> 语句：</p>
<pre><code>$(call import-module, ./sdkbox)
$(call import-module, ./pluginfacebook)
</code></pre>

<p>这意味着您的语句顺序看起来像是这样：</p>
<pre><code>$(call import-add-path,$(LOCAL_PATH))
$(call import-module, ./sdkbox)
$(call import-module, ./pluginfacebook)
</code></pre>

<p><strong>Note:</strong> 如果您使用的是 cocos2d-x 预编译库，那么保证这些语句在已有的 <code>$(call import-module,./prebuilt-mk)</code> 语句之上非常重要。</p>
<h3 id="applicationmk-cocos2d-x-v30-v32">编辑 <code>Application.mk</code> （只限 Cocos2d-x v3.0 到 v3.2 版本）</h3>
<p>编辑 <code>proj.android/jni/Application.mk</code> 保证 <strong>APP_STL</strong> 的定义正确。如果 <code>Application.mk</code> 包含了 <code>APP_STL := c++_static</code> 语句，那么这条语句应该被改为：</p>
<pre><code>APP_STL := gnustl_static
</code></pre>

<h3 id="appactivityjava">修改 <code>AppActivity.java</code></h3>
<h4 id="2403">插件版本 &gt;= 2.4.0.3</h4>
<ol>
<li>找到 <strong>AppActivity.java</strong> 文件</li>
</ol>
<pre><code class="bash">find . -name &quot;AppActivity.java&quot;
</code></pre>

<ol>
<li>把 <code>extends Cocos2dxActivity</code> 替换为 <code>extends com.sdkbox.plugin.SDKBoxActivity</code></li>
</ol>
<p>以下是 <strong>AppActivity.java</strong> 不同版本的引擎所在的目录：</p>
<pre><code>cpp
  - proj.android/src/org/cocos2dx/cpp/AppActivity.java
  - proj.android-studio/app/src/org/cocos2dx/cpp/AppActivity.java
  - proj.android/app/src/org/cocos2dx/cpp/AppActivity.java ( from cocos2d-x 3.17)

lua
  - frameworks/runtime-src/proj.android/src/org/cocos2dx/lua/AppActivity.java
  - frameworks/runtime-src/proj.android-studio/app/src/org/cocos2dx/lua/AppActivity.java
  - frameworks/runtime-src/proj.android/app/src/org/cocos2dx/lua/AppActivity.java (from cocos2d-x 3.17)

js
  - frameworks/runtime-src/proj.android/src/org/cocos2dx/javascript/AppActivity.java
  - frameworks/runtime-src/proj.android/app/src/org/cocos2dx/javascript/AppActivity.java ( from cocos2d-x 3.17)
</code></pre>

<h4 id="2403_1">插件版本 &lt; 2.4.0.3</h4>
<ul>
<li>
<p>如果您使用 cocos2d-x 源代码，假设您在 <code>proj.android</code> 目录下，那么您可以在如下位置找到 <code>Cocos2dxActivity.java</code> 文件：</p>
<p><code>../../cocos2d-x/cocos/platform/android/java/src/org/cocos2dx/
lib/Cocos2dxActivity.java</code></p>
</li>
<li>
<p>如果您使用 cocos2dx-x 预编译库， 假设您在 <code>proj.android</code> 目录下，那么您可以在如下位置找到 <code>Cocos2dxActivity.java</code> 文件：</p>
<p><code>./src/org/cocos2dx/lib/Cocos2dxActivity.java</code></p>
</li>
</ul>
<p><strong>Note:</strong> 当你使用 cocos2d-x 源代码时，不同的版本中 <code>Cocos2dxActivity.java</code> 文件的位置也不同。一个确定该文件位置的方法是查看 <code>proj.android/project.properties</code> 。比如：</p>
<pre><code>android.library.reference.1=../../cocos2d-x/cocos/platform/android/java
</code></pre>

<p>在这个例子中， <code>Cocos2dxActivity.java</code> 文件应该在如下位置：</p>
<pre><code>../../cocos2d-x/cocos/platform/android/java/src/org/cocos2dx/lib/Cocos2dxActivity.java
</code></pre>

<ul>
<li>修改 <code>Cocos2dxActivity.java</code> 文件，导入如下包：</li>
</ul>
<pre><code class="java">import android.content.Intent;
import com.sdkbox.plugin.SDKBox;
</code></pre>

<ul>
<li>然后，修改 <code>Cocos2dxActivity</code> 类的 <code>onCreate(final Bundle savedInstanceState)</code> 函数，添加一个调用语句 <code>SDKBox.init(this);</code> 。添加的位置非常重要，必须在调用 <code>onLoadNativeLibraries();</code> 之后。如下：</li>
</ul>
<pre><code class="java">onLoadNativeLibraries();
SDKBox.init(this);
</code></pre>

<ul>
<li>
<p>最后, 我需要提供合适的 <strong>overrides</strong> 方法的代码。这里有一些约定如下。</p>
<ul>
<li>
<p>如果这个被列出的方法没有在 <code>SDKBox</code> 中定义，那么__定义它__。</p>
</li>
<li>
<p>如果这个被列出的方法已经被定义在 <code>SDKBox</code> 中，那么请调用这个在 <code>SDKBox</code> 中的__同名方法__。</p>
</li>
</ul>
</li>
</ul>
<pre><code class="java">    @Override
    protected void onActivityResult(int requestCode, int resultCode, Intent data) {
          if(!SDKBox.onActivityResult(requestCode, resultCode, data)) {
            super.onActivityResult(requestCode, resultCode, data);
          }
    }
    @Override
    protected void onStart() {
          super.onStart();
          SDKBox.onStart();
    }
    @Override
    protected void onStop() {
          super.onStop();
          SDKBox.onStop();
    }
    @Override
    protected void onResume() {
          super.onResume();
          SDKBox.onResume();
    }
    @Override
    protected void onPause() {
          super.onPause();
          SDKBox.onPause();
    }
    @Override
    public void onBackPressed() {
          if(!SDKBox.onBackPressed()) {
            super.onBackPressed();
          }
    }
</code></pre>

<h3 id="release">混淆 (release模式下可选)</h3>
<ul>
<li>编辑 <code>project.properties</code> 指定 <code>Proguard</code> 到一个配置文件. 比如:</li>
</ul>
<pre><code>proguard.config=proguard.cfg
</code></pre>

<ul>
<li>编辑这个配置文件,包含以下内容:</li>
</ul>
<pre><code>-libraryjars libs/facebook_lib/libs/android-support-v4.jar

-keep class * extends java.util.ListResourceBundle {
    protected Object[][] getContents();
}
</code></pre>

<p><strong>注意:</strong> 混淆只在 <strong>Release</strong> 模式下有效 (比如 <code>cocos run -m release</code>), 在 debug 模式下,不会调到混淆规则.</p>
<h2 id="facebook_3">Facebook 编译问题</h2>
<p>目前 SDKBox 使用的是 Facebook iOS SDK 7.1.1 的静态库.</p>
<p>Facebook iOS SDK 7.1.1 的静态库与 <code>Other Linker Flags</code> -&gt; <code>-ObjC</code> 存在冲突.</p>
<p>如果编译遇到以下类似错误, 那很有可能是冲突引起的</p>
<pre><code class="html">Could not find or use auto-linked library 'swiftCompatibilityDynamicReplacements'
Could not find or use auto-linked library 'swiftCore'
Could not find or use auto-linked library 'swiftQuartzCore'
Could not find or use auto-linked library 'swiftDispatch'
Could not find or use auto-linked library 'swiftAVFoundation'
Could not find or use auto-linked library 'swiftCoreMedia'
Could not find or use auto-linked library 'swiftCoreAudio'
Could not find or use auto-linked library 'swiftPhotos'
Could not find or use auto-linked library 'swiftCoreMIDI'
Could not find or use auto-linked library 'swiftCoreLocation'
Undefined symbol: protocol descriptor for Foundation._ErrorCodeProtocol
Undefined symbol: associated conformance descriptor for Foundation._ErrorCodeProtocol._ErrorType: Foundation._BridgedStoredNSError
Undefined symbol: base conformance descriptor for Foundation._BridgedStoredNSError: Foundation.CustomNSError
Undefined symbol: base conformance descriptor for Foundation._BridgedStoredNSError: Swift.Hashable
Undefined symbol: base conformance descriptor for Foundation._ErrorCodeProtocol: Swift.Equatable
Undefined symbol: associated conformance descriptor for Foundation._BridgedStoredNSError.Code: Foundation._ErrorCodeProtocol
Undefined symbol: associated conformance descriptor for Foundation._BridgedStoredNSError.Code: Swift.RawRepresentable
Undefined symbol: method descriptor for Foundation._BridgedStoredNSError.init(_nsError: __C.NSError) -&gt; A
Undefined symbol: base conformance descriptor for Foundation.CustomNSError: Swift.Error
Undefined symbol: method descriptor for static Foundation.CustomNSError.errorDomain.getter : Swift.String
Undefined symbol: method descriptor for Foundation._ObjectiveCBridgeableError.init(_bridgedNSError: __shared __C.NSError) -&gt; A?
Undefined symbol: method descriptor for Swift.Error._code.getter : Swift.Int
Undefined symbol: method descriptor for Swift.Error._userInfo.getter : Swift.AnyObject?
Undefined symbol: method descriptor for Swift.Error._getEmbeddedNSError() -&gt; Swift.AnyObject?
Undefined symbol: protocol conformance descriptor for Swift.Int : Swift.FixedWidthInteger in Swift
Undefined symbol: type metadata for Swift.Int
Undefined symbol: protocol descriptor for Foundation.CustomNSError
Undefined symbol: static Swift._DictionaryStorage.allocate(capacity: Swift.Int) -&gt; Swift._DictionaryStorage&lt;A, B&gt;
Undefined symbol: __swiftEmptyDictionarySingleton
</code></pre>

<h3 id="a">解决方法A</h3>
<ul>
<li>去掉 <code>Project Setting</code> -&gt; <code>Build Settings</code> -&gt; <code>Linking</code> -&gt; <code>Other Linker Flags</code> -&gt; <code>-ObjC</code> 就可以解决这些错误</li>
</ul>
<h3 id="b">解决方法B</h3>
<ol>
<li>
<p>如果你的工程不能去掉 <code>-ObjC</code> , 那你需要将 Facebook 静态库替换为<a href="https://github.com/facebook/facebook-ios-sdk/releases/download/v7.1.1/FacebookSDK_Dynamic.framework.zip">动态库</a></p>
</li>
<li>
<p>解压并替换工程中的 Facebook 相关的文件 <code>FBSDK*.framework</code> 文件.</p>
</li>
<li>
<p>调整 Xcode 设置, <code>Project Setting</code> -&gt; <code>General</code> -&gt; <code>Frameworks, Libraries, and Embedded Content</code> 下的 <code>FBSDK*.framework</code> 设置为 <code>Embed &amp; Sign</code></p>
</li>
</ol>
<h2 id="facebook_4">Facebook 编译问题</h2>
<p>如果编译遇到以下类似错误</p>
<pre><code class="html">dyld: Library not loaded: @rpath/libswiftCore.dylib
</code></pre>

<p>可以尝试这个方法, 调整 Xcode 设置, <code>Project</code> -&gt; <code>target</code> -&gt; <code>Build Setting/All</code> -&gt; <code>Always Embed Swift Standard Libraries</code> 设置为 <code>YES</code></p></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Build Date UTC : 2020-12-07 01:56:48, Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        
        <script src="../../../js/jquery-1.10.2.min.js"></script>
        <script src="../../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../../js/highlight.pack.js"></script>
        <script>var base_url = '../../..';</script>
        <script src="../../../js/base.js"></script>
        


        
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-70044300-2', 'auto');
            ga('send', 'pageview');
        </script>
        
    </body>
</html>
