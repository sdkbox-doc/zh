<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">

	<title>Tune with Lua - SDKBOX</title>
        
        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../../../css/base.css?2" rel="stylesheet">
        <link rel="stylesheet" href="../../../css/highlight.css">
        <link href="../../../css/custom.css" rel="stylesheet">
        

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="http://sdkbox.com"><img src="http://www.cocos2d-x.org/s/sdkbox/SDKBOX_logo.png">Docs</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">

            <ul class="nav navbar-nav navbar-right">


            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../../..">简介</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Cocos <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../cocos/">安装方式</a>
</li>

                        
                            
<li >
    <a href="../../../installer/">命令行工具</a>
</li>

                        
                            
<li >
    <a href="../../../qa/cocos_creator/">Creator集成</a>
</li>

                        
                            
  
  <li class="dropdown-submenu">
    <a tabindex="-1" class="non-link">SDK插件</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../achievement/">Achievements</a>
</li>

        
            
  

        
            
<li >
    <a href="../../adcolony/">AdColony</a>
</li>

        
            
  

        
            
<li >
    <a href="../../admob/">AdMob</a>
</li>

        
            
  

        
            
<li >
    <a href="../../agecheq/">AgeCheq</a>
</li>

        
            
  

        
            
<li >
    <a href="../../appnext/">Appnext</a>
</li>

        
            
  

        
            
<li >
    <a href="../../appodeal/">Appodeal</a>
</li>

        
            
  

        
            
<li >
    <a href="../../amazon/">Amazon</a>
</li>

        
            
  

        
            
<li >
    <a href="../../apteligent/">Apteligent</a>
</li>

        
            
  

        
            
<li >
    <a href="../../bee7/">Bee7</a>
</li>

        
            
  

        
            
<li >
    <a href="../../chartboost/">Chartboost</a>
</li>

        
            
  

        
            
<li >
    <a href="../../ethwallet/">EthWallet</a>
</li>

        
            
<li >
    <a href="../../facebook/">Facebook</a>
</li>

        
            
  

        
            
<li >
    <a href="../../gameroom/">Facebook Gameroom</a>
</li>

        
            
  

        
            
<li >
    <a href="../../firebase/">Firebase</a>
</li>

        
            
  

        
            
<li >
    <a href="../../flurryanalytics/">Flurry Analytics</a>
</li>

        
            
  

        
            
<li >
    <a href="../../fyber/">Fyber</a>
</li>

        
            
  

        
            
<li >
    <a href="../../googleanalytics/">Google Analytics</a>
</li>

        
            
  

        
            
<li >
    <a href="../../googleplay/">Google Play Game</a>
</li>

        
            
  

        
            
<li >
    <a href="../../iap/">In-App Purchase</a>
</li>

        
            
  

        
            
<li >
    <a href="../../inmobi/">InMobi</a>
</li>

        
            
  

        
            
<li >
    <a href="../../kochava/">Kochava</a>
</li>

        
            
  

        
            
<li >
    <a href="../../leadbolt/">LeadBolt</a>
</li>

        
            
  

        
            
<li >
    <a href="../../leaderboard/">Leaderboard</a>
</li>

        
            
  

        
            
<li >
    <a href="../../misc/">Misc</a>
</li>

        
            
  

        
            
<li >
    <a href="../../playphone/">Playphone</a>
</li>

        
            
  

        
            
<li >
    <a href="../../review/">Ratings & Reviews</a>
</li>

        
            
  

        
            
<li >
    <a href="../../sdkboxads/">SDKBOX Ads</a>
</li>

        
            
  

        
            
<li >
    <a href="../../sdkboxplay/">SDKBOX Play</a>
</li>

        
            
  

        
            
<li >
    <a href="../../share/">Social Sharing</a>
</li>

        
            
  

        
            
<li >
    <a href="../">Tune</a>
</li>

        
            
  

        
            
<li >
    <a href="../../unityads/">UnityAds</a>
</li>

        
            
  

        
            
<li >
    <a href="../../valuepotion/">Valuepotion</a>
</li>

        
            
  

        
            
<li >
    <a href="../../vungle/">Vungle</a>
</li>

        
            
  

        
            
<li >
    <a href="../../youtube/">Youtube</a>
</li>

        
            
  

        
    </ul>
  </li>
  

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Unity <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../unity/iap/">In-App Purchase</a>
</li>

                        
                            
<li >
    <a href="../../../unity/review/">Ratings & Reviews</a>
</li>

                        
                            
<li >
    <a href="../../../unity/socialshare/">SocialShare</a>
</li>

                        
                            
<li >
    <a href="../../../unity/googleanalytics/documentation/">Google Analytics</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Unreal <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../unreal/iap/">In-App Purchase</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">LiveOps <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../liveops/">使用介绍</a>
</li>

                        
                            
<li >
    <a href="../../../liveops/remote-config/">远程配置</a>
</li>

                        
                            
<li >
    <a href="../../../liveops/receipt-verification/">服务器端IAP订单校验</a>
</li>

                        
                            
<li >
    <a href="../../../liveops/catalog-management/">即时可购买项目管理</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">指南 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../qa/installgoogleplaystore/">GooglePlay安装指南</a>
</li>

                        
                            
<li >
    <a href="../../../qa/integration-admob-to-creator/">AdMob集成指南</a>
</li>

                        
                            
<li >
    <a href="../../../qa/sdkbox-for-create-usage/">SDKBoxGUI For Creator介绍</a>
</li>

                        
                            
<li >
    <a href="../../../qa/crypt-sdkbox-config/">保护 sdkbox_config.json</a>
</li>

                        
                            
<li >
    <a href="../../../qa/sdkboxplay_troubleshoot/">SDKBoxPlay相关问题</a>
</li>

                        
                            
<li >
    <a href="../../../qa/iap_troubleshoot/">IAP相关问题</a>
</li>

                        
                            
<li >
    <a href="../../../qa/sdkbox_installer_issue/">Installer相关问题</a>
</li>

                        
                        </ul>
                    </li>
                
                

                <li style="margin-left:30px">
 <a href="http://sdkbox-doc.github.io/en/">English</a>
                </li>
                
                </ul>
            




            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#_1">集成</a></li>
        
    
        <li class="main "><a href="#china">~~从 China 服务器下载~~ 服务器已停止</a></li>
        
    
        <li class="main "><a href="#_2">重点注意事项</a></li>
        
            <li><a href="#_3">禁用应用程序安全传输策略</a></li>
        
            <li><a href="#bitcode">禁止 Bitcode 支持</a></li>
        
            <li><a href="#_4">游戏全屏配置</a></li>
        
            <li><a href="#canopenurl">canOpenURL 白名单</a></li>
        
            <li><a href="#json">JSON 配置</a></li>
        
    
        <li class="main "><a href="#_5">使用</a></li>
        
            <li><a href="#lua">修改 Lua 代码</a></li>
        
            <li><a href="#tune">初始化 Tune</a></li>
        
            <li><a href="#tune_1">使用 Tune</a></li>
        
            <li><a href="#tune_2">捕捉 Tune 事件（可选）</a></li>
        
    
        <li class="main "><a href="#api-reference">API Reference</a></li>
        
            <li><a href="#methods">Methods</a></li>
        
            <li><a href="#listeners">Listeners</a></li>
        
    
        <li class="main "><a href="#_6">手动集成</a></li>
        
    
        <li class="main "><a href="#ios">iOS 平台手动集成</a></li>
        
    
        <li class="main "><a href="#android">Android 平台手动集成</a></li>
        
            <li><a href="#_7">拷贝文件</a></li>
        
            <li><a href="#androidmanifestxml">编辑 AndroidManifest.xml</a></li>
        
            <li><a href="#androidmk">编辑 Android.mk</a></li>
        
            <li><a href="#applicationmk-cocos2d-x-v30-v32">编辑 Application.mk （只限 Cocos2d-x v3.0 到 v3.2 版本）</a></li>
        
            <li><a href="#appactivityjava">修改 AppActivity.java</a></li>
        
            <li><a href="#proguard-release">使用 Proguard （release模式下可选）</a></li>
        
            <li><a href="#appactivityjava_1">修改 AppActivity.java</a></li>
        
            <li><a href="#proguard-release_1">使用 Proguard （release模式下可选）</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<p><a href="../">&#8249; Tune Doc Home</a></p>
<h1>Tune 集成指南</h1>

<h4><em><b>For the Lua version of cocos2d-x v3.x</b> - (<a href="./../">all other versions</a>)</em></h4>

<h2 id="_1">集成</h2>
<p>在您确保正确安装了 SDKBOX installer 的情况下，运行下面的命令来集成 SDKBOX Tune 插件。</p>
<pre><code class="bash">sdkbox import tune
</code></pre>

<h2 id="china">~~从 China 服务器下载~~ 服务器已停止</h2>
<p>如果你在中国, 并且下载插件的速度比较慢, 可以尝试使用位于中国的服务器来下载, 查询插件, 使用方法为在你的 <code>sdkbox import</code> 后加 <code>--server china</code> 及可, 比如:</p>
<pre><code class="bash">sdkbox import xxx  --server china
</code></pre>

<p>xxx 为你的插件名字</p>
<h2 id="_2">重点注意事项</h2>
<p>如果您升级到了 Xcode7, 则需要以下额外步骤来确保插件工作正常:</p>
<h4 id="_3">禁用应用程序安全传输策略</h4>
<p>添加以下项到 plist:</p>
<pre><code>&lt;key&gt;NSAppTransportSecurity&lt;/key&gt;
&lt;dict&gt;
    &lt;key&gt;NSAllowsArbitraryLoads&lt;/key&gt;
    &lt;true/&gt;
&lt;/dict&gt;
</code></pre>

<p>添加后的文件内容看起来就像这样：</p>
<p><img alt="" src="../../../imgs/ATS.png" /></p>
<h4 id="bitcode">禁止 Bitcode 支持</h4>
<p>您必须禁止 <strong>Bitcode</strong> 的支持，否则将会编译失败。</p>
<h4 id="_4">游戏全屏配置</h4>
<p>如果您的游戏不同时支持横竖屏，则必须在 Xcode 中选中 <code>Requires full screen</code>，否则将不会通过 Apple 的审核。</p>
<h4 id="canopenurl">canOpenURL 白名单</h4>
<p>取决于您使用哪些插件。需要在 <code>info.plist</code> 的 <code>LSApplicationQueriesSchemes</code> 下添加名单。</p>
<!--## Configuration
### SDKBOX Cloud
SDKBOX Cloud enables developers to receive the benefits of a centralized application management interface, by helping to boost their applications with extended functionality. The two main features are: __Remote Application Management__ which provides the abilities of updating and testing, and __IAP Receipt Verification__.

Developers must register at Chukong’s website to get __developers credentials__. After receiving __developers credentials__, developers can register an unlimited number of __applications__. Each __application__ will have an associated __application token__ and a __application secret__. These are used to securely transmit new plugin configurations to the clients as well as grant access to all the remotely accessible services.

### Remote Application Configuration
SDKBOX allows developers to create a __Remote Application Configuration__ for each application they are developing.

Registering the applications’ allows for on-the-fly update of its plugin’s configuration. For example, it will allow the change of the Google Analytics tracking code, switch to a new AdColony campaign or add new in-app purchase products without rebuilding and redeploying your apps to the app stores.

To enable this cloud service in your applications is as easy as calling a single __init()__ function and passing in your __application token__ and __application secret__ that were provided when you created the app in the previous section.

wzxhzdk:3

  __Note__: each application will have it’s own __application token__ and each configuration for each game will have it’s own __application secret__. The __application secret__ is the actual encryption key used to decipher the remote configuration.

When the developer updates a __Remote Application Configuration__ the application will automatically pull the new configuration and put it into effect. This means that you can update configuration information on the fly and everyone playing your game will get updated the next time the user starts the application!

To ensure security, during normal execution the new configuration is locally saved in the applications’s private folder, and the next time it restarts it is applied. Also, configurations are cyphered and its contents are not exposed, even if your application runs on a rooted/jailbroken device.
-->

<h3 id="json">JSON 配置</h3>
<p>SDKBOX Installer 将会自动在您的 <code>sdkbox_config.json</code> 中插入一份配置样例。请修改这份配置样例，使其能用于您自己的 app 。</p>
<p>对于一个 Tune 插件的配置样例，您需要将其中的 <code>&lt;TUNE id&gt;</code> 以及 <code>&lt;TUNE KEY&gt;</code> 替换成您特定的 <a href="http://vungle.com"><strong>Tune ID</strong></a> 帐号中的信息。
如下是一个添加 <code>Tune</code> 插件的配置样例：</p>
<pre><code class="json">&quot;Tune&quot;:{
    &quot;id&quot;:&quot;&lt;TUNE ID&gt;&quot;,
    &quot;key&quot;:&quot;&lt;TUNE KEY&gt;&quot;,
    &quot;debug&quot;:false
}
</code></pre>

<h2 id="_5">使用</h2>
<h3 id="lua">修改 Lua 代码</h3>
<p>修改 <code>./frameworks/runtime-src/Classes/lua_module_register.h</code> 文件，包含必要的头文件并且注册 <code>Tune</code> 的 Lua_State。
<strong>Note:</strong> 请注意该注册函数需要一个 <strong>lua_State*</strong> 参数。</p>
<pre><code class="cpp">#include &quot;PluginTuneLua.hpp&quot;
#include &quot;PluginTuneLuaHelper.h&quot;
</code></pre>

<pre><code class="cpp">static int lua_module_register(lua_State* L)
{
  register_all_PluginTuneLua(L);
  register_all_PluginTuneLua_helper(L);
}
</code></pre>

<h3 id="tune">初始化 Tune</h3>
<ul>
<li>修改您的 Lua 代码， 调用 <code>init()</code> 初始化插件。初始化可以放在代码的任何位置，但是，必须在使用插件功能之前完成。</li>
</ul>
<pre><code class="cpp">sdkbox.PluginTune:init()
</code></pre>

<h3 id="tune_1">使用 Tune</h3>
<p>在初始化之后，您可以开始使用 Tune 插件的功能了。Tune 使用 <strong>events</strong> 这个概念（就像 <strong>MAT Native Event Types</strong>一样）。您可以在您需要的地方将 <strong>events</strong> 记入日志，并且在稍后通过基于 web 的报告阅读器查看它们。Tune 在文档中为这些 events 提供一种结构。举例如下：</p>
<pre><code class="lua">sdkbox.PluginTune:measureEventName(&quot;login&quot;)
sdkbox.PluginTune:measureEventId(0123456789)

local event = {}
event.eventName = &quot;purchase&quot;
event.refId = &quot;RJ1357&quot;
event.searchString = &quot;sweet srisp red apples&quot;
event.attribute1 = &quot;srisp&quot;
event.attribute2 = &quot;red&quot;
event.quantity = 3
sdkbox.PluginTune:measureEventForScript(json.encode(event))
</code></pre>

<h3 id="tune_2">捕捉 Tune 事件（可选）</h3>
<p>您可以捕捉 <code>Tune</code> 事件，根据响应来执行操作。一个简单的例子如下：</p>
<pre><code class="lua">sdkbox.PluginTune:setListener(function(eventName, eventData, timeout)
        -- 当eventName为 &quot;onReceiveDeeplink&quot; 时,第三个参数timeout才有效
        print(eventName, eventData)
    end)
</code></pre>

<h2 id="api-reference">API Reference</h2>
<h3 id="methods">Methods</h3>
<pre><code class="lua">sdkbox.PluginTune:setListener(listener)
</code></pre>

<blockquote>
<p>set a listener to listen for event changes.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:init()
</code></pre>

<blockquote>
<p>init the instance.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:setDebugMode(enable)
</code></pre>

<blockquote>
<p>Specifies that the server responses should include debug information.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:setAllowDuplicateRequests(allow)
</code></pre>

<blockquote>
<p>Set to YES to allow duplicate requests to be registered with the MAT server.</p>
</blockquote>
<pre><code class="lua">-- use checkForDeferredDeepLink()
sdkbox.PluginTune:checkForDeferredDeeplinkWithTimeout(timeout)
</code></pre>

<blockquote>
<p>Check for a deferred deeplink entry point upon app installation.
This is safe to call at every app launch, since the function does nothing
unless this is the first launch.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:checkForDeferredDeepLink()
</code></pre>

<blockquote>
<p>Check for a deferred deeplink entry point upon app installation.
This is safe to call at every app launch, since the function does nothing
unless this is the first launch.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:automateIapEventMeasurement(automate)
</code></pre>

<blockquote>
<p>Enable automatic measurement of app store in-app-purchase events. When enabled, your code
should not explicitly measure events for successful purchases related to StoreKit to avoid event duplication.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:setFacebookEventLogging(logging, limit)
</code></pre>

<blockquote>
<p>Set whether the MAT events should also be logged to the Facebook SDK. This flag is ignored
if the Facebook SDK is not present.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:setExistingUser(existingUser)
</code></pre>

<blockquote>
<p>Set whether this is an existing user or a new one. This is generally used to
distinguish users who were using previous versions of the app, prior to
integration of the MAT SDK. The default is to assume a new user.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:setAppleAdvertisingIdentifier(appleAdvertisingIdentifier,
                                                 adTrackingEnabled)
</code></pre>

<blockquote>
<p>Set the Apple Advertising Identifier available in iOS 6.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:setAppleVendorIdentifier(appleVendorIdentifier)
</code></pre>

<blockquote>
<p>Set the Apple Vendor Identifier available in iOS 6.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:setCurrencyCode(currencyCode)
</code></pre>

<blockquote>
<p>Sets the currency code.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:setJailbroken(jailbroken)
</code></pre>

<blockquote>
<p>Sets the jailbroken device flag.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:setPackageName(packageName)
</code></pre>

<blockquote>
<p>Sets the package name (bundle identifier).
Defaults to the Bundle Identifier of the app that is running the sdk.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:setShouldAutoDetectJailbroken(autoDetect)
</code></pre>

<blockquote>
<p>Specifies if the sdk should auto detect if the iOS device is jailbroken.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:setShouldAutoGenerateAppleVendorIdentifier(autoGenerate)
</code></pre>

<blockquote>
<p>Specifies if the sdk should pull the Apple Vendor Identifier from the device.
Note that setting to false will clear any previously set value for the property.</p>
</blockquote>
<pre><code class="lua">-- use setPackageName()
sdkbox.PluginTune:setSiteId(siteId)
</code></pre>

<blockquote>
<p>Sets the site ID.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:setTRUSTeId(tpid)
</code></pre>

<blockquote>
<p>Set the TRUSTe Trusted Preference Identifier (TPID).</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:setUserEmail(userEmail)
</code></pre>

<blockquote>
<p>Sets the user's email address.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:setUserId(userId)
</code></pre>

<blockquote>
<p>Sets the user ID.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:setUserName(userName)
</code></pre>

<blockquote>
<p>Sets the user's name.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:setPhoneNumber(phoneNumber)
</code></pre>

<blockquote>
<p>Sets the user's phone number.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:setFacebookUserId(facebookUserId)
</code></pre>

<blockquote>
<p>Set user's Facebook ID.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:setTwitterUserId(twitterUserId)
</code></pre>

<blockquote>
<p>Set user's Twitter ID.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:setGoogleUserId(googleUserId)
</code></pre>

<blockquote>
<p>Set user's Google ID.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:setAge(userAge)
</code></pre>

<blockquote>
<p>Sets the user's age.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:setGender(userGender)
</code></pre>

<blockquote>
<p>Sets the user's gender.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:setLatitude(latitude, longitude)
</code></pre>

<blockquote>
<p>Sets the user's location.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:setLatitude(latitude, longitude, altitude)
</code></pre>

<blockquote>
<p>Sets the user's location including altitude.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:setAppAdTracking(enable)
</code></pre>

<blockquote>
<p>Set app-level ad-tracking.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:setPayingUser(isPayingUser)
</code></pre>

<blockquote>
<p>Set whether the user is generating revenue for the app or not.
If measureEvent is called with a non-zero revenue, this is automatically set to YES.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:setPreloadData(preloadData)
</code></pre>

<blockquote>
<p>Sets publisher information for attribution.</p>
</blockquote>
<pre><code class="lua">-- use tuneId()
sdkbox.PluginTune:matId()
</code></pre>

<blockquote>
<p>Get the MAT ID for this installation (mat_id).</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:tuneId()
</code></pre>

<blockquote>
<p>Get the Tune ID for this installation.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:openLogId()
</code></pre>

<blockquote>
<p>Get the MAT log ID for the first app open (open_log_id).</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:isPayingUser()
</code></pre>

<blockquote>
<p>Get whether the user is revenue-generating.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:measureSession()
</code></pre>

<blockquote>
<p>To be called when an app opens; typically in the AppDelegate::applicationWillEnterForeground() event.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:measureEventName(eventName)
</code></pre>

<blockquote>
<p>Record an event for an Event Name.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:measureEventId(eventId)
</code></pre>

<blockquote>
<p>Record an event by providing the equivalent Event ID defined on the MobileAppTracking dashboard.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:measureEvent(event)
</code></pre>

<blockquote>
<p>Record an event with a MATEvent.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:setUseCookieTracking(enable)
</code></pre>

<blockquote>
<p>Sets whether or not to use cookie based tracking.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:setRedirectUrl(redirectUrl)
</code></pre>

<blockquote>
<p>Sets a url to be used with app-to-app tracking so that
the sdk can open the download (redirect) url. This is
used in conjunction with the setTracking:advertiserId:offerId:publisherId:redirect: method.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:startAppToAppTracking(targetAppPackageName,
                                         targetAppAdvertiserId,
                                         targetAdvertiserOfferId,
                                         targetAdvertiserPublisherId,
                                         shouldRedirect)
</code></pre>

<blockquote>
<p>Start an app-to-app tracking session on the MAT server.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:applicationDidOpenURL(urlString, sourceApplication)
</code></pre>

<blockquote>
<p>Record the URL and Source when an application is opened via a URL scheme.
This typically occurs during OAUTH or when an app exits and is returned
to via a URL. The data will be sent to the HasOffers server when the next
measureXXX method is called so that a Re-Engagement can be recorded.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginTune:setDeepLink(deepLinkUrl)
</code></pre>

<blockquote>
<p>Record the URL and Source when an application is opened via a URL scheme.</p>
</blockquote>
<h3 id="listeners">Listeners</h3>
<pre><code class="lua">onEnqueuedAction(referenceId)
</code></pre>

<pre><code class="lua">onSucceed(data)
</code></pre>

<pre><code class="lua">onFailed(errorString)
</code></pre>

<pre><code class="lua">onReceiveDeeplink(deeplink, timeout)
</code></pre>

<pre><code class="lua">onMobileAppTrackerDidFailDeeplinkWithError(errorString)
</code></pre>

<h2 id="_6">手动集成</h2>
<p>如果 <em>SDKBOX 安装器</em> 安装插件失败了，那么需要手动集成插件.如果安装器安装插件成功了,那么不需要，也没必要,按文档再手动集成一次.</p>
<p>下面列出的的步骤一般很少用到.如果你按下面的步骤完成了集成，请在完成集成后，再按步骤检查一次.</p>
<h2 id="ios">iOS 平台手动集成</h2>
<p>拖拽下列 framework 从 <code>Tune</code> 插件包的 <strong>plugins/ios</strong> 目录到您的 Xcode 工程中，在添加 frameworks 的时候，请勾选 <code>Copy items if needed</code> 。</p>
<blockquote>
<p>sdkbox.framework</p>
<p>PluginTune.framework</p>
<p>MobileAppTracker.framework</p>
</blockquote>
<p>上面的 frameworks 依赖于其他 frameworks。如果您没有添加它们，您也需要添加下列这些系统 frameworks：</p>
<blockquote>
<p>CoreTelephony.framework</p>
<p>Security.framework</p>
<p>SystemConfiguration.framework</p>
<p>AdSupport.framework</p>
<p>iAd.framework</p>
<p>MobileCoreServices.framework</p>
<p>StoreKit.framework</p>
</blockquote>
<p>把 <code>plugin/luabindings</code> 文件夹中所有的头文件和源文件都拷贝到你的工程的 <code>Classes</code> 文件夹中.</p>
<p>把刚刚拷贝的文件拖动到 Xcode 中或使用 <strong>File -&gt; Add files to...</strong> 来添加.</p>
<h2 id="android">Android 平台手动集成</h2>
<h3 id="_7">拷贝文件</h3>
<p>从插件安装包中的 <code>plugin/android/libs</code> 目录拷贝下列 <strong>jar</strong> 文件到您的工程的 <strong>proj.android/libs</strong> 目录。</p>
<blockquote>
<p>PluginTune.jar</p>
<p>sdkbox.jar</p>
<p>MobileAppTracker-3.9.jar</p>
</blockquote>
<ul>
<li>
<p>如果你使用 cocos2d-x 源码，拷贝 <strong>jar</strong> 文件到：</p>
<p>Android command-line:
<code>cocos2d/cocos/platform/android/java/libs</code></p>
<p>Android Studio:
<code>cocos2d/cocos/platform/android/libcocos2dx/libs</code></p>
</li>
<li>
<p>如果你使用 cocos2d-js 或者 lua ，拷贝 <strong>jar</strong> 文件到:</p>
<p>Android command-line:
<code>frameworks/cocos2d-x/cocos/platform/android/java/libs</code></p>
<p>Android Studio:
<code>frameworks/cocos2d-x/cocos/platform/android/libcocos2dx/libs</code></p>
</li>
<li>
<p>如果你使用 cocos2d-x 预编译包，拷贝 <strong>jar</strong> 文件到：</p>
<p>Android command-line:
<code>proj.android/libs</code></p>
</li>
</ul>
<p>从 <code>plugin/android/jni</code> 目录拷贝 <code>plugintune</code> 以及 <code>sdkbox</code> 目录到您的工程的 <code>proj.android/jni</code> 目录。如果 <code>sdkbox</code> 目录在工程中已经存在，请覆盖它。</p>
<h3 id="androidmanifestxml">编辑 <code>AndroidManifest.xml</code></h3>
<p>在标签 <strong>application tag</strong> 上添加下列权限：</p>
<pre><code class="xml">&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot;/&gt;
&lt;uses-permission android:name=&quot;android.permission.ACCESS_NETWORK_STATE&quot;/&gt;
</code></pre>

<p>使 <strong>hardware acceleration</strong> 属性生效。这一标签是一个在新版本 sdk 上的选项，不能用于2.3.3版本。</p>
<pre><code class="xml">&lt;android:hardwareAccelerated=&quot;true&quot; /&gt;
</code></pre>

<p><strong>application tag</strong> 也需要被创建：</p>
<pre><code class="xml">&lt;application ... &gt;
    &lt;receiver android:name=&quot;com.mobileapptracker.Tracker&quot;&gt;
        &lt;intent-filter&gt;
            &lt;action android:name=&quot;com.android.vending.INSTALL_REFERRER&quot; /&gt;
        &lt;/intent-filter&gt;
    &lt;/receiver&gt;
    &lt;meta-data android:name=&quot;com.google.android.gms.version&quot;
               android:value=&quot;@integer/google_play_services_version&quot; /&gt;
&lt;/application&gt;
</code></pre>

<h3 id="androidmk">编辑 <code>Android.mk</code></h3>
<p>编辑 <code>proj.android/jni/Android.mk</code>：</p>
<p>为 <strong>LOCAL_STATIC_LIBRARIES</strong> 添加额外的库：</p>
<pre><code>LOCAL_STATIC_LIBRARIES += PluginTune
LOCAL_STATIC_LIBRARIES += sdkbox
</code></pre>

<p>在所有 <strong>import-module</strong> 语句之前添加一条 call 语句：</p>
<pre><code>$(call import-add-path,$(LOCAL_PATH))
</code></pre>

<p>在最后添加额外的 <strong>import-module</strong> 语句：</p>
<pre><code>$(call import-module, ./sdkbox)
$(call import-module, ./plugintune)
</code></pre>

<p>这意味着您的语句顺序看起来像是这样：</p>
<pre><code>$(call import-add-path,$(LOCAL_PATH))
$(call import-module, ./sdkbox)
$(call import-module, ./plugintune)
</code></pre>

<p><strong>Note:</strong> 如果您使用的是 cocos2d-x 预编译库，那么保证这些语句在已有的 <code>$(call import-module,./prebuilt-mk)</code> 语句之上非常重要。</p>
<h3 id="applicationmk-cocos2d-x-v30-v32">编辑 <code>Application.mk</code> （只限 Cocos2d-x v3.0 到 v3.2 版本）</h3>
<p>编辑 <code>proj.android/jni/Application.mk</code> 保证 <strong>APP_STL</strong> 的定义正确。如果 <code>Application.mk</code> 包含了 <code>APP_STL := c++_static</code> 语句，那么这条语句应该被改为：</p>
<pre><code>APP_STL := gnustl_static
</code></pre>

<p>把 <code>plugin/luabindings</code> 文件夹中所有的头文件和源文件都拷贝到你的工程的 <code>Classes</code> 文件夹中.</p>
<p>把你刚刚拷贝的 <code>.cpp</code> 文件添加到 <code>Android.mk</code> 文件的的 <strong>LOCAL_SRC_FILES</strong> 项.比如</p>
<pre><code>LOCAL_SRC_FILES := hellocpp/main.cpp \
                ../../Classes/AppDelegate.cpp \
                ../../Classes/HelloWorldScene.cpp \
                                ../../Classes/NewSourceFile.cpp
</code></pre>

<h3 id="appactivityjava">修改 <code>AppActivity.java</code></h3>
<h4 id="2403">插件版本 &gt;= 2.4.0.3</h4>
<ol>
<li>找到 <strong>AppActivity.java</strong> 文件</li>
</ol>
<pre><code class="bash">find . -name &quot;AppActivity.java&quot;
</code></pre>

<ol>
<li>把 <code>extends Cocos2dxActivity</code> 替换为 <code>extends com.sdkbox.plugin.SDKBoxActivity</code></li>
</ol>
<p>以下是 <strong>AppActivity.java</strong> 不同版本的引擎所在的目录：</p>
<pre><code>cpp
  - proj.android/src/org/cocos2dx/cpp/AppActivity.java
  - proj.android-studio/app/src/org/cocos2dx/cpp/AppActivity.java
  - proj.android/app/src/org/cocos2dx/cpp/AppActivity.java ( from cocos2d-x 3.17)

lua
  - frameworks/runtime-src/proj.android/src/org/cocos2dx/lua/AppActivity.java
  - frameworks/runtime-src/proj.android-studio/app/src/org/cocos2dx/lua/AppActivity.java
  - frameworks/runtime-src/proj.android/app/src/org/cocos2dx/lua/AppActivity.java (from cocos2d-x 3.17)

js
  - frameworks/runtime-src/proj.android/src/org/cocos2dx/javascript/AppActivity.java
  - frameworks/runtime-src/proj.android/app/src/org/cocos2dx/javascript/AppActivity.java ( from cocos2d-x 3.17)
</code></pre>

<h4 id="2403_1">插件版本 &lt; 2.4.0.3</h4>
<ul>
<li>
<p>如果您使用 cocos2d-x 源代码，假设您在 <code>proj.android</code> 目录下，那么您可以在如下位置找到 <code>Cocos2dxActivity.java</code> 文件：</p>
<p><code>../../cocos2d-x/cocos/platform/android/java/src/org/cocos2dx/
lib/Cocos2dxActivity.java</code></p>
</li>
<li>
<p>如果您使用 cocos2dx-x 预编译库， 假设您在 <code>proj.android</code> 目录下，那么您可以在如下位置找到 <code>Cocos2dxActivity.java</code> 文件：</p>
<p><code>./src/org/cocos2dx/lib/Cocos2dxActivity.java</code></p>
</li>
</ul>
<p><strong>Note:</strong> 当你使用 cocos2d-x 源代码时，不同的版本中 <code>Cocos2dxActivity.java</code> 文件的位置也不同。一个确定该文件位置的方法是查看 <code>proj.android/project.properties</code> 。比如：</p>
<pre><code>android.library.reference.1=../../cocos2d-x/cocos/platform/android/java
</code></pre>

<p>在这个例子中， <code>Cocos2dxActivity.java</code> 文件应该在如下位置：</p>
<pre><code>../../cocos2d-x/cocos/platform/android/java/src/org/cocos2dx/lib/Cocos2dxActivity.java
</code></pre>

<ul>
<li>修改 <code>Cocos2dxActivity.java</code> 文件，导入如下包：</li>
</ul>
<pre><code class="java">import android.content.Intent;
import com.sdkbox.plugin.SDKBox;
</code></pre>

<ul>
<li>然后，修改 <code>Cocos2dxActivity</code> 类的 <code>onCreate(final Bundle savedInstanceState)</code> 函数，添加一个调用语句 <code>SDKBox.init(this);</code> 。添加的位置非常重要，必须在调用 <code>onLoadNativeLibraries();</code> 之后。如下：</li>
</ul>
<pre><code class="java">onLoadNativeLibraries();
SDKBox.init(this);
</code></pre>

<ul>
<li>
<p>最后, 我需要提供合适的 <strong>overrides</strong> 方法的代码。这里有一些约定如下。</p>
<ul>
<li>
<p>如果这个被列出的方法没有在 <code>SDKBox</code> 中定义，那么<strong>定义它</strong>。</p>
</li>
<li>
<p>如果这个被列出的方法已经被定义在 <code>SDKBox</code> 中，那么请调用这个在 <code>SDKBox</code> 中的<strong>同名方法</strong>。</p>
</li>
</ul>
</li>
</ul>
<pre><code class="java">    @Override
    protected void onActivityResult(int requestCode, int resultCode, Intent data) {
          if(!SDKBox.onActivityResult(requestCode, resultCode, data)) {
            super.onActivityResult(requestCode, resultCode, data);
          }
    }
    @Override
    protected void onStart() {
          super.onStart();
          SDKBox.onStart();
    }
    @Override
    protected void onStop() {
          super.onStop();
          SDKBox.onStop();
    }
    @Override
    protected void onResume() {
          super.onResume();
          SDKBox.onResume();
    }
    @Override
    protected void onPause() {
          super.onPause();
          SDKBox.onPause();
    }
    @Override
    public void onBackPressed() {
          if(!SDKBox.onBackPressed()) {
            super.onBackPressed();
          }
    }
</code></pre>

<h3 id="proguard-release">使用 Proguard （release模式下可选）</h3>
<ul>
<li>编辑 <code>project.properties</code> 文件， 指定一个 <code>Proguard</code> 配置文件。比如：</li>
</ul>
<pre><code>proguard.config=proguard.cfg
</code></pre>

<ul>
<li>编辑这个配置文件，加入如下内容：</li>
</ul>
<pre><code>-keep public class com.mobileapptracker.** {
    public *;
}

-keep class * extends java.util.ListResourceBundle {
    protected Object[][] getContents();
}

-keep public class com.google.android.gms.common.internal.safeparcel.SafeParcelable {
    public static final *** NULL;
}

-keepnames @com.google.android.gms.common.annotation.KeepName class *
-keepclassmembernames class * {
    @com.google.android.gms.common.annotation.KeepName *;
}

-keepnames class * implements android.os.Parcelable {
    public static final ** CREATOR;
}
</code></pre>

<p><strong>Note:</strong> Proguard 只能工作在 <strong>Release</strong> 模式下 （比如： <code>cocos run -m release</code>） debug 模式下不会触发 Proguard。</p>
<h3 id="appactivityjava_1">修改 <code>AppActivity.java</code></h3>
<h4 id="2403_2">插件版本 &gt;= 2.4.0.3</h4>
<ol>
<li>找到 <strong>AppActivity.java</strong> 文件</li>
</ol>
<pre><code class="bash">find . -name &quot;AppActivity.java&quot;
</code></pre>

<ol>
<li>把 <code>extends Cocos2dxActivity</code> 替换为 <code>extends com.sdkbox.plugin.SDKBoxActivity</code></li>
</ol>
<p>以下是 <strong>AppActivity.java</strong> 不同版本的引擎所在的目录：</p>
<pre><code>cpp
  - proj.android/src/org/cocos2dx/cpp/AppActivity.java
  - proj.android-studio/app/src/org/cocos2dx/cpp/AppActivity.java
  - proj.android/app/src/org/cocos2dx/cpp/AppActivity.java ( from cocos2d-x 3.17)

lua
  - frameworks/runtime-src/proj.android/src/org/cocos2dx/lua/AppActivity.java
  - frameworks/runtime-src/proj.android-studio/app/src/org/cocos2dx/lua/AppActivity.java
  - frameworks/runtime-src/proj.android/app/src/org/cocos2dx/lua/AppActivity.java (from cocos2d-x 3.17)

js
  - frameworks/runtime-src/proj.android/src/org/cocos2dx/javascript/AppActivity.java
  - frameworks/runtime-src/proj.android/app/src/org/cocos2dx/javascript/AppActivity.java ( from cocos2d-x 3.17)
</code></pre>

<h4 id="2403_3">插件版本 &lt; 2.4.0.3</h4>
<ul>
<li>
<p>如果您使用 cocos2d-x 源代码，假设您在 <code>proj.android</code> 目录下，那么您可以在如下位置找到 <code>Cocos2dxActivity.java</code> 文件：</p>
<p><code>../../cocos2d-x/cocos/platform/android/java/src/org/cocos2dx/
lib/Cocos2dxActivity.java</code></p>
</li>
<li>
<p>如果您使用 cocos2dx-x 预编译库， 假设您在 <code>proj.android</code> 目录下，那么您可以在如下位置找到 <code>Cocos2dxActivity.java</code> 文件：</p>
<p><code>./src/org/cocos2dx/lib/Cocos2dxActivity.java</code></p>
</li>
</ul>
<p><strong>Note:</strong> 当你使用 cocos2d-x 源代码时，不同的版本中 <code>Cocos2dxActivity.java</code> 文件的位置也不同。一个确定该文件位置的方法是查看 <code>proj.android/project.properties</code> 。比如：</p>
<pre><code>android.library.reference.1=../../cocos2d-x/cocos/platform/android/java
</code></pre>

<p>在这个例子中， <code>Cocos2dxActivity.java</code> 文件应该在如下位置：</p>
<pre><code>../../cocos2d-x/cocos/platform/android/java/src/org/cocos2dx/lib/Cocos2dxActivity.java
</code></pre>

<ul>
<li>修改 <code>Cocos2dxActivity.java</code> 文件，导入如下包：</li>
</ul>
<pre><code class="java">import android.content.Intent;
import com.sdkbox.plugin.SDKBox;
</code></pre>

<ul>
<li>然后，修改 <code>Cocos2dxActivity</code> 类的 <code>onCreate(final Bundle savedInstanceState)</code> 函数，添加一个调用语句 <code>SDKBox.init(this);</code> 。添加的位置非常重要，必须在调用 <code>onLoadNativeLibraries();</code> 之后。如下：</li>
</ul>
<pre><code class="java">onLoadNativeLibraries();
SDKBox.init(this);
</code></pre>

<ul>
<li>
<p>最后, 我需要提供合适的 <strong>overrides</strong> 方法的代码。这里有一些约定如下。</p>
<ul>
<li>
<p>如果这个被列出的方法没有在 <code>SDKBox</code> 中定义，那么<strong>定义它</strong>。</p>
</li>
<li>
<p>如果这个被列出的方法已经被定义在 <code>SDKBox</code> 中，那么请调用这个在 <code>SDKBox</code> 中的<strong>同名方法</strong>。</p>
</li>
</ul>
</li>
</ul>
<pre><code class="java">    @Override
    protected void onActivityResult(int requestCode, int resultCode, Intent data) {
          if(!SDKBox.onActivityResult(requestCode, resultCode, data)) {
            super.onActivityResult(requestCode, resultCode, data);
          }
    }
    @Override
    protected void onStart() {
          super.onStart();
          SDKBox.onStart();
    }
    @Override
    protected void onStop() {
          super.onStop();
          SDKBox.onStop();
    }
    @Override
    protected void onResume() {
          super.onResume();
          SDKBox.onResume();
    }
    @Override
    protected void onPause() {
          super.onPause();
          SDKBox.onPause();
    }
    @Override
    public void onBackPressed() {
          if(!SDKBox.onBackPressed()) {
            super.onBackPressed();
          }
    }
</code></pre>

<h3 id="proguard-release_1">使用 Proguard （release模式下可选）</h3>
<ul>
<li>编辑 <code>project.properties</code> 文件， 指定一个 <code>Proguard</code> 配置文件。比如：</li>
</ul>
<pre><code>proguard.config=proguard.cfg
</code></pre>

<ul>
<li>编辑这个配置文件，加入如下内容：</li>
</ul>
<pre><code>-keep public class com.mobileapptracker.** {
    public *;
}

-keep class * extends java.util.ListResourceBundle {
    protected Object[][] getContents();
}

-keep public class com.google.android.gms.common.internal.safeparcel.SafeParcelable {
    public static final *** NULL;
}

-keepnames @com.google.android.gms.common.annotation.KeepName class *
-keepclassmembernames class * {
    @com.google.android.gms.common.annotation.KeepName *;
}

-keepnames class * implements android.os.Parcelable {
    public static final ** CREATOR;
}
</code></pre>

<p><strong>Note:</strong> Proguard 只能工作在 <strong>Release</strong> 模式下 （比如： <code>cocos run -m release</code>） debug 模式下不会触发 Proguard。</p></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Build Date UTC : 2019-08-14 14:31:43.556261, Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        
        <script src="../../../js/jquery-1.10.2.min.js"></script>
        <script src="../../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../../js/highlight.pack.js"></script>
        <script>var base_url = '../../..';</script>
        <script src="../../../js/base.js"></script>
        


        
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-70044300-2', 'auto');
            ga('send', 'pageview');
        </script>
        
    </body>
</html>
