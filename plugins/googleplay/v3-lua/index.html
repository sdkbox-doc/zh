<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">

	<title>Google Play Game with Lua - SDKBOX</title>
        
        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../../../css/base.css?2" rel="stylesheet">
        <link rel="stylesheet" href="../../../css/highlight.css">
        <link href="../../../css/custom.css" rel="stylesheet">
        

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="http://sdkbox.com"><img src="http://www.cocos2d-x.org/s/sdkbox/SDKBOX_logo.png">Docs</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">

            <ul class="nav navbar-nav navbar-right">


            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../../..">简介</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Cocos <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../cocos/">安装方式</a>
</li>

                        
                            
<li >
    <a href="../../../installer/">命令行工具</a>
</li>

                        
                            
<li >
    <a href="../../../qa/cocos_creator/">Creator集成</a>
</li>

                        
                            
  
  <li class="dropdown-submenu">
    <a tabindex="-1" class="non-link">SDK插件</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../achievement/">Achievements</a>
</li>

        
            
  

        
            
<li >
    <a href="../../adcolony/">AdColony</a>
</li>

        
            
  

        
            
<li >
    <a href="../../admob/">AdMob</a>
</li>

        
            
  

        
            
<li >
    <a href="../../agecheq/">AgeCheq</a>
</li>

        
            
  

        
            
<li >
    <a href="../../appnext/">Appnext</a>
</li>

        
            
  

        
            
<li >
    <a href="../../appodeal/">Appodeal</a>
</li>

        
            
  

        
            
<li >
    <a href="../../amazon/">Amazon</a>
</li>

        
            
  

        
            
<li >
    <a href="../../apteligent/">Apteligent</a>
</li>

        
            
  

        
            
<li >
    <a href="../../bee7/">Bee7</a>
</li>

        
            
  

        
            
<li >
    <a href="../../chartboost/">Chartboost</a>
</li>

        
            
  

        
            
<li >
    <a href="../../ethwallet/">EthWallet</a>
</li>

        
            
<li >
    <a href="../../facebook/">Facebook</a>
</li>

        
            
  

        
            
<li >
    <a href="../../gameroom/">Facebook Gameroom</a>
</li>

        
            
  

        
            
<li >
    <a href="../../firebase/">Firebase</a>
</li>

        
            
  

        
            
<li >
    <a href="../../flurryanalytics/">Flurry Analytics</a>
</li>

        
            
  

        
            
<li >
    <a href="../../fyber/">Fyber</a>
</li>

        
            
  

        
            
<li >
    <a href="../../googleanalytics/">Google Analytics</a>
</li>

        
            
  

        
            
<li >
    <a href="../">Google Play Game</a>
</li>

        
            
  

        
            
<li >
    <a href="../../hms/">Huawei Mobile Services</a>
</li>

        
            
  

        
            
<li >
    <a href="../../iap/">In-App Purchase</a>
</li>

        
            
  

        
            
<li >
    <a href="../../inmobi/">InMobi</a>
</li>

        
            
  

        
            
<li >
    <a href="../../kochava/">Kochava</a>
</li>

        
            
  

        
            
<li >
    <a href="../../leadbolt/">LeadBolt</a>
</li>

        
            
  

        
            
<li >
    <a href="../../leaderboard/">Leaderboard</a>
</li>

        
            
  

        
            
<li >
    <a href="../../misc/">Misc</a>
</li>

        
            
  

        
            
<li >
    <a href="../../playphone/">Playphone</a>
</li>

        
            
  

        
            
<li >
    <a href="../../review/">Ratings & Reviews</a>
</li>

        
            
  

        
            
<li >
    <a href="../../sdkboxads/">SDKBOX Ads</a>
</li>

        
            
  

        
            
<li >
    <a href="../../sdkboxplay/">SDKBOX Play</a>
</li>

        
            
  

        
            
<li >
    <a href="../../share/">Social Sharing</a>
</li>

        
            
  

        
            
<li >
    <a href="../../signinwithapple/">Sign in with Apple</a>
</li>

        
            
  

        
            
<li >
    <a href="../../tune/">Tune</a>
</li>

        
            
  

        
            
<li >
    <a href="../../unityads/">UnityAds</a>
</li>

        
            
  

        
            
<li >
    <a href="../../valuepotion/">Valuepotion</a>
</li>

        
            
  

        
            
<li >
    <a href="../../vungle/">Vungle</a>
</li>

        
            
  

        
            
<li >
    <a href="../../youtube/">Youtube</a>
</li>

        
            
  

        
    </ul>
  </li>
  

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Unity <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../unity/iap/">In-App Purchase</a>
</li>

                        
                            
<li >
    <a href="../../../unity/review/">Ratings & Reviews</a>
</li>

                        
                            
<li >
    <a href="../../../unity/socialshare/">SocialShare</a>
</li>

                        
                            
<li >
    <a href="../../../unity/googleanalytics/documentation/">Google Analytics</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Unreal <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../unreal/iap/">In-App Purchase</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">LiveOps <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../liveops/">使用介绍</a>
</li>

                        
                            
<li >
    <a href="../../../liveops/remote-config/">远程配置</a>
</li>

                        
                            
<li >
    <a href="../../../liveops/receipt-verification/">服务器端IAP订单校验</a>
</li>

                        
                            
<li >
    <a href="../../../liveops/catalog-management/">即时可购买项目管理</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">指南 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../qa/installgoogleplaystore/">GooglePlay安装指南</a>
</li>

                        
                            
<li >
    <a href="../../../qa/integration-admob-to-creator/">AdMob集成指南</a>
</li>

                        
                            
<li >
    <a href="../../../qa/install_sdkbox/">SDKBox安装</a>
</li>

                        
                            
<li >
    <a href="../../../qa/crypt-sdkbox-config/">保护 sdkbox_config.json</a>
</li>

                        
                            
<li >
    <a href="../../../qa/sdkboxplay_troubleshoot/">SDKBoxPlay相关问题</a>
</li>

                        
                            
<li >
    <a href="../../../qa/iap_troubleshoot/">IAP相关问题</a>
</li>

                        
                            
<li >
    <a href="../../../qa/sdkbox_installer_issue/">Installer相关问题</a>
</li>

                        
                            
<li >
    <a href="../../../qa/cmake_xcframework/">CMake With XCFramework</a>
</li>

                        
                        </ul>
                    </li>
                
                

                <li style="margin-left:30px">
 <a href="http://sdkbox-doc.github.io/en/">English</a>
                </li>
                
                </ul>
            




            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#_1">安装</a></li>
        <li class="main "><a href="#_2">安装后</a></li>
            <li><a href="#android">Android</a></li>
            <li><a href="#ios">iOS</a></li>
        <li class="main "><a href="#_4">重点注意事项</a></li>
            <li><a href="#_5">禁用应用程序安全传输策略</a></li>
            <li><a href="#bitcode">禁止 Bitcode 支持</a></li>
            <li><a href="#_6">游戏全屏配置</a></li>
            <li><a href="#canopenurl">canOpenURL 白名单</a></li>
            <li><a href="#creator">关于 Creator 工程</a></li>
        <li class="main "><a href="#_7">用法</a></li>
            <li><a href="#_8">前期准备</a></li>
        <li class="main "><a href="#_9">初始化</a></li>
        <li class="main "><a href="#_10">回调</a></li>
            <li><a href="#_11">类方法例子</a></li>
            <li><a href="#lambda">Lambda 函数例子</a></li>
        <li class="main "><a href="#authorization">Authorization</a></li>
        <li class="main "><a href="#quests-api">Quests API</a></li>
            <li><a href="#_12">准备</a></li>
            <li><a href="#event">提交 event</a></li>
            <li><a href="#events">获取 events</a></li>
            <li><a href="#quests">显示 quests</a></li>
            <li><a href="#quest">处理 quest 接受</a></li>
            <li><a href="#quest_1">处理 quest 完成</a></li>
        <li class="main "><a href="#player-statistics">Player statistics(玩家状态)</a></li>
            <li><a href="#_13">获取当前登录玩家的状态信息</a></li>
        <li class="main "><a href="#achievements">Achievements (成就)</a></li>
            <li><a href="#_14">状态</a></li>
            <li><a href="#_15">显示</a></li>
            <li><a href="#_16">获取所有成就</a></li>
            <li><a href="#_17">获取成就</a></li>
            <li><a href="#_18">增量成就</a></li>
            <li><a href="#_19">解锁成就</a></li>
            <li><a href="#_20">提示成就</a></li>
        <li class="main "><a href="#leaderboards">Leaderboards (排行榜)</a></li>
            <li><a href="#_21">显示</a></li>
            <li><a href="#_22">显示所有排行榜</a></li>
            <li><a href="#_23">提交分数</a></li>
            <li><a href="#_24">获取所有分数的概括</a></li>
            <li><a href="#_25">获取所有</a></li>
            <li><a href="#_26">获取分数页面</a></li>
            <li><a href="#_27">获取下一页分数页</a></li>
        <li class="main "><a href="#realtime-multiplayer">Realtime Multiplayer (实时多人)</a></li>
            <li><a href="#_28">快速游戏</a></li>
            <li><a href="#_29">邀请玩家</a></li>
            <li><a href="#_30">接受邀请</a></li>
            <li><a href="#_31">监听</a></li>
            <li><a href="#_32">给其他玩家发消息</a></li>
            <li><a href="#_33">离开房间</a></li>
            <li><a href="#_34">接受 / 拒绝和忽略邀请</a></li>
        <li class="main "><a href="#turn-based-multiplayer">Turn Based Multiplayer (回合制多人)</a></li>
            <li><a href="#_35">快速比赛</a></li>
            <li><a href="#_36">选择玩家界面</a></li>
            <li><a href="#_37">处理比赛事件</a></li>
            <li><a href="#_38">进行回合</a></li>
            <li><a href="#_39">创建参与者结果</a></li>
            <li><a href="#_40">完成比赛</a></li>
            <li><a href="#_41">离开比赛</a></li>
            <li><a href="#_42">取消比赛</a></li>
            <li><a href="#_43">忽略比赛</a></li>
            <li><a href="#_44">开始比赛</a></li>
            <li><a href="#_45">获取之前的比赛</a></li>
            <li><a href="#_46">获取所有比赛</a></li>
        <li class="main "><a href="#nearbyconnections">NearbyConnections (附近联接)</a></li>
            <li><a href="#_47">初始化</a></li>
            <li><a href="#id">取本地端的id</a></li>
            <li><a href="#id_1">获取本地的设备id</a></li>
            <li><a href="#_48">服务</a></li>
            <li><a href="#_49">停止服务</a></li>
            <li><a href="#_50">接受联接请求</a></li>
            <li><a href="#_51">拒绝联接请求</a></li>
            <li><a href="#_52">开始搜索附近</a></li>
            <li><a href="#_53">结束搜索</a></li>
            <li><a href="#_54">发送联接请求</a></li>
            <li><a href="#_55">发送可靠消息</a></li>
            <li><a href="#_56">发送不可靠消息</a></li>
            <li><a href="#_57">断开</a></li>
            <li><a href="#_58">停止</a></li>
        <li class="main "><a href="#api-reference">API Reference</a></li>
        <li class="main "><a href="#callback-result-descriptions">Callback result descriptions</a></li>
            <li><a href="#result-codes">Result Codes</a></li>
            <li><a href="#events_1">Events</a></li>
            <li><a href="#quests_1">Quests</a></li>
            <li><a href="#playerstats">PlayerStats</a></li>
            <li><a href="#achievements_1">Achievements</a></li>
            <li><a href="#multiplayer">Multiplayer</a></li>
            <li><a href="#nearbyconnections_1">NearbyConnections</a></li>
        <li class="main "><a href="#_59">手动集成</a></li>
        <li class="main "><a href="#ios_1">iOS手动集成步骤</a></li>
            <li><a href="#_60">代码修改</a></li>
        <li class="main "><a href="#android_1">Android 手动集成</a></li>
            <li><a href="#_62">拷贝文件</a></li>
            <li><a href="#androidmanifestxml_1">修改 AndroidManifest.xml</a></li>
            <li><a href="#androidmk">修改 Android.mk</a></li>
            <li><a href="#applicationmk-cocos2d-x-v30-to-v32">修改 Application.mk (只适用于 Cocos2d-x v3.0 to v3.2)</a></li>
            <li><a href="#appactivityjava">修改 AppActivity.java</a></li>
            <li><a href="#projectproperties">修改 project.properties</a></li>
        <li class="main "><a href="#proguard">Proguard (可选)</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<p><a href="../">&#8249; Google Play Games Services Doc Home</a></p>
<h1>Google Play Games Services 集成指南</h1>

<h4><em><b>For the Lua version of cocos2d-x v3.x</b> - (<a href="./../">all other versions</a>)</em></h4>

<h2 id="_1">安装</h2>
<p>用如下命令来集成 SDKBOX IAP 插件,请确保您可以正常执行的 SDKBOX 安装器.</p>
<pre><code class="bash">$ sdkbox import gpg
</code></pre>

<h2 id="_2">安装后</h2>
<h3 id="android">Android</h3>
<h4 id="androidmanifestxml">修改 AndroidManifest.xml</h4>
<p>在你的 <code>AndroidManifest.xml</code> 中添加如下 meta-data.</p>
<pre><code>&lt;meta-data android:name=&quot;com.google.android.gms.games.APP_ID&quot;
    android:value=&quot;@string/google_app_id&quot; /&gt;
</code></pre>

<h4 id="stringxml">修改 string.xml</h4>
<p>添加如下文字到 <code>proj.android/res/values/string.xml</code> 中</p>
<pre><code>&lt;string name=&quot;google_app_id&quot;&gt;777734739048&lt;/string&gt;
</code></pre>

<p>请一定要把 <code>google_app_id</code> 对应的值修改为你自己的 App Id.</p>
<h3 id="ios">iOS</h3>
<h4 id="projios_maciosappcontrollermm">修改 <code>proj.ios_mac/ios/AppController.mm</code></h4>
<p>在 <code>AppController.mm</code> 中添加如下代码:</p>
<pre><code>- (BOOL)application:(UIApplication *)app openURL:(NSURL *)url options:(NSDictionary *)options {
    return [[GIDSignIn sharedInstance] handleURL:url
                               sourceApplication:options[UIApplicationOpenURLOptionsSourceApplicationKey]
                                      annotation:options[UIApplicationOpenURLOptionsAnnotationKey]];
}
</code></pre>

<h4 id="google-play-signin-listener">设置自己的 Google Play Signin Listener (可选)</h4>
<p>设置 GPG(Google Play Game Services) SignIn 的回调</p>
<p>这不是必选的，<code>SDKBox GPG</code> 已经在内部设置了对应的 Delegate, 当你在外面自己手动设置 GIDSignInUIDelegate 时，内部的就会被忽略</p>
<p>在外面自己手动设置 <code>GIDSignInUIDelegate</code> , 如下步骤:</p>
<p>修改 <code>proj.ios_mac/ios/RootViewController.h</code>
让 <code>RootviewController</code> 实现 <code>GIDSignInUIDelegate</code>:</p>
<pre><code>#import &lt;GoogleSignIn/GoogleSignIn.h&gt;

// 在 RootViewController 类的定义中加上:
@interface RootViewController : UIViewController&lt;GIDSignInUIDelegate&gt;
</code></pre>

<p>设置 Google SignIn Listener</p>
<p>修改 <code>proj.ios_mac/ios/AppController.mm</code></p>
<p>添加如下代码:</p>
<pre><code>(BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions
</code></pre>

<p>在 return 前添加如下代码:</p>
<pre><code>    // _viewController could also be named
    //  viewController, depending of the project type.
    [GIDSignIn sharedInstance].uiDelegate = _viewController;
</code></pre>

<h4 id="url-types">添加 URL types</h4>
<p>添加如下 URL types 到你的工程中, 路径为 <strong>your project &gt; Info &gt; URL Types</strong></p>
<ul>
<li>
<p>URL 1:</p>
<ul>
<li>Identifier: <code>com.google.ReverseClientId</code></li>
<li>Url schemes: <code>com.googleusercontent.apps.777734739048-cdkbeieil19d6pfkavddrri5o19gk4ni</code><blockquote>
<p>(use this as sample, or put your very own application’s url scheme)</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>URL 2:</p>
<ul>
<li>Identifier: <code>com.google.BundleId</code></li>
<li>URL schemes: <code>com.sdkbox.gpg</code><blockquote>
<p>(use this as sample or put your own application’s bundle id)</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h4 id="_3">更多资料</h4>
<p>在<a href="https://developers.google.com/games/services/cpp/gettingStartedIOS">官方文档</a>中查看更多的相关信息</p>
<!--
## ~~从 China 服务器下载~~ 服务器已停止
如果你在中国, 并且下载插件的速度比较慢, 可以尝试使用位于中国的服务器来下载, 查询插件, 使用方法为在你的 `sdkbox import` 后加 `--server china` 及可, 比如:

<pre><code class="bash">sdkbox import xxx  --server china
</code></pre>

xxx 为你的插件名字
-->

<h2 id="_4">重点注意事项</h2>
<p>如果您升级到了 Xcode7, 则需要以下额外步骤来确保插件工作正常:</p>
<h4 id="_5">禁用应用程序安全传输策略</h4>
<p>添加以下项到 plist:</p>
<pre><code>&lt;key&gt;NSAppTransportSecurity&lt;/key&gt;
&lt;dict&gt;
    &lt;key&gt;NSAllowsArbitraryLoads&lt;/key&gt;
    &lt;true/&gt;
&lt;/dict&gt;
</code></pre>

<p>添加后的文件内容看起来就像这样：</p>
<p><img alt="" src="../../../imgs/ATS.png" /></p>
<h4 id="bitcode">禁止 Bitcode 支持</h4>
<p>您必须禁止 <strong>Bitcode</strong> 的支持，否则将会编译失败。</p>
<h4 id="_6">游戏全屏配置</h4>
<p>如果您的游戏不同时支持横竖屏，则必须在 Xcode 中选中 <code>Requires full screen</code>，否则将不会通过 Apple 的审核。</p>
<h4 id="canopenurl">canOpenURL 白名单</h4>
<p>取决于您使用哪些插件。需要在 <code>info.plist</code> 的 <code>LSApplicationQueriesSchemes</code> 下添加名单。</p>
<h3 id="creator">关于 Creator 工程</h3>
<p>Creator 导出工程会修改工程的配置, 这可能会影响 SDKBox 对工程的配置修改. 所以可以有以下做法(任选其一):</p>
<ol>
<li>保存导出工程中的修改, 对于 SDKBox 来说可能有这些文件(mk, gradle, gradle.properties, AppDelegate.cpp, ...), 导出后再恢复对应该文件</li>
<li>在每一次 Creator 导出工程后, 重新 import 插件.</li>
</ol>
<p>推荐第一种, 但是第一种的麻烦点在于, 对于第一次(或很久没接触的人)可能会有露掉某个文件
第二种, 很方便, 它的麻烦点在于, 如果你对工程有自己的修改, SDKBox 的重新 import 不能帮你恢复.</p>
<h2 id="_7">用法</h2>
<h3 id="_8">前期准备</h3>
<p>你必须在<a href="https://play.google.com/apps/publish">Google Play Developer console</a> 创建一个自己的 app , 同时请确保所有的服务都是 enable 状态, 对应的配置也是配置正确的.</p>
<ul>
<li>请根据<a href="https://developers.google.com/games/services/console/enabling">安装指南</a>来为你的 app 安装 Google Play Games 服务.</li>
<li>安装完成后, 请根据<a href="https://developers.google.com/games/services/console/configuring">配置指南</a> 来为你的 app 打开游戏服务.</li>
</ul>
<blockquote>
<p>提示: Google Play Game Services 默认使用 release keystore, 如果你想用 debug 模式来测试, 看下这个<a href="http://stackoverflow.com/questions/17612928/should-i-use-debug-keystore-with-google-play-game-services-during-development">方法</a></p>
</blockquote>
<h2 id="_9">初始化</h2>
<p>目前，配置过程在Lua中完成，并在创建 Google Play Game 服务对象时传递进去。 这个对象是由你管理的，在Lua中可以用 <code>`gpg</code> 访问。</p>
<p>要创建一个 Google Play Game 服务实例的话，你需要传递一个表中，表中 包含了 <code>ClientID</code> 项, 它的值是你在 Google 开发者中心创建的应用的ID。</p>
<pre><code>    local config = {ClientID=&quot;...&quot;}
    gpg:CreateGameServices(config)
</code></pre>

<p>请注意，使用的 <code>ClientID</code> 是Google 开发者中心的较新的版本。 还有一个是在plist设置的较旧的版本。 确保您有正确的版本，否则初始化将失败。</p>
<p>配置结构包含的所有项值如下</p>
<pre><code>{
    LogLevel        = 1 or 2,
    EnableSnapshots = true or false,
    ClientID        = forwards client id
}
</code></pre>

<h2 id="_10">回调</h2>
<p>大多数Google Play服务方法都需要用回调参数来返回结果。 这主要是因为方法是异步执行的。</p>
<p>支持两种类型的回调。 类方法回调和函数回调（其中包括lambda函数）</p>
<h3 id="_11">类方法例子</h3>
<pre><code>ExampleClass:CallbackMethod(result)
    -- use result here
end

local someClass = ExampleClass:new()

gpg:MethodWithCallback({someClass, ExampleClass.CallbackMethod})
</code></pre>

<p>请注意，在类方法示例中，您必须传递类的实例以及方法。</p>
<h3 id="lambda">Lambda 函数例子</h3>
<pre><code>gpg:MethodWithCallback(function(result)
    -- use result here
end)
</code></pre>

<h2 id="authorization">Authorization</h2>
<p>在您可以对Google Play服务执行任何操作之前，您必须进行验证。 如果您之前已通过身份验证，则sdkbox将尝试自动登录。 你仍然会得到与你自动登录时相同的事件。</p>
<p>要开始认证过程，请调用以下代码，并传入类方法或lambda方法（参阅 回调）以接收响应。</p>
<pre><code>gpg:StartAuthorizationUI(function(result)
    if result.authStatus == gpg.AuthStatus.VALID then
        -- successfully authenticated
    end
end)
</code></pre>

<h2 id="quests-api">Quests API</h2>
<h3 id="_12">准备</h3>
<p>请务必查看Google Play服务 Quests <a href="https://developers.google.com/games/services/common/concepts/quests">文档</a>，以便更好地了解如何使用自己的门户网站设置任务，以及参考上的API。</p>
<p>在您的游戏可以访问事件和任务之前，您必须先在<a href="https://play.google.com/apps/publish/">Google Play开发者中心</a>中定义它们</p>
<h3 id="event">提交 event</h3>
<p>您可以将事件发送到 Events 服务，以便让它知道发生了什么事。 这个方法没有结果，因此不需要回调。</p>
<pre><code>gpg.Events:Increment(&quot;&lt;event id&gt;&quot;)
</code></pre>

<h3 id="events">获取 events</h3>
<p>要取当前 events 的数量，其以下其中一个方法</p>
<pre><code>gpg.Events:Fetch(&quot;&lt;event id&gt;&quot;, function(result)
    -- use result.count here
end)

-- 或

gpg.Events:FetchAll(function(results)
    for k,v in pairs(results.data) do
        -- k is the event id
        -- use v.count here
    end
end)
</code></pre>

<p>回调结果的完整成员列表可以在本文档后面的的回调结果描述部分找到。</p>
<h3 id="quests">显示 quests</h3>
<p>Google Play服务提供了一个用于选择任务的UI，或者您可以根据回调中的 quests 数据显示您自己的UI。</p>
<p>您可以显示所有可用的任务，或只显示一个任务UI。</p>
<pre><code>gpg.Quests:ShowUI(&quot;&lt;quest id&gt;&quot;, function(result)
    -- use result.quest here
end)

-- 或

gpg.Quests:ShowAllUI(function(result)
    -- use result.quest here
end)
</code></pre>

<h3 id="quest">处理 quest 接受</h3>
<p>如果你的游戏使用内置的任务UI，那么回调结果将有一个有效的Quest对象，你可以使用 <code>quest.valid（）</code> 验证，如果你使用自己的UI，那么你可以调用accept，如下:</p>
<pre><code>gpg.Quests:Accept(&quot;&lt;quest id&gt;&quot;, function(result)
    -- use result.quest here
end)
</code></pre>

<h3 id="quest_1">处理 quest 完成</h3>
<p>当玩家接受一个 quest(任务) 后，你发送事件到 quest 服务，通知它任务的进度。</p>
<p>一个所有的任务标准已经满足，你可以在内置的用户界面或自己的界面声明完成奖励。</p>
<p>您通过调用声明方法声明任务里程碑。</p>
<pre><code>gpg.Quests:ClaimMilestone(&quot;&lt;milestone id&gt;&quot;, function(result)
    if result.status == gpg.ClaimMilestoneResponse.VALID
        -- use result.milestone.completionRewardData here
    end
end)
</code></pre>

<h2 id="player-statistics">Player statistics(玩家状态)</h2>
<p>有关玩家状态的信息以及如何使用玩家状态信息的完整说明，请参阅Google Play服务中的<a href="https://developers.google.com/games/services/cpp/stats">文档</a></p>
<h3 id="_13">获取当前登录玩家的状态信息</h3>
<p>你可以获取当前登录玩家的信息，如下</p>
<pre><code>gpg.Stats:FetchForPlayer(function(result)
    if result.status == gpg.FetchForPlayerResponse.VALID then
        -- use PlayerStats here
    end
end)
</code></pre>

<h2 id="achievements">Achievements (成就)</h2>
<p>相关的完整文档，参见<a href="https://developers.google.com/games/services/common/concepts/achievements">这里</a></p>
<h3 id="_14">状态</h3>
<p>成就可以隐藏，提示和解锁。</p>
<p>成就可以指定为标准或增量。 通常，增量成就可以让玩家逐渐进步，在更长的时间内获得成就</p>
<h3 id="_15">显示</h3>
<pre><code>    gpg.Achievements:ShowAllUI(function(result)
        -- handle the result here
    end)
</code></pre>

<h3 id="_16">获取所有成就</h3>
<pre><code>    gpg.Achievements:FetchAll(nil, function(result)
        log:d(log:to_str(result))
    end)
</code></pre>

<h3 id="_17">获取成就</h3>
<pre><code>    gpg.Achievements:Fetch('CgkI6KjppNEWEAIQBQ', nil, function(result)
        log:d(log:to_str(result))
    end)
</code></pre>

<h3 id="_18">增量成就</h3>
<pre><code>   gpg.Achievements:Increment('CgkI6KjppNEWEAIQBQ')
</code></pre>

<h3 id="_19">解锁成就</h3>
<pre><code>   gpg.Achievements:Unlock('CgkI6KjppNEWEAIQBQ')
</code></pre>

<h3 id="_20">提示成就</h3>
<pre><code>    gpg.Achievements:Reveal('CgkI6KjppNEWEAIQBQ')
</code></pre>

<h2 id="leaderboards">Leaderboards (排行榜)</h2>
<p>更多文档参见<a href="https://developers.google.com/games/services/common/concepts/leaderboards">这里</a></p>
<h3 id="_21">显示</h3>
<pre><code>    gpg.Leaderboards:ShowUI(&quot;achievement id&quot;)
</code></pre>

<h3 id="_22">显示所有排行榜</h3>
<pre><code>    gpg.Leaderboards:ShowAllUI()
</code></pre>

<h3 id="_23">提交分数</h3>
<pre><code>    gpg.Leaderboards:SubmitScore(&quot;achievement id&quot;, score, &quot;meta data&quot;, function(result)
    end)
</code></pre>

<h3 id="_24">获取所有分数的概括</h3>
<pre><code>    gpg.Leaderboards:FetchAllScoreSummaries(&quot;achievement id&quot;, data source, function(result)
    end)
</code></pre>

<h3 id="_25">获取所有</h3>
<pre><code>    gpg.Leaderboards:FetchAll(datasource, function(result)
    end)
</code></pre>

<h3 id="_26">获取分数页面</h3>
<pre><code>    gpg.Leaderboards:FetchScorePage(&quot;achievement id&quot;, datasource, time, timespan, collection, maxitmes, function(result)
    end)
</code></pre>

<h3 id="_27">获取下一页分数页</h3>
<pre><code>    gpg.Leaderboards:FetchNextScorePage(datasource, max items, function(result)
    end)
</code></pre>

<h2 id="realtime-multiplayer">Realtime Multiplayer (实时多人)</h2>
<p>开始之前，请先了解Google Play Game 实时多人游戏的概念<a href="https://developers.google.com/games/services/common/concepts/realtimeMultiplayer">这里</a>。</p>
<p>要使用实时多人游戏，您必须在Google Play开发者中心<a href="https://developers.google.com/games/services/cpp/realtimeMultiplayer">启用</a>。</p>
<p>开始实时多人游戏，有三种方式与其他玩家连接，开始实时多人游戏。</p>
<h3 id="_28">快速游戏</h3>
<p>让玩家与随机用户对战 (通过 auto-matching).</p>
<pre><code>    gpg.Realtime:CreateRealTimeRoom(
        {
            type = &quot;quick_match&quot;, -- select automatching
            quick_match_params =
            {
                maximumAutomatchingPlayers = 1,
                minimumAutomatchingPlayers = 1
            }
        },
        listener,
        function(result)
            if (gpg:IsSuccess(result.result)) then
                -- use result.room here
            end
        end
    )
</code></pre>

<h3 id="_29">邀请玩家</h3>
<p>可以选择邀请特定玩家</p>
<pre><code>    gpg.Realtime:CreateRealTimeRoom(
        {
            type = &quot;ui&quot;, -- select invite players UI
            ui_params =
            {
                maximumPlayers = 1,
                minimumPlayers = 1
            }
        },
        listener,
        function(result)
            if (gpg:IsSuccess(result.result)) then
                -- use result.room here
            end
        end
    )
</code></pre>

<h3 id="_30">接受邀请</h3>
<p>在选择特定玩家的情况下，您将收到邀请，可以接受或拒绝。</p>
<pre><code>    -- you can fetch all pending invitations like this
    -- this will call you back with a result and array of invitations
    gpg.Realtime:FetchInvitations(function(result)
        if (gpg:IsSuccess(result.result)) then
            -- do something with result.invitations
        end
    end)

    -- or you can use the UI to accept or decline an invitation
    gpg.Realtime:ShowRoomInboxUI(function(result)
        if (gpg:IsSuccess(result.result)) then
            -- do something with result.invitation
        end
    end)
</code></pre>

<h3 id="_31">监听</h3>
<p>房间创建方法，包括接受邀请，监听对象。 这是为了当房间状态有变化时，可以通过监听被告知。</p>
<p>这也是你将通过 <code>onDataReceived</code> 回调方法从其他玩家接收数据消息。</p>
<pre><code>listener =
{
    -- called when something about the room changes
    onRoomStatusChanged = function(room)
    end,

    -- called when something about the connection changes
    onConnectedSetChanged = function(room)
    end,

    -- called when you get connected
    onP2PConnected = function(room, participant)
    end,

    -- called when you get disconnected
    onP2PDisconnected = function(room, participant)
    end,

    -- called if the status of one of the room participants changes
    onParticipantStatusChanged = function(room, participant)
    end,

    -- called whenever someone sends you a message
    onDataReceived = function(room, from_participant, data, is_reliable)
    end
}
</code></pre>

<h3 id="_32">给其他玩家发消息</h3>
<p>有两种类型的消息可以发送，可靠和不可靠。
可靠的消息是保证的，如果丢失，将自动重新发送。
这有一些开销，所以如果你不需要可靠性，那么你可以发送一个不可靠的消息，这更高效,但以可靠性为代价。</p>
<pre><code>gpg.Realtime:SendReliableMessage(room_id, participant_id, message, function(result)
    if (gpg:IsSuccess(result.result)) then
        -- message send was successful
    end
end)
</code></pre>

<p>发送不可靠的消息的参数json编码的字符串。
没有回调，因为是不可靠消息，没有返回状态。</p>
<pre><code>gpg.Realtime:SendUnreliableMessage(json.encode({
    data = message,
    room_id = room_id
    participant_ids = {}
}))
</code></pre>

<h3 id="_33">离开房间</h3>
<pre><code>gpg.Realtime:LeaveRoom(room_id, function(result)
end)
</code></pre>

<h3 id="_34">接受 / 拒绝和忽略邀请</h3>
<p>要接受邀请，你必须在你加入房间时设置监听，然后通过监听收取对应事件.</p>
<pre><code>gpg.Realtime:AcceptInvitation(invitation_id, listener, function(result)
end)
</code></pre>

<p>拒绝和忽略邀请不需要回调参数，他们就是告诉服务器，你对这个邀请不感兴趣.
忽略邀请用在游戏结束了，但是这个邀请还在你的收件箱中.</p>
<pre><code>gpg.Realtime:DeclineInvitation(invitation_id)
</code></pre>

<pre><code>gpg.Realtime:DismissInvitation(invitation_id)
</code></pre>

<h2 id="turn-based-multiplayer">Turn Based Multiplayer (回合制多人)</h2>
<p>在开始之前，请务必先查看Google的文档<a href="https://developers.google.com/games/services/cpp/turnbasedMultiplayer">这里</a>，并查看基于回合的多人游戏概念<a href="https://developers.google.com/games/services/common/concepts/turnbasedMultiplayer">这里</a></p>
<p>要开始一个基于回合的多人游戏，有两种方式这样做。 您可以使用UI来选择玩家（Google的或您自己的玩家），也可以开始快速匹配，为您选择玩家。</p>
<h3 id="_35">快速比赛</h3>
<pre><code>local minimumPlayers = 1
local maximumPlayers = 2
local allowAutoMatching = false
gpg.Turnbased:ShowPlayerSelectUI(minimumPlayers, maximumPlayers, allowAutoMatching, function(result)
    params = {
        type = &quot;quick_match&quot;,
        minimumAutomatchingPlayers = result.minimumAutomatchingPlayers,
        maximumAutomatchingPlayers = result.maximumAutomatchingPlayers,
        playerIds = result.playerIds
    }
    gpg.Turnbased:CreateTurnBasedMatch(params, function(result)
        if gpg:IsSuccess(result.result) then
            -- use result.match to start playing
        end
    end)
end)
</code></pre>

<h3 id="_36">选择玩家界面</h3>
<pre><code>params = {
    type = &quot;ui&quot;,
    minimumAutomatchingPlayers = 1,
    maximumAutomatchingPlayers = 2
}
gpg.Turnbased:CreateTurnBasedMatch(params, function(result)
    if gpg:IsSuccess(result.result) then
        -- use result.match to start playing
    end
end)
</code></pre>

<h3 id="_37">处理比赛事件</h3>
<p>对于基于回合的多人游戏，需要处理两个事件。 您可以注册两个回调（参阅 回调）以处理这些事件。</p>
<pre><code>gpg.Turnbased:addMatchEventCallback(
    gpg.DefaultCallbacks.TURN_BASED_MATCH_EVENT,
    function(event)
        gpg.Turnbased:ShowMatchInboxUI(function(result)
            if gpg:IsSuccess(result.result) then
                -- start using result.match here
            end
        end)
    end
)

-- 或

gpg.Turnbased:addMatchEventCallback(
    gpg.DefaultCallbacks.MULTIPLAYER_INVITATION_EVENT,
    {instance, method}
)

function class:method()
    gpg.Turnbased:ShowMatchInboxUI(function(result)
        if gpg:IsSuccess(result.result) then
            local match = result.match
            if match.matchStatus == gpg.MatchStatus.MY_TURN then
                -- do something with match, take a turn
            elseif match.matchStatus == gpg.MatchStatus.THEIR_TURN then
                -- update for their turn
            elseif match.matchStatus == gpg.MatchStatus.COMPLETED then
                -- complete match, dismiss
            else match.matchStatus == gpg.MatchStatus.EXPIRED then
                -- dismiss
            end
        end
    end)
end
</code></pre>

<h3 id="_38">进行回合</h3>
<p>要进行回合，您必须使用回合数据更新比赛数据，并将其传递给下一个参赛者。 如果您希望自动匹配下一个参与者，则可以使用ID“AUTOMATCHING_PARTICIPANT”。</p>
<pre><code>local results = match.participantResults
if winnig then
    results = gpg.Turnbased:createParticipantResult(match_id, match.pendingParticipant.id, my_rank, win_token)
elseif losing then
    results = gpg.Turnbased:createParticipantResult(match.id, match.pendingParticipant.id, my_rank, lose_token)
end

local nextParticipant = &quot;AUTOMATCHING_PARTICIPANT&quot;
if match.suggestedNextParticipant.valid and
   match.suggestedNextParticipant.id ~= &quot;&quot; then
    nextParticipant = match.suggestedNextParticipant.id
end
gpg.Turnbased:TakeMyTurn(match_id, match.pendingParticipant.id, nextParticipant, data, function(result)
end)
</code></pre>

<h3 id="_39">创建参与者结果</h3>
<p>有时您需要将参与者结果传递给方法。 在 C++ 中，可以直接使用一个结构体，但在Lua，你需要使用一个id。 这个id用于查找结构体并为帮你传递。 您可以重复使用现有的参与者ID或仅创建自己的ID。 该方法还将返回 Lua 对象。</p>
<pre><code>local results = gpg.Turnbased:CreateParticipantResult(match_id, participant_id, placement, match_result)
-- use results, or call method and pass participant_id
</code></pre>

<h3 id="_40">完成比赛</h3>
<pre><code>gpg.Turnbased:FinishMatchDuringMyTurn(match_id, participant_results_id, data, function(result)
    if gpg:IsSuccess(result.result) then
        -- success
    end
end)
</code></pre>

<h3 id="_41">离开比赛</h3>
<p>您可以随时离开比赛，但您需要调用正确的方法，以下任一方法。</p>
<pre><code>gpg.Turnbased:LeaveMatchDuringMyTurn(match_id, next_participant_id, function(result)
    if gpg:IsSuccess(result.result) then
        -- success
    end
end)

-- 或

gpg.Turnbased:LeaveMatchDuringTheirTurn(match_id, function(result)
    if gpg:IsSuccess(result.result) then
        -- success
    end
end)
</code></pre>

<h3 id="_42">取消比赛</h3>
<pre><code>gpg.Turnbased:CancelMatch(match_id, function(result)
    if gpg:IsSuccess(result.result) then
        -- success
    end
end)
</code></pre>

<h3 id="_43">忽略比赛</h3>
<pre><code>gpg.Turnbased:CancelMatch(match_id)
</code></pre>

<h3 id="_44">开始比赛</h3>
<pre><code>gpg.Turnbased:Rematch(match_id, function(result)
    if gpg:IsSuccess(result.result) then
        -- success
    end
end)
</code></pre>

<h3 id="_45">获取之前的比赛</h3>
<pre><code>gpg.Turnbased:FetchMatch(match_id, function(result)
    if gpg:IsSuccess(result.result) then
        -- success
    end
end)
</code></pre>

<h3 id="_46">获取所有比赛</h3>
<pre><code>gpg.Turnbased:FetchMatches(function(result)
    if gpg:IsSuccess(result.result) then
        -- use result.matches here
    end
end)
</code></pre>

<h2 id="nearbyconnections">NearbyConnections (附近联接)</h2>
<p>更多文档，参见<a href="https://developers.google.com/games/services/cpp/nearby">Nearby Connections</a></p>
<h3 id="_47">初始化</h3>
<p>初始化 Nearby Connection, 如果不支持当前平台，会返回 false</p>
<pre><code class="lua">local support = gpg.NearbyConnections:Init(&quot;{\&quot;LogLevel\&quot;:1}&quot;,
    function(result)
        if result.InitializationStatus then
            print('GPG Nearby init success')
        else
            print('GPG Nearby init failed')
        end
    end)
if not support then
    print('GPG Nearby is not support ios')
end
</code></pre>

<h3 id="id">取本地端的id</h3>
<p>联接成功后，获取本地端的id</p>
<pre><code class="lua">local endpoint = gpg.NearbyConnections:GetLocalEndpointId();
print('Local Endpoint Id:' .. endpoint)
</code></pre>

<h3 id="id_1">获取本地的设备id</h3>
<pre><code class="lua">local deviceid = gpg.NearbyConnections:GetLocalDeviceId();
print('Local device id:' .. deviceid)
</code></pre>

<h3 id="_48">服务</h3>
<p>开始服务，在附近广播, 让附近的手机可以找到本机</p>
<pre><code class="lua">gpg.NearbyConnections:StartAdvertising(
    &quot;\&quot;name\&quot;:\&quot;\&quot;,\&quot;duration\&quot;:0,\&quot;app_identifiers\&quot;:{\&quot;identifier\&quot;:\&quot;com.sdkbox.gpg\&quot;},&quot;,
    function(result)
        -- start advertising result

        if (1 == result.start_advertising_result.status) then
            print(&quot;GPG start advertising result:&quot; .. result.client_id
                .. &quot; status:&quot; .. result.start_advertising_result.status
                .. &quot; local_endpoint_name:&quot; .. result.start_advertising_result.local_endpoint_name)
        else
            print('start advertising failed:' .. result.start_advertising_result.status)
        end
    end,
    function(result)
        --request connect callback

        local remote_endpoint_id = result.request.remote_endpoint_id
        local payload = result.request.payload

        log:d('GPG receive connect request:' .. remote_endpoint_id)

        -- auto accept or query user
        -- 1. accept connect request
        -- invoke AcceptConnectionRequest
        -- gpg.NearbyConnections:AcceptConnectionRequest(remote_endpoint_id, payload, function (result) end)

        -- 2. reject connect request
        -- invoke RejectConnectionRequest
    end)
</code></pre>

<h3 id="_49">停止服务</h3>
<pre><code class="lua">gpg.NearbyConnections:StopAdvertising()
</code></pre>

<h3 id="_50">接受联接请求</h3>
<pre><code class="lua">gpg.NearbyConnections:AcceptConnectionRequest(
    remote_endpoint_id,
    payload,
    function (result)
        print('event:' .. result.event)
        if 'OnMessageReceived' == result.event then
            print('OnMessageReceived client_id:' .. tostring(result.client_id)
                .. ' remote_endpoint_id:' .. tostring(result.remote_endpoint_id)
                .. ' payload:' .. tostring(result.payload)
                .. ' is_reliable:' .. tostring(result.is_reliable))
        elseif 'OnDisconnected' == result.event then
            print('OnDisconnected client_id:' .. tostring(result.client_id)
                .. ' remote_endpoint_id:' .. tostring(result.remote_endpoint_id))
        else
            print('Unknown event:' .. result.event);
        end
    end)

</code></pre>

<h3 id="_51">拒绝联接请求</h3>
<pre><code class="lua">gpg.NearbyConnections:RejectConnectionRequest(remote_endpoint_id)
</code></pre>

<h3 id="_52">开始搜索附近</h3>
<p>搜索本地附近打开服务的设备,
duration 参数单位是 milliseconds</p>
<pre><code class="lua">gpg.NearbyConnections:StartDiscovery(server_id, duration,
    function (result)
        if 'OnEndpointFound' == result.event then
            print('found client_id:' .. tostring(result.client_id)
                .. ' endpoint_id:' .. tostring(result.endpoint_details.endpoint_id)
                .. ' device_id:' .. tostring(result.endpoint_details.device_id)
                .. ' name:' .. tostring(result.endpoint_details.name)
                .. ' service_id:' .. tostring(result.endpoint_details.server_id))
        elseif 'OnEndpointLost' == result.event then
            print('endpoint lost')
        else
            print('unknown event')
        end
    end)
</code></pre>

<h3 id="_53">结束搜索</h3>
<pre><code class="lua">gpg.NearbyConnections:StopDiscovery()
</code></pre>

<h3 id="_54">发送联接请求</h3>
<pre><code class="lua">gpg.NearbyConnections:SendConnectionRequest(
    name, remote_endpoint_id, payload,
    function(result)
        -- connect response callback
        if (1 == result.response.status) then
            print('Connect advertising success');
            local remote_endpoint_id = result.response.remote_endpoint_id;
        else
            print('Connect advertising failed');
        end
    end,
    function(result)
        if 'OnMessageReceived' == result.event then
            print('OnMessageReceived client_id:' .. tostring(result.client_id)
                .. ' remote_endpoint_id:' .. tostring(result.remote_endpoint_id)
                .. ' payload:' .. tostring(result.payload)
                .. ' is_reliable:' .. tostring(result.is_reliable))
        elseif 'OnDisconnected' == result.event then
            print('OnDisconnected client_id:' .. tostring(result.client_id)
                .. ' remote_endpoint_id:' .. tostring(result.remote_endpoint_id))
        else
            print('Unknown event:' .. result.event);
        end
    end)
</code></pre>

<h3 id="_55">发送可靠消息</h3>
<pre><code class="lua">gpg.NearbyConnections:SendReliableMessage(remote_endpoint_id1, message)
gpg.NearbyConnections:SendReliableMessage([remote_endpoint_id1, remote_endpoint_id2], message);
</code></pre>

<h3 id="_56">发送不可靠消息</h3>
<pre><code class="lua">gpg.NearbyConnections:SendUnreliableMessage(remote_endpoint_id1, message)
gpg.NearbyConnections:SendUnreliableMessage([remote_endpoint_id1, remote_endpoint_id2], message);
</code></pre>

<h3 id="_57">断开</h3>
<pre><code class="lua">gpg.NearbyConnections:Disconnect(remote_endpoint_id)
</code></pre>

<h3 id="_58">停止</h3>
<pre><code class="lua">gpg.NearbyConnections:Stop()
</code></pre>

<h2 id="api-reference">API Reference</h2>
<h2 id="callback-result-descriptions">Callback result descriptions</h2>
<h3 id="result-codes">Result Codes</h3>
<pre><code>{
    VALID                           = 1,
    VALID_BUT_STALE                 = 2,
    VALID_WITH_CONFLICT             = 3,
    FLUSHED                         = 4,
    ERROR_LICENSE_CHECK_FAILED      = -1,
    ERROR_INTERNAL                  = -2,
    ERROR_NOT_AUTHORIZED            = -3,
    ERROR_VERSION_UPDATE_REQUIRED   = -4,
    ERROR_TIMEOUT                   = -5,
    ERROR_CANCELED                  = -6,
    ERROR_MATCH_ALREADY_REMATCHED   = -7,
    ERROR_INACTIVE_MATCH            = -8,
    ERROR_INVALID_RESULTS           = -9,
    ERROR_INVALID_MATCH             = -10,
    ERROR_MATCH_OUT_OF_DATE         = -11,
    ERROR_UI_BUSY                   = -12,
    ERROR_QUEST_NO_LONGER_AVAILABLE = -13,
    ERROR_QUEST_NOT_STARTED         = -14,
    ERROR_MILESTONE_ALREADY_CLAIMED = -15,
    ERROR_MILESTONE_CLAIM_FAILED    = -16,
    ERROR_REAL_TIME_ROOM_NOT_JOINED = -17,
    ERROR_LEFT_ROOM                 = -18
}
</code></pre>

<h3 id="events_1">Events</h3>
<h4 id="event-description">Event description</h4>
<pre><code>{
    &quot;valid&quot;       : 1 or 0
    &quot;id&quot;          : event id,
    &quot;name&quot;        : event name,
    &quot;description&quot; : event description text,
    &quot;visibility&quot;  : whether or not event can be seen,
    &quot;count&quot;       : current count of events of this type,
    &quot;imageUrl&quot;    : URL to the event image
}
</code></pre>

<h4 id="eventsfetchall">Events:FetchAll</h4>
<pre><code>{
    &quot;status&quot; : 1 or 0 indication success or failure,
    &quot;data&quot;   : {
        event_id : Event,
        ...
    }
}
</code></pre>

<h4 id="eventsfetch">Events:Fetch</h4>
<pre><code>{
    &quot;result&quot; : 1 or 0,
    &quot;event&quot;  : Event
}
</code></pre>

<h3 id="quests_1">Quests</h3>
<h4 id="quest-description">Quest description</h4>
<pre><code>{
    &quot;valid&quot;            : 1 or 0,
    &quot;id&quot;               : quest id,
    &quot;name&quot;             : name of quest,
    &quot;description&quot;      : text description of quest,
    &quot;iconUrl&quot;          : URL to quest icon,
    &quot;bannerUrl&quot;        : URL to quest banner image,
    &quot;currentMilestone&quot; : QuestMileStone,
    &quot;questState&quot;       : quest state, accepted or not,
    &quot;startTime&quot;        : time the quest starts,
    &quot;expirationTime&quot;   : time the quest expires,
    &quot;acceptedTime&quot;     : time that the quest was accepted
}
</code></pre>

<h4 id="questmilestone-description">QuestMilestone description</h4>
<pre><code>{
    &quot;valid&quot;                : 1 or 0,
    &quot;id&quot;                   : milestone id,
    &quot;questId&quot;              : quest id for this milestone,
    &quot;eventId&quot;              : event id,
    &quot;state&quot;                : milestone state,
    &quot;currentCount&quot;         : current count,
    &quot;targetCount&quot;          : count to complete milestone,
    &quot;completionRewardData&quot; : string containing reward data from console
}
</code></pre>

<h4 id="questsfetch">Quests:Fetch</h4>
<pre><code>{
    &quot;result&quot; : 1 or 0,
    &quot;quest&quot;  : Quest
}
</code></pre>

<h4 id="questsfetchlist">Quests:FetchList</h4>
<pre><code>{
    &quot;status&quot; : 1 or 0,
    &quot;data    : 1 based array of Quest
}
</code></pre>

<h4 id="questsaccept">Quests:Accept</h4>
<pre><code>{
    &quot;status&quot; : 1 or 0,
    &quot;quest&quot;  : Quest
}
</code></pre>

<h4 id="questsclaimmilestone">Quests:ClaimMilestone</h4>
<pre><code>{
    &quot;status&quot;    : 1 or 0,
    &quot;milestone&quot; : QuestMilestone
    &quot;quest&quot;     : Quest
}
</code></pre>

<h4 id="questsshowui">Quests:ShowUI</h4>
<pre><code>{
    &quot;status&quot; : 1 or 0,
    &quot;result&quot; : 1 or 0,
    &quot;quest&quot;  : Quest
}
</code></pre>

<h4 id="questsshowallui">Quests:ShowAllUI</h4>
<pre><code>{
    &quot;status&quot; : 1 or 0,
    &quot;result&quot; : 1 or 0,
    &quot;quest&quot;  : Quest
}
</code></pre>

<h3 id="playerstats">PlayerStats</h3>
<h4 id="playerstats-description">PlayerStats description</h4>
<pre><code>{
    &quot;valid&quot;                   : 1 or 0,
    &quot;hasAverageSessionLength&quot; : 1 if valid,
    &quot;averageSessionLength&quot;    : length of session in ?,
    &quot;hasChurnProbability&quot;     : 1 if valid,
    &quot;churnProbability&quot;        : 0 - 1 likelyhood of retention,
    &quot;hasDaysSinceLastPlayed&quot;  : 1 if valid,
    &quot;daysSinceLastPlayed&quot;     : count of days,
    &quot;hasNumberOfPurchases&quot;    : 1 if valid,
    &quot;numberOfPurchases&quot;       : total number of purchases,
    &quot;hasNumberOfSessions&quot;     : 1 if valid,
    &quot;numberOfSessions&quot;        : number of sessions played,
    &quot;hasSessionPercentile&quot;    : 1 if valid,
    &quot;sessionPercentile&quot;       : what percentile they are in,
    &quot;hasSpendPercentile&quot;      : 1 if valid,
    &quot;spendPercentile&quot;         : what spend percentile they are in
}
</code></pre>

<h3 id="achievements_1">Achievements</h3>
<h4 id="achievement-description">Achievement description</h4>
<pre><code>{
    &quot;currentSteps&quot;     : Current steps completed of the achievement,
    &quot;description&quot;      : Description of the achievement.
    &quot;id&quot;               : String Id,
    &quot;lastModifiedTime&quot; : Time last modified,
    &quot;name&quot;             : Name of the achievement,
    &quot;revealedIconUrl&quot;  : URL for the revealed icon,
    &quot;state&quot;            : State, hidden, revealed, unlocked,
    &quot;totalSteps&quot;       : Total number of steps,
    &quot;type&quot;             : Incremental or standard,
    &quot;unlockedIconUrl&quot;  : URL for the unlocked icon,
    &quot;valid&quot;            : 1 or 0 if valid,
    &quot;xp&quot;               : Amount of XP awarded
}
</code></pre>

<h4 id="achievementsshowallui">Achievements:ShowAllUI</h4>
<pre><code>{
    &quot;result&quot; : result code
}
</code></pre>

<h4 id="achievementsfetchall">Achievements:FetchAll</h4>
<pre><code>    &quot;result&quot;            : result code,
    &quot;achievement_array&quot; : array of Achievements
</code></pre>

<h4 id="achievementsfetch">Achievements:Fetch</h4>
<pre><code>    &quot;result&quot;         : result code,
    &quot;achievement&quot; : Achievement
</code></pre>

<h3 id="multiplayer">Multiplayer</h3>
<h4 id="player">Player</h4>
<pre><code>{
    &quot;valid&quot;,
    &quot;id&quot;,
    &quot;name&quot;,
    &quot;avatarUrlHiRes&quot;,
    &quot;avatarUrlIconRes&quot;,
    &quot;hasLevelInfo&quot;,
    &quot;currentLevel&quot;,
    &quot;nextLevel&quot;,
    &quot;currentXP&quot;,
    &quot;lastLevelUpTime&quot;,
    &quot;title&quot;,
}
</code></pre>

<h4 id="playerlevel">PlayerLevel</h4>
<pre><code>{
    &quot;valid&quot;,
    &quot;levelNumber&quot;,
    &quot;minimumXP&quot;,
    &quot;maximumXP&quot;
}
</code></pre>

<h4 id="participant">Participant</h4>
<pre><code>{
    &quot;valid&quot;,
    &quot;displayName&quot;,
    &quot;avatarUrl&quot;,
    &quot;id&quot;,
    &quot;hasPlayer&quot;,
    &quot;player&quot;,
    &quot;participantStatus&quot;,
    &quot;hasMatchResult&quot;,
    &quot;matchResult&quot;,
    &quot;matchRank&quot;,
    &quot;icConnectedToRoom&quot;
}
</code></pre>

<h4 id="room">Room</h4>
<pre><code>{
    &quot;valid&quot;,
    &quot;id&quot;,
    &quot;variant&quot;,
    &quot;automatchWaitEstimate&quot;,
    &quot;creatingParticipant&quot;,
    &quot;creationTime&quot;,
    &quot;description&quot;,
    &quot;participants&quot;,
    &quot;remainingAutomatchingSlots&quot;,
    &quot;status&quot;
}
</code></pre>

<h4 id="multiplayerinvitation">MultiplayerInvitation</h4>
<pre><code>{
    &quot;valid&quot;,
    &quot;id&quot;,
    &quot;variant&quot;,
    &quot;automatchingSlotsAvailable&quot;,
    &quot;creationTime&quot;,
    &quot;invitingParticipant&quot;,
    &quot;type&quot;,
    &quot;participants&quot;
}
</code></pre>

<h4 id="participantresults">ParticipantResults</h4>
<pre><code>{
    &quot;valid&quot;,
    &quot;hasResultsForParticipant&quot;,
    &quot;placeForParticipant&quot;,
    &quot;matchResultForParticipant&quot;
}
</code></pre>

<h4 id="turnbasedmatch">TurnBasedMatch</h4>
<pre><code>{
    &quot;valid&quot;,
    &quot;id&quot;,
    &quot;creationTime&quot;,
    &quot;lastUpdateTime&quot;,
    &quot;creatingParticipant&quot;,
    &quot;lastUpdatingParticipant&quot;,
    &quot;pendingParticipant&quot;,
    &quot;matchStatus&quot;,
    &quot;automatchingSlotsAvailable&quot;,
    &quot;variant&quot;,
    &quot;description&quot;,
    &quot;number&quot;,
    &quot;version&quot;
}
</code></pre>

<h3 id="nearbyconnections_1">NearbyConnections</h3>
<h4 id="nearbyconnectionsinit">NearbyConnections:Init</h4>
<pre><code>{
    &quot;InitializationStatus&quot; : initialization result
}
</code></pre>

<h4 id="nearbyconnectionsstartadvertising">NearbyConnections:StartAdvertising</h4>
<pre><code>{
    &quot;client_id&quot; : client id,
    &quot;start_advertising_result&quot; :
    {
        &quot;status&quot;    : start advertising result,
        &quot;local_endpoint_name&quot;   : local endpoint name
    }
},
{
    &quot;client_id&quot; : client id,
    &quot;request&quot; :
    {
        &quot;remote_endpoint_id&quot; : remote endpoint id,
        &quot;remote_device_id&quot; : remote device id
        &quot;remote_endpoint_name&quot;: remote endpoint name
        &quot;payload&quot; : payload message
    }
}
</code></pre>

<h4 id="nearbyconnectionsacceptconnectionrequest">NearbyConnections:AcceptConnectionRequest</h4>
<pre><code>{
    &quot;event&quot; : &quot;OnMessageReceived&quot; or &quot;OnDisconnected&quot;,
    &quot;client_id&quot; : client id,
    &quot;remote_endpoint_id&quot; : remote endpoint id,
    &quot;payload&quot; : payload message, valid when event is &quot;OnMessageReceived&quot;,
    &quot;is_reliable&quot; : if message is reliable, valid when event is &quot;OnMessageReceived&quot;
}
</code></pre>

<h4 id="nearbyconnectionsstartdiscovery">NearbyConnections:StartDiscovery</h4>
<pre><code>{
    &quot;event&quot; : &quot;OnEndpointFound&quot; or &quot;&quot;,
    &quot;client_id&quot; : client id,
    &quot;remote_endpoint_id&quot;, remote endpoint id, valid when event is &quot;OnEndpointLost&quot;
    &quot;endpoint_details&quot; : endpoint info, valid when event is &quot;OnEndpointFound&quot;
    {
        &quot;endpoint_id&quot; : endpoint id,
        &quot;device_id&quot; : device id,
        &quot;name&quot; : name,
        &quot;service_id&quot; : service id
    }
}
</code></pre>

<h4 id="nearbyconnectionssendconnectionrequest">NearbyConnections:SendConnectionRequest</h4>
<p>second callback function result is same with NearbyConnections:AcceptConnectionRequest</p>
<pre><code>{
    &quot;client_id&quot; : client id,
    &quot;response&quot; : connection response
    {
        &quot;remote_endpoint_id&quot; : remote endpoint id,
        &quot;status&quot; : status code;
        &quot;payload&quot; : payload message;
    }
},
{
    &quot;event&quot; : &quot;OnMessageReceived&quot; or &quot;OnDisconnected&quot;,
    &quot;client_id&quot; : client id,
    &quot;remote_endpoint_id&quot; : remote endpoint id,
    &quot;payload&quot; : payload message, valid when event is &quot;OnMessageReceived&quot;,
    &quot;is_reliable&quot; : if message is reliable, valid when event is &quot;OnMessageReceived&quot;
}
</code></pre>

<h2 id="_59">手动集成</h2>
<p>如果用 <em>SDKBox Installer</em> 安装失败了, 可以用手动的形式来集成. 如果用 <em>SDKBox Installer</em> 安装成功了，那么不用再手动来集成了.</p>
<p>这些步骤放在文档的最后，因为基本上你很少时候会有需要到他们. 当你要手动集成时，请在完成后，再看一个手动集成以上的这些步骤.</p>
<h2 id="ios_1">iOS手动集成步骤</h2>
<p>把 <code>GooglePlay</code> 包中 <strong>plugins/ios</strong> 目录下的如下 frameworks 拖到你的 Xcode 工程中, 请确保 <code>Copy items if needed</code> 是选中状态:</p>
<blockquote>
<p>sdkbox.framework</p>
<p>PluginGPG.framework</p>
<p>GoogleAppUtilities.framework</p>
<p>GoogleAuthUtilities.framework</p>
<p>GoogleNetworkingUtilities.framework</p>
<p>GoogleOpenSource.framework</p>
<p>GooglePlus.bundle</p>
<p>GooglePlus.framework</p>
<p>GoogleSignIn.bundle</p>
<p>GoogleSignIn.framework</p>
<p>GoogleSymbolUtilities.framework</p>
<p>GoogleUtilities.framework</p>
<p>gpg.bundle</p>
<p>gpg.framework</p>
</blockquote>
<p>以上 framwork 是依赖于如下 framework 的，如果你的工程中还没有如下 framework , 添加上:</p>
<blockquote>
<p>AddressBook.framework</p>
<p>AssetsLibrary.framework</p>
<p>CoreData.framework</p>
<p>CoreLocation.framework</p>
<p>CoreMotion.framework</p>
<p>CoreTelephony.framework</p>
<p>CoreText.framework</p>
<p>Foundation.framework</p>
<p>MediaPlayer.framework</p>
<p>QuartzCore.framework</p>
<p>SafariServices</p>
<p>Security.framework</p>
<p>StoreKit</p>
<p>Security.framework</p>
<p>SystemConfiguration.framework</p>
<p>libc++.dylib</p>
<p>libz.dylib</p>
</blockquote>
<p>在工程中添加如下 linker flag ,工程路径为 <strong>Target -&gt; Build Settings -&gt; Linking -&gt; Other Linker Flags</strong>:</p>
<blockquote>
<p>-ObjC</p>
</blockquote>
<h3 id="_60">代码修改</h3>
<h4 id="projios_maciosappcontrollermm_1">修改 <code>proj.ios_mac/ios/AppController.mm</code></h4>
<p>在 <code>AppController.mm</code> 中添加如下代码:</p>
<pre><code>- (BOOL)application:(UIApplication *)app openURL:(NSURL *)url options:(NSDictionary *)options {
    return [[GIDSignIn sharedInstance] handleURL:url
                               sourceApplication:options[UIApplicationOpenURLOptionsSourceApplicationKey]
                                      annotation:options[UIApplicationOpenURLOptionsAnnotationKey]];
}
</code></pre>

<h4 id="google-play-signin-listener_1">设置自己的 Google Play Signin Listener (可选)</h4>
<p>设置 GPG(Google Play Game Services) SignIn 的回调
这不是必选的，<code>SDKBox GPG</code> 已经在内部设置了对应的 Delegate, 当你在外面自己手动设置 GIDSignInUIDelegate 时，内部的就会被忽略</p>
<p>在外面自己手动设置 <code>GIDSignInUIDelegate</code> , 如下步骤:</p>
<p>修改 <code>proj.ios_mac/ios/RootViewController.h</code>
让 <code>RootviewController</code> 实现 <code>GIDSignInUIDelegate</code>:</p>
<pre><code>#import &lt;GoogleSignIn/GoogleSignIn.h&gt;

// 在 RootViewController 类的定义中加上:
@interface RootViewController : UIViewController&lt;GIDSignInUIDelegate&gt;
</code></pre>

<p>设置 Google SignIn Listener</p>
<p>修改 <code>proj.ios_mac/ios/AppController.mm</code></p>
<p>添加如下代码:</p>
<pre><code>(BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions
</code></pre>

<p>在 return 前添加如下代码:</p>
<pre><code>    // _viewController could also be named
    //  viewController, depending of the project type.
    [GIDSignIn sharedInstance].uiDelegate = _viewController;
</code></pre>

<h4 id="url-types_1">添加 URL types</h4>
<p>添加如下 URL types 到你的工程中, 路径位置 <strong>your project &gt; Info &gt; URL Types</strong></p>
<ul>
<li>
<p>URL 1:</p>
<ul>
<li>Identifier: <code>com.google.ReverseClientId</code></li>
<li>Url schemes: <code>com.googleusercontent.apps.777734739048-cdkbeieil19d6pfkavddrri5o19gk4ni</code><blockquote>
<p>(这里要使用你自己的 application URL scheme)</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>URL 2:</p>
<ul>
<li>Identifier: <code>com.google.BundleId</code></li>
<li>URL schemes: <code>com.sdkbox.gpg</code><blockquote>
<p>(这里要使用你自己的 application 包名)</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h4 id="_61">更多信息</h4>
<p>在<a href="https://developers.google.com/games/services/cpp/gettingStartedIOS">官方文档</a>上有更多信息</p>
<p>把 <code>plugin/luabindings</code> 文件夹中所有的头文件和源文件都拷贝到你的工程的 <code>Classes</code> 文件夹中.</p>
<p>把刚刚拷贝的文件拖动到 Xcode 中或使用 <strong>File -&gt; Add files to...</strong> 来添加.</p>
<h2 id="android_1">Android 手动集成</h2>
<p>SDKBox 支持三种 <strong>Android</strong> 工程, <strong>command-line</strong>, <strong>eclipse</strong> 和 <strong>Android Studio</strong>.</p>
<ul>
<li><strong>command-line</strong> 和 <strong>eclipse</strong> 类型的项目, <code>&lt;project_root&gt;</code> 指代 <code>proj.android</code> .</li>
<li><strong>Android Studio</strong> 类型的项目, <code>&lt;project_root&gt;</code> 指代 <code>proj.android-studio</code> .</li>
</ul>
<h3 id="_62">拷贝文件</h3>
<p>把安装包中的 <code>plugin/android/libs</code> 目录下的如下 <strong>jar</strong> 文件拷贝到你的工程中的 <strong><project_root>/libs</strong> 目录下.</p>
<ul>
<li>
<p>如果你使用 cocos2d-x 源码，拷贝 <strong>jar</strong> 文件到：</p>
<p>Android command-line:
<code>cocos2d/cocos/platform/android/java/libs</code></p>
<p>Android Studio:
<code>cocos2d/cocos/platform/android/libcocos2dx/libs</code></p>
</li>
<li>
<p>如果你使用 cocos2d-js 或者 lua ，拷贝 <strong>jar</strong> 文件到:</p>
<p>Android command-line:
<code>frameworks/cocos2d-x/cocos/platform/android/java/libs</code></p>
<p>Android Studio:
<code>frameworks/cocos2d-x/cocos/platform/android/libcocos2dx/libs</code></p>
</li>
<li>
<p>如果你使用 cocos2d-x 预编译包，拷贝 <strong>jar</strong> 文件到：</p>
<p>Android command-line:
<code>proj.android/libs</code></p>
</li>
</ul>
<h4 id="jni">拷贝 jni 库</h4>
<p>从 <code>plugin/android/jni/</code> 拷贝并覆盖 <code>&lt;your_project_root&gt;/jni/</code> 目录.</p>
<h3 id="androidmanifestxml_1">修改 <code>AndroidManifest.xml</code></h3>
<p>添加如下 meta-data :</p>
<pre><code class="xml">&lt;meta-data android:name=&quot;com.google.android.gms.version&quot;
    android:value=&quot;@integer/google_play_services_version&quot; /&gt;
&lt;meta-data android:name=&quot;com.google.android.gms.games.APP_ID&quot;
    android:value=&quot;@string/google_app_id&quot; /&gt;
</code></pre>

<p>请确保添加如下 <code>&lt;string name="google_app_id"&gt;777734739048&lt;/string&gt;</code> 到 <code>res/values/string.xml</code> 中.
一定要用你自己的 google app id 来代替.</p>
<h3 id="androidmk">修改 <code>Android.mk</code></h3>
<p>将 <code>gpg</code> 拷贝到 <code>proj.andrid/jni</code> 目录下</p>
<p>添加如下内容到你的 <code>android.mk</code> 文件中</p>
<h4 id="_63">添加头文件目录</h4>
<pre><code>LOCAL_C_INCLUDES += ./gpg/include/
</code></pre>

<h4 id="_64">添加静态库</h4>
<p>添加静态库到 <strong>LOCAL_WHOLE_STATIC_LIBRARIES</strong>:</p>
<pre><code>LOCAL_WHOLE_STATIC_LIBRARIES += gpg-1
LOCAL_WHOLE_STATIC_LIBRARIES += PluginGPG
LOCAL_WHOLE_STATIC_LIBRARIES += sdkbox
</code></pre>

<p>在 <strong>import-module</strong> 语句之前添加如下调用:</p>
<pre><code>$(call import-add-path,$(LOCAL_PATH))
</code></pre>

<p>在 <strong>import-module</strong> 语句之后添加如下语句:</p>
<pre><code>$(call import-module, ./gpg)
$(call import-module, ./sdkbox)
$(call import-module, ./plugingpg)
</code></pre>

<p><strong>注意:</strong> 如果你使用的是预编译版本, 请一定要确保以上语句是在 <code>$(call import-module,./prebuilt-mk)</code> 之前.</p>
<h3 id="applicationmk-cocos2d-x-v30-to-v32">修改 <code>Application.mk</code> (只适用于 Cocos2d-x v3.0 to v3.2)</h3>
<p>查看 <code>&lt;project_root&gt;/jni/Application.mk</code> 中的 <strong>APP_STL</strong> 是否定义正确. 如果 <code>Application.mk</code> 包含了 <code>APP_STL := c++_static</code> 语句, 那么请改为:</p>
<pre><code>APP_STL := gnustl_static
</code></pre>

<p>把 <code>plugin/luabindings</code> 文件夹中所有的头文件和源文件都拷贝到你的工程的 <code>Classes</code> 文件夹中.</p>
<p>把你刚刚拷贝的 <code>.cpp</code> 文件添加到 <code>Android.mk</code> 文件的的 <strong>LOCAL_SRC_FILES</strong> 项.比如</p>
<pre><code>LOCAL_SRC_FILES := hellocpp/main.cpp \
                ../../Classes/AppDelegate.cpp \
                ../../Classes/HelloWorldScene.cpp \
                                ../../Classes/NewSourceFile.cpp
</code></pre>

<h3 id="appactivityjava">修改 <code>AppActivity.java</code></h3>
<h4 id="2403">插件版本 &gt;= 2.4.0.3</h4>
<ol>
<li>找到 <strong>AppActivity.java</strong> 文件</li>
</ol>
<pre><code class="bash">find . -name &quot;AppActivity.java&quot;
</code></pre>

<ol>
<li>把 <code>extends Cocos2dxActivity</code> 替换为 <code>extends com.sdkbox.plugin.SDKBoxActivity</code></li>
</ol>
<p>以下是 <strong>AppActivity.java</strong> 不同版本的引擎所在的目录：</p>
<pre><code>cpp
  - proj.android/src/org/cocos2dx/cpp/AppActivity.java
  - proj.android-studio/app/src/org/cocos2dx/cpp/AppActivity.java
  - proj.android/app/src/org/cocos2dx/cpp/AppActivity.java ( from cocos2d-x 3.17)

lua
  - frameworks/runtime-src/proj.android/src/org/cocos2dx/lua/AppActivity.java
  - frameworks/runtime-src/proj.android-studio/app/src/org/cocos2dx/lua/AppActivity.java
  - frameworks/runtime-src/proj.android/app/src/org/cocos2dx/lua/AppActivity.java (from cocos2d-x 3.17)

js
  - frameworks/runtime-src/proj.android/src/org/cocos2dx/javascript/AppActivity.java
  - frameworks/runtime-src/proj.android/app/src/org/cocos2dx/javascript/AppActivity.java ( from cocos2d-x 3.17)
</code></pre>

<h4 id="2403_1">插件版本 &lt; 2.4.0.3</h4>
<ul>
<li>
<p>如果您使用 cocos2d-x 源代码，假设您在 <code>proj.android</code> 目录下，那么您可以在如下位置找到 <code>Cocos2dxActivity.java</code> 文件：</p>
<p><code>../../cocos2d-x/cocos/platform/android/java/src/org/cocos2dx/
lib/Cocos2dxActivity.java</code></p>
</li>
<li>
<p>如果您使用 cocos2dx-x 预编译库， 假设您在 <code>proj.android</code> 目录下，那么您可以在如下位置找到 <code>Cocos2dxActivity.java</code> 文件：</p>
<p><code>./src/org/cocos2dx/lib/Cocos2dxActivity.java</code></p>
</li>
</ul>
<p><strong>Note:</strong> 当你使用 cocos2d-x 源代码时，不同的版本中 <code>Cocos2dxActivity.java</code> 文件的位置也不同。一个确定该文件位置的方法是查看 <code>proj.android/project.properties</code> 。比如：</p>
<pre><code>android.library.reference.1=../../cocos2d-x/cocos/platform/android/java
</code></pre>

<p>在这个例子中， <code>Cocos2dxActivity.java</code> 文件应该在如下位置：</p>
<pre><code>../../cocos2d-x/cocos/platform/android/java/src/org/cocos2dx/lib/Cocos2dxActivity.java
</code></pre>

<ul>
<li>修改 <code>Cocos2dxActivity.java</code> 文件，导入如下包：</li>
</ul>
<pre><code class="java">import android.content.Intent;
import com.sdkbox.plugin.SDKBox;
</code></pre>

<ul>
<li>然后，修改 <code>Cocos2dxActivity</code> 类的 <code>onCreate(final Bundle savedInstanceState)</code> 函数，添加一个调用语句 <code>SDKBox.init(this);</code> 。添加的位置非常重要，必须在调用 <code>onLoadNativeLibraries();</code> 之后。如下：</li>
</ul>
<pre><code class="java">onLoadNativeLibraries();
SDKBox.init(this);
</code></pre>

<ul>
<li>
<p>最后, 我需要提供合适的 <strong>overrides</strong> 方法的代码。这里有一些约定如下。</p>
<ul>
<li>
<p>如果这个被列出的方法没有在 <code>SDKBox</code> 中定义，那么__定义它__。</p>
</li>
<li>
<p>如果这个被列出的方法已经被定义在 <code>SDKBox</code> 中，那么请调用这个在 <code>SDKBox</code> 中的__同名方法__。</p>
</li>
</ul>
</li>
</ul>
<pre><code class="java">    @Override
    protected void onActivityResult(int requestCode, int resultCode, Intent data) {
          if(!SDKBox.onActivityResult(requestCode, resultCode, data)) {
            super.onActivityResult(requestCode, resultCode, data);
          }
    }
    @Override
    protected void onStart() {
          super.onStart();
          SDKBox.onStart();
    }
    @Override
    protected void onStop() {
          super.onStop();
          SDKBox.onStop();
    }
    @Override
    protected void onResume() {
          super.onResume();
          SDKBox.onResume();
    }
    @Override
    protected void onPause() {
          super.onPause();
          SDKBox.onPause();
    }
    @Override
    public void onBackPressed() {
          if(!SDKBox.onBackPressed()) {
            super.onBackPressed();
          }
    }
</code></pre>

<h3 id="projectproperties">修改 <code>project.properties</code></h3>
<p>添加 <strong>Google Play Services</strong> Android 库引用, 其路径因你的配置而有所不同.
并且 <strong>Google Play Services</strong> 不是默认下载的, 您需要打开 <strong>sdk installer</strong> ， 选择 <strong>extras-&gt;google play services</strong> 下载并安装。例子:</p>
<pre><code>android.library.reference.1=
../android/sdk.latest/extras/google/google_play_services/libproject/
google-play-services_lib
</code></pre>

<p><strong>注意:</strong> 如果已经存在 <code>android.library.reference.1</code>, 您可以递增数字, 例如 <code>android.library.reference.2</code>, 等等.</p>
<h2 id="proguard">Proguard (可选)</h2>
<ul>
<li>编辑 <code>project.properties</code>,写入一个 <code>Proguard</code> 配置. 例如:</li>
</ul>
<pre><code>proguard.config=${sdk.dir}/tools/proguard/proguard-android.txt:proguard-project.txt
</code></pre>

<ul>
<li>编辑你指定的这个文件，添加如下内容:</li>
</ul>
<pre><code># cocos2d-x
-keep public class org.cocos2dx.** { *; }
-dontwarn org.cocos2dx.**
-keep public class com.chukong.** { *; }
-dontwarn com.chukong.**

# google play service
-keep class com.google.android.gms.** { *; }
-dontwarn com.google.android.gms.**

-keep class * extends java.util.ListResourceBundle {
    protected Object[][] getContents();
}

-keep public class com.google.android.gms.common.internal.safeparcel.SafeParcelable {
    public static final *** NULL;
}

-keepnames @com.google.android.gms.common.annotation.KeepName class *
-keepclassmembernames class * {
    @com.google.android.gms.common.annotation.KeepName *;
}

-keepnames class * implements android.os.Parcelable {
    public static final ** CREATOR;
}

#sdkbox
-keep class com.sdkbox.** { *; }
-dontwarn com.sdkbox.**
</code></pre>

<p><strong>注意:</strong> Proguard 只在 <strong>Release</strong> 编译时有效 (比如 <code>cocos run -m release</code>), debug 不会触发 Proguard.</p></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Build Date UTC : 2021-10-25 02:17:33, Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        
        <script src="../../../js/jquery-1.10.2.min.js"></script>
        <script src="../../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../../js/highlight.pack.js"></script>
        <script>var base_url = '../../..';</script>
        <script src="../../../js/base.js"></script>
        


        
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-70044300-2', 'auto');
            ga('send', 'pageview');
        </script>
        
    </body>
</html>
