<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">

	<title>Google Play Game with C++ - SDKBOX</title>
        
        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../../../css/base.css?2" rel="stylesheet">
        <link rel="stylesheet" href="../../../css/highlight.css">
        <link href="../../../css/custom.css" rel="stylesheet">
        

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="http://sdkbox.com"><img src="http://www.cocos2d-x.org/s/sdkbox/SDKBOX_logo.png">Docs</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">

            <ul class="nav navbar-nav navbar-right">


            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../../..">简介</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Cocos <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../cocos/">安装方式</a>
</li>

                        
                            
<li >
    <a href="../../../installer/">命令行工具</a>
</li>

                        
                            
<li >
    <a href="../../../qa/cocos_creator/">Creator集成</a>
</li>

                        
                            
  
  <li class="dropdown-submenu">
    <a tabindex="-1" class="non-link">SDK插件</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../achievement/">Achievements</a>
</li>

        
            
  

        
            
<li >
    <a href="../../adcolony/">AdColony</a>
</li>

        
            
  

        
            
<li >
    <a href="../../admob/">AdMob</a>
</li>

        
            
  

        
            
<li >
    <a href="../../agecheq/">AgeCheq</a>
</li>

        
            
  

        
            
<li >
    <a href="../../appnext/">Appnext</a>
</li>

        
            
  

        
            
<li >
    <a href="../../appodeal/">Appodeal</a>
</li>

        
            
  

        
            
<li >
    <a href="../../amazon/">Amazon</a>
</li>

        
            
  

        
            
<li >
    <a href="../../apteligent/">Apteligent</a>
</li>

        
            
  

        
            
<li >
    <a href="../../bee7/">Bee7</a>
</li>

        
            
  

        
            
<li >
    <a href="../../chartboost/">Chartboost</a>
</li>

        
            
  

        
            
<li >
    <a href="../../ethwallet/">EthWallet</a>
</li>

        
            
<li >
    <a href="../../facebook/">Facebook</a>
</li>

        
            
  

        
            
<li >
    <a href="../../gameroom/">Facebook Gameroom</a>
</li>

        
            
  

        
            
<li >
    <a href="../../firebase/">Firebase</a>
</li>

        
            
  

        
            
<li >
    <a href="../../flurryanalytics/">Flurry Analytics</a>
</li>

        
            
  

        
            
<li >
    <a href="../../fyber/">Fyber</a>
</li>

        
            
  

        
            
<li >
    <a href="../../googleanalytics/">Google Analytics</a>
</li>

        
            
  

        
            
<li >
    <a href="../">Google Play Game</a>
</li>

        
            
  

        
            
<li >
    <a href="../../hms/">Huawei Mobile Services</a>
</li>

        
            
  

        
            
<li >
    <a href="../../iap/">In-App Purchase</a>
</li>

        
            
  

        
            
<li >
    <a href="../../inmobi/">InMobi</a>
</li>

        
            
  

        
            
<li >
    <a href="../../kochava/">Kochava</a>
</li>

        
            
  

        
            
<li >
    <a href="../../leadbolt/">LeadBolt</a>
</li>

        
            
  

        
            
<li >
    <a href="../../leaderboard/">Leaderboard</a>
</li>

        
            
  

        
            
<li >
    <a href="../../misc/">Misc</a>
</li>

        
            
  

        
            
<li >
    <a href="../../playphone/">Playphone</a>
</li>

        
            
  

        
            
<li >
    <a href="../../review/">Ratings & Reviews</a>
</li>

        
            
  

        
            
<li >
    <a href="../../sdkboxads/">SDKBOX Ads</a>
</li>

        
            
  

        
            
<li >
    <a href="../../sdkboxplay/">SDKBOX Play</a>
</li>

        
            
  

        
            
<li >
    <a href="../../share/">Social Sharing</a>
</li>

        
            
  

        
            
<li >
    <a href="../../tune/">Tune</a>
</li>

        
            
  

        
            
<li >
    <a href="../../unityads/">UnityAds</a>
</li>

        
            
  

        
            
<li >
    <a href="../../valuepotion/">Valuepotion</a>
</li>

        
            
  

        
            
<li >
    <a href="../../vungle/">Vungle</a>
</li>

        
            
  

        
            
<li >
    <a href="../../youtube/">Youtube</a>
</li>

        
            
  

        
    </ul>
  </li>
  

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Unity <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../unity/iap/">In-App Purchase</a>
</li>

                        
                            
<li >
    <a href="../../../unity/review/">Ratings & Reviews</a>
</li>

                        
                            
<li >
    <a href="../../../unity/socialshare/">SocialShare</a>
</li>

                        
                            
<li >
    <a href="../../../unity/googleanalytics/documentation/">Google Analytics</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Unreal <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../unreal/iap/">In-App Purchase</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">LiveOps <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../liveops/">使用介绍</a>
</li>

                        
                            
<li >
    <a href="../../../liveops/remote-config/">远程配置</a>
</li>

                        
                            
<li >
    <a href="../../../liveops/receipt-verification/">服务器端IAP订单校验</a>
</li>

                        
                            
<li >
    <a href="../../../liveops/catalog-management/">即时可购买项目管理</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">指南 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../qa/installgoogleplaystore/">GooglePlay安装指南</a>
</li>

                        
                            
<li >
    <a href="../../../qa/integration-admob-to-creator/">AdMob集成指南</a>
</li>

                        
                            
<li >
    <a href="../../../qa/sdkbox-for-create-usage/">SDKBoxGUI For Creator介绍</a>
</li>

                        
                            
<li >
    <a href="../../../qa/crypt-sdkbox-config/">保护 sdkbox_config.json</a>
</li>

                        
                            
<li >
    <a href="../../../qa/sdkboxplay_troubleshoot/">SDKBoxPlay相关问题</a>
</li>

                        
                            
<li >
    <a href="../../../qa/iap_troubleshoot/">IAP相关问题</a>
</li>

                        
                            
<li >
    <a href="../../../qa/sdkbox_installer_issue/">Installer相关问题</a>
</li>

                        
                        </ul>
                    </li>
                
                

                <li style="margin-left:30px">
 <a href="http://sdkbox-doc.github.io/en/">English</a>
                </li>
                
                </ul>
            




            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#_1">安装</a></li>
        <li class="main "><a href="#_2">安装后</a></li>
            <li><a href="#android">Android</a></li>
            <li><a href="#ios">iOS</a></li>
        <li class="main "><a href="#china">~~从 China 服务器下载~~ 服务器已停止</a></li>
        <li class="main "><a href="#_4">重点注意事项</a></li>
            <li><a href="#_5">禁用应用程序安全传输策略</a></li>
            <li><a href="#bitcode">禁止 Bitcode 支持</a></li>
            <li><a href="#_6">游戏全屏配置</a></li>
            <li><a href="#canopenurl">canOpenURL 白名单</a></li>
        <li class="main "><a href="#_7">用法</a></li>
            <li><a href="#_8">前期准备</a></li>
            <li><a href="#google-play-games">初始化 Google Play Games</a></li>
            <li><a href="#authorization">Authorization (认证)</a></li>
            <li><a href="#achevements">Achevements (成就)</a></li>
            <li><a href="#leaderboards">Leaderboards (排行榜)</a></li>
            <li><a href="#saved-games">Saved Games (存储游戏)</a></li>
            <li><a href="#realtime-multiplayer">Realtime multiplayer (实时多人)</a></li>
            <li><a href="#turn-based-multiplayer">Turn-based multiplayer (回合多人)</a></li>
            <li><a href="#events-and-quests">Events and Quests (事件和任务)</a></li>
            <li><a href="#player-statistics">Player Statistics (玩家状态信息)</a></li>
            <li><a href="#nearby-connections">Nearby Connections (附近联接)</a></li>
        <li class="main "><a href="#api">API 文档</a></li>
        <li class="main "><a href="#_9">手动集成</a></li>
        <li class="main "><a href="#ios_1">iOS手动集成步骤</a></li>
            <li><a href="#_10">代码修改</a></li>
        <li class="main "><a href="#android_1">Android 手动集成</a></li>
            <li><a href="#_12">拷贝文件</a></li>
            <li><a href="#androidmanifestxml_1">修改 AndroidManifest.xml</a></li>
            <li><a href="#androidmk">修改 Android.mk</a></li>
            <li><a href="#applicationmk-cocos2d-x-v30-to-v32">修改 Application.mk (只适用于 Cocos2d-x v3.0 to v3.2)</a></li>
            <li><a href="#appactivityjava">修改 AppActivity.java</a></li>
            <li><a href="#projectproperties">修改 project.properties</a></li>
        <li class="main "><a href="#proguard">Proguard (可选)</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<p><a href="../">&#8249; Google Play Games Services Doc Home</a></p>
<h1>Google Play Games Services 集成指南</h1>

<h4><em><b>For the C++ version of cocos2d-x v3.x</b> - (<a href="./../">all other versions</a>)</em></h4>

<h2 id="_1">安装</h2>
<p>用如下命令来集成 SDKBOX IAP 插件,请确保您可以正常执行的 SDKBOX 安装器.</p>
<pre><code class="bash">$ sdkbox import gpg
</code></pre>

<h2 id="_2">安装后</h2>
<h3 id="android">Android</h3>
<h4 id="androidmanifestxml">修改 AndroidManifest.xml</h4>
<p>在你的 <code>AndroidManifest.xml</code> 中添加如下 meta-data.</p>
<pre><code>&lt;meta-data android:name=&quot;com.google.android.gms.games.APP_ID&quot;
    android:value=&quot;@string/google_app_id&quot; /&gt;
</code></pre>

<h4 id="stringxml">修改 string.xml</h4>
<p>添加如下文字到 <code>proj.android/res/values/string.xml</code> 中</p>
<pre><code>&lt;string name=&quot;google_app_id&quot;&gt;777734739048&lt;/string&gt;
</code></pre>

<p>请一定要把 <code>google_app_id</code> 对应的值修改为你自己的 App Id.</p>
<h3 id="ios">iOS</h3>
<h4 id="projios_maciosappcontrollermm">修改 <code>proj.ios_mac/ios/AppController.mm</code></h4>
<p>在 <code>AppController.mm</code> 中添加如下代码:</p>
<pre><code>- (BOOL)application:(UIApplication *)app openURL:(NSURL *)url options:(NSDictionary *)options {
    return [[GIDSignIn sharedInstance] handleURL:url
                               sourceApplication:options[UIApplicationOpenURLOptionsSourceApplicationKey]
                                      annotation:options[UIApplicationOpenURLOptionsAnnotationKey]];
}
</code></pre>

<h4 id="google-play-signin-listener">设置自己的 Google Play Signin Listener (可选)</h4>
<p>设置 GPG(Google Play Game Services) SignIn 的回调</p>
<p>这不是必选的，<code>SDKBox GPG</code> 已经在内部设置了对应的 Delegate, 当你在外面自己手动设置 GIDSignInUIDelegate 时，内部的就会被忽略</p>
<p>在外面自己手动设置 <code>GIDSignInUIDelegate</code> , 如下步骤:</p>
<p>修改 <code>proj.ios_mac/ios/RootViewController.h</code>
让 <code>RootviewController</code> 实现 <code>GIDSignInUIDelegate</code>:</p>
<pre><code>#import &lt;GoogleSignIn/GoogleSignIn.h&gt;

// 在 RootViewController 类的定义中加上:
@interface RootViewController : UIViewController&lt;GIDSignInUIDelegate&gt;
</code></pre>

<p>设置 Google SignIn Listener</p>
<p>修改 <code>proj.ios_mac/ios/AppController.mm</code></p>
<p>添加如下代码:</p>
<pre><code>(BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions
</code></pre>

<p>在 return 前添加如下代码:</p>
<pre><code>    // _viewController could also be named
    //  viewController, depending of the project type.
    [GIDSignIn sharedInstance].uiDelegate = _viewController;
</code></pre>

<h4 id="url-types">添加 URL types</h4>
<p>添加如下 URL types 到你的工程中, 路径为 <strong>your project &gt; Info &gt; URL Types</strong></p>
<ul>
<li>
<p>URL 1:</p>
<ul>
<li>Identifier: <code>com.google.ReverseClientId</code></li>
<li>Url schemes: <code>com.googleusercontent.apps.777734739048-cdkbeieil19d6pfkavddrri5o19gk4ni</code><blockquote>
<p>(use this as sample, or put your very own application’s url scheme)</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>URL 2:</p>
<ul>
<li>Identifier: <code>com.google.BundleId</code></li>
<li>URL schemes: <code>com.sdkbox.gpg</code><blockquote>
<p>(use this as sample or put your own application’s bundle id)</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h4 id="_3">更多资料</h4>
<p>在<a href="https://developers.google.com/games/services/cpp/gettingStartedIOS">官方文档</a>中查看更多的相关信息</p>
<h2 id="china">~~从 China 服务器下载~~ 服务器已停止</h2>
<p>如果你在中国, 并且下载插件的速度比较慢, 可以尝试使用位于中国的服务器来下载, 查询插件, 使用方法为在你的 <code>sdkbox import</code> 后加 <code>--server china</code> 及可, 比如:</p>
<pre><code class="bash">sdkbox import xxx  --server china
</code></pre>

<p>xxx 为你的插件名字</p>
<h2 id="_4">重点注意事项</h2>
<p>如果您升级到了 Xcode7, 则需要以下额外步骤来确保插件工作正常:</p>
<h4 id="_5">禁用应用程序安全传输策略</h4>
<p>添加以下项到 plist:</p>
<pre><code>&lt;key&gt;NSAppTransportSecurity&lt;/key&gt;
&lt;dict&gt;
    &lt;key&gt;NSAllowsArbitraryLoads&lt;/key&gt;
    &lt;true/&gt;
&lt;/dict&gt;
</code></pre>

<p>添加后的文件内容看起来就像这样：</p>
<p><img alt="" src="../../../imgs/ATS.png" /></p>
<h4 id="bitcode">禁止 Bitcode 支持</h4>
<p>您必须禁止 <strong>Bitcode</strong> 的支持，否则将会编译失败。</p>
<h4 id="_6">游戏全屏配置</h4>
<p>如果您的游戏不同时支持横竖屏，则必须在 Xcode 中选中 <code>Requires full screen</code>，否则将不会通过 Apple 的审核。</p>
<h4 id="canopenurl">canOpenURL 白名单</h4>
<p>取决于您使用哪些插件。需要在 <code>info.plist</code> 的 <code>LSApplicationQueriesSchemes</code> 下添加名单。</p>
<h2 id="_7">用法</h2>
<h3 id="_8">前期准备</h3>
<p>你必须在<a href="https://play.google.com/apps/publish">Google Play Developer console</a> 创建一个自己的 app , 同时请确保所有的服务都是 enable 状态, 对应的配置也是配置正确的.</p>
<ul>
<li>请根据<a href="https://developers.google.com/games/services/console/enabling">安装指南</a>来为你的 app 安装 Google Play Games 服务.</li>
<li>安装完成后, 请根据<a href="https://developers.google.com/games/services/console/configuring">配置指南</a> 来为你的 app 打开游戏服务.</li>
</ul>
<blockquote>
<p>提示: Google Play Game Services 默认使用 release keystore, 如果你想用 debug 模式来测试, 看下这个<a href="http://stackoverflow.com/questions/17612928/should-i-use-debug-keystore-with-google-play-game-services-during-development">方法</a></p>
</blockquote>
<h3 id="google-play-games">初始化 Google Play Games</h3>
<p>在你代码合适的位置初始化插件.我们建议在 <code>AppDelegate::applicationDidFinishLaunching()</code> 或 <code>AppController:didFinishLaunchingWithOptions()</code> 中初始化. 请确保你添加了对应的头文件:</p>
<pre><code class="cpp">AppDelegate::applicationDidFinishLaunching()
{
     sdkbox::PluginGPG::init();
}
</code></pre>

<h3 id="authorization">Authorization (认证)</h3>
<p>所有的 Google Play Game 服务都要求用户登录, 在使用任何服务之前，都要保证用户已经登录成功了.
更多信息请见<a href="https://developers.google.com/games/services/cpp/GettingStartedNativeClient#concepts">官方文档</a></p>
<h3 id="achevements">Achevements (成就)</h3>
<p>你需要联接游戏服务到你的游戏中，同时你的游戏要是 "已发布" 状态, 成就才有效.
更多信息请见<a href="https://developers.google.com/games/services/common/concepts/achievements">官方文档</a></p>
<h3 id="leaderboards">Leaderboards (排行榜)</h3>
<p>你需要联接游戏服务到你的游戏中，同时你的游戏要是 "已发布" 状态, 排行榜才有效.
更多信息请见<a href="https://developers.google.com/games/services/common/concepts/leaderboards">官方文档</a></p>
<h3 id="saved-games">Saved Games (存储游戏)</h3>
<p>存储游戏功能需要在初始化阶段调用 <code>EnableSnapshots()</code> , 同时在 Google Play 开发者中心把它设置为启用状态.
更多信息请见<a href="https://developers.google.com/games/services/common/concepts/savedgames">官方文档</a></p>
<h3 id="realtime-multiplayer">Realtime multiplayer (实时多人)</h3>
<p>你需要联接游戏服务到你的游戏中，同时你的游戏要是 "已发布" 状态, Realtime multiplayer才有效.
更多信息请见<a href="https://developers.google.com/games/services/common/concepts/realtimeMultiplayer">官方文档</a></p>
<h3 id="turn-based-multiplayer">Turn-based multiplayer (回合多人)</h3>
<p>你需要联接游戏服务到你的游戏中，同时你的游戏要是 "已发布" 状态, Turn-based multiplayer 才有效.
更多信息请见<a href="https://developers.google.com/games/services/common/concepts/turnbasedMultiplayer">官方文档</a></p>
<h3 id="events-and-quests">Events and Quests (事件和任务)</h3>
<p>你需要联接游戏服务到你的游戏中，同时你的游戏要是 "已发布" 状态, Events and Quests 才有效.
更多信息请见<a href="https://developers.google.com/games/services/common/concepts/quests">官方文档</a></p>
<h3 id="player-statistics">Player Statistics (玩家状态信息)</h3>
<p>Player Stats 添加了有用的数据分析到你的游戏中.
更多信息请见<a href="https://developers.google.com/games/services/cpp/stats">官方文档</a></p>
<h3 id="nearby-connections">Nearby Connections (附近联接)</h3>
<p>Nearby Connections 让你的游戏支持本地多人，屏幕共享功能.
更多信息请见<a href="https://developers.google.com/games/services/cpp/nearby">官方文档</a></p>
<h2 id="api">API 文档</h2>
<p>C++ 的 Google Play Game Services API 文档，请参见<a href="https://developers.google.com/games/services/cpp/api/annotated">官方文件</a></p>
<h2 id="_9">手动集成</h2>
<p>如果用 <em>SDKBox Installer</em> 安装失败了, 可以用手动的形式来集成. 如果用 <em>SDKBox Installer</em> 安装成功了，那么不用再手动来集成了.</p>
<p>这些步骤放在文档的最后，因为基本上你很少时候会有需要到他们. 当你要手动集成时，请在完成后，再看一个手动集成以上的这些步骤.</p>
<h2 id="ios_1">iOS手动集成步骤</h2>
<p>把 <code>GooglePlay</code> 包中 <strong>plugins/ios</strong> 目录下的如下 frameworks 拖到你的 Xcode 工程中, 请确保 <code>Copy items if needed</code> 是选中状态:</p>
<blockquote>
<p>sdkbox.framework</p>
<p>PluginGPG.framework</p>
<p>GoogleAppUtilities.framework</p>
<p>GoogleAuthUtilities.framework</p>
<p>GoogleNetworkingUtilities.framework</p>
<p>GoogleOpenSource.framework</p>
<p>GooglePlus.bundle</p>
<p>GooglePlus.framework</p>
<p>GoogleSignIn.bundle</p>
<p>GoogleSignIn.framework</p>
<p>GoogleSymbolUtilities.framework</p>
<p>GoogleUtilities.framework</p>
<p>gpg.bundle</p>
<p>gpg.framework</p>
</blockquote>
<p>以上 framwork 是依赖于如下 framework 的，如果你的工程中还没有如下 framework , 添加上:</p>
<blockquote>
<p>AddressBook.framework</p>
<p>AssetsLibrary.framework</p>
<p>CoreData.framework</p>
<p>CoreLocation.framework</p>
<p>CoreMotion.framework</p>
<p>CoreTelephony.framework</p>
<p>CoreText.framework</p>
<p>Foundation.framework</p>
<p>MediaPlayer.framework</p>
<p>QuartzCore.framework</p>
<p>SafariServices</p>
<p>Security.framework</p>
<p>StoreKit</p>
<p>Security.framework</p>
<p>SystemConfiguration.framework</p>
<p>libc++.dylib</p>
<p>libz.dylib</p>
</blockquote>
<p>在工程中添加如下 linker flag ,工程路径为 <strong>Target -&gt; Build Settings -&gt; Linking -&gt; Other Linker Flags</strong>:</p>
<blockquote>
<p>-ObjC</p>
</blockquote>
<h3 id="_10">代码修改</h3>
<h4 id="projios_maciosappcontrollermm_1">修改 <code>proj.ios_mac/ios/AppController.mm</code></h4>
<p>在 <code>AppController.mm</code> 中添加如下代码:</p>
<pre><code>- (BOOL)application:(UIApplication *)app openURL:(NSURL *)url options:(NSDictionary *)options {
    return [[GIDSignIn sharedInstance] handleURL:url
                               sourceApplication:options[UIApplicationOpenURLOptionsSourceApplicationKey]
                                      annotation:options[UIApplicationOpenURLOptionsAnnotationKey]];
}
</code></pre>

<h4 id="google-play-signin-listener_1">设置自己的 Google Play Signin Listener (可选)</h4>
<p>设置 GPG(Google Play Game Services) SignIn 的回调
这不是必选的，<code>SDKBox GPG</code> 已经在内部设置了对应的 Delegate, 当你在外面自己手动设置 GIDSignInUIDelegate 时，内部的就会被忽略</p>
<p>在外面自己手动设置 <code>GIDSignInUIDelegate</code> , 如下步骤:</p>
<p>修改 <code>proj.ios_mac/ios/RootViewController.h</code>
让 <code>RootviewController</code> 实现 <code>GIDSignInUIDelegate</code>:</p>
<pre><code>#import &lt;GoogleSignIn/GoogleSignIn.h&gt;

// 在 RootViewController 类的定义中加上:
@interface RootViewController : UIViewController&lt;GIDSignInUIDelegate&gt;
</code></pre>

<p>设置 Google SignIn Listener</p>
<p>修改 <code>proj.ios_mac/ios/AppController.mm</code></p>
<p>添加如下代码:</p>
<pre><code>(BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions
</code></pre>

<p>在 return 前添加如下代码:</p>
<pre><code>    // _viewController could also be named
    //  viewController, depending of the project type.
    [GIDSignIn sharedInstance].uiDelegate = _viewController;
</code></pre>

<h4 id="url-types_1">添加 URL types</h4>
<p>添加如下 URL types 到你的工程中, 路径位置 <strong>your project &gt; Info &gt; URL Types</strong></p>
<ul>
<li>
<p>URL 1:</p>
<ul>
<li>Identifier: <code>com.google.ReverseClientId</code></li>
<li>Url schemes: <code>com.googleusercontent.apps.777734739048-cdkbeieil19d6pfkavddrri5o19gk4ni</code><blockquote>
<p>(这里要使用你自己的 application URL scheme)</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>URL 2:</p>
<ul>
<li>Identifier: <code>com.google.BundleId</code></li>
<li>URL schemes: <code>com.sdkbox.gpg</code><blockquote>
<p>(这里要使用你自己的 application 包名)</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h4 id="_11">更多信息</h4>
<p>在<a href="https://developers.google.com/games/services/cpp/gettingStartedIOS">官方文档</a>上有更多信息</p>
<h2 id="android_1">Android 手动集成</h2>
<p>SDKBox 支持三种 <strong>Android</strong> 工程, <strong>command-line</strong>, <strong>eclipse</strong> 和 <strong>Android Studio</strong>.</p>
<ul>
<li><strong>command-line</strong> 和 <strong>eclipse</strong> 类型的项目, <code>&lt;project_root&gt;</code> 指代 <code>proj.android</code> .</li>
<li><strong>Android Studio</strong> 类型的项目, <code>&lt;project_root&gt;</code> 指代 <code>proj.android-studio</code> .</li>
</ul>
<h3 id="_12">拷贝文件</h3>
<p>把安装包中的 <code>plugin/android/libs</code> 目录下的如下 <strong>jar</strong> 文件拷贝到你的工程中的 <strong><project_root>/libs</strong> 目录下.</p>
<ul>
<li>
<p>如果你使用 cocos2d-x 源码，拷贝 <strong>jar</strong> 文件到：</p>
<p>Android command-line:
<code>cocos2d/cocos/platform/android/java/libs</code></p>
<p>Android Studio:
<code>cocos2d/cocos/platform/android/libcocos2dx/libs</code></p>
</li>
<li>
<p>如果你使用 cocos2d-js 或者 lua ，拷贝 <strong>jar</strong> 文件到:</p>
<p>Android command-line:
<code>frameworks/cocos2d-x/cocos/platform/android/java/libs</code></p>
<p>Android Studio:
<code>frameworks/cocos2d-x/cocos/platform/android/libcocos2dx/libs</code></p>
</li>
<li>
<p>如果你使用 cocos2d-x 预编译包，拷贝 <strong>jar</strong> 文件到：</p>
<p>Android command-line:
<code>proj.android/libs</code></p>
</li>
</ul>
<h4 id="jni">拷贝 jni 库</h4>
<p>从 <code>plugin/android/jni/</code> 拷贝并覆盖 <code>&lt;your_project_root&gt;/jni/</code> 目录.</p>
<h3 id="androidmanifestxml_1">修改 <code>AndroidManifest.xml</code></h3>
<p>添加如下 meta-data :</p>
<pre><code class="xml">&lt;meta-data android:name=&quot;com.google.android.gms.version&quot;
    android:value=&quot;@integer/google_play_services_version&quot; /&gt;
&lt;meta-data android:name=&quot;com.google.android.gms.games.APP_ID&quot;
    android:value=&quot;@string/google_app_id&quot; /&gt;
</code></pre>

<p>请确保添加如下 <code>&lt;string name="google_app_id"&gt;777734739048&lt;/string&gt;</code> 到 <code>res/values/string.xml</code> 中.
一定要用你自己的 google app id 来代替.</p>
<h3 id="androidmk">修改 <code>Android.mk</code></h3>
<p>将 <code>gpg</code> 拷贝到 <code>proj.andrid/jni</code> 目录下</p>
<p>添加如下内容到你的 <code>android.mk</code> 文件中</p>
<h4 id="_13">添加头文件目录</h4>
<pre><code>LOCAL_C_INCLUDES += ./gpg/include/
</code></pre>

<h4 id="_14">添加静态库</h4>
<p>添加静态库到 <strong>LOCAL_WHOLE_STATIC_LIBRARIES</strong>:</p>
<pre><code>LOCAL_WHOLE_STATIC_LIBRARIES += gpg-1
LOCAL_WHOLE_STATIC_LIBRARIES += PluginGPG
LOCAL_WHOLE_STATIC_LIBRARIES += sdkbox
</code></pre>

<p>在 <strong>import-module</strong> 语句之前添加如下调用:</p>
<pre><code>$(call import-add-path,$(LOCAL_PATH))
</code></pre>

<p>在 <strong>import-module</strong> 语句之后添加如下语句:</p>
<pre><code>$(call import-module, ./gpg)
$(call import-module, ./sdkbox)
$(call import-module, ./plugingpg)
</code></pre>

<p><strong>注意:</strong> 如果你使用的是预编译版本, 请一定要确保以上语句是在 <code>$(call import-module,./prebuilt-mk)</code> 之前.</p>
<h3 id="applicationmk-cocos2d-x-v30-to-v32">修改 <code>Application.mk</code> (只适用于 Cocos2d-x v3.0 to v3.2)</h3>
<p>查看 <code>&lt;project_root&gt;/jni/Application.mk</code> 中的 <strong>APP_STL</strong> 是否定义正确. 如果 <code>Application.mk</code> 包含了 <code>APP_STL := c++_static</code> 语句, 那么请改为:</p>
<pre><code>APP_STL := gnustl_static
</code></pre>

<h3 id="appactivityjava">修改 <code>AppActivity.java</code></h3>
<h4 id="2403">插件版本 &gt;= 2.4.0.3</h4>
<ol>
<li>找到 <strong>AppActivity.java</strong> 文件</li>
</ol>
<pre><code class="bash">find . -name &quot;AppActivity.java&quot;
</code></pre>

<ol>
<li>把 <code>extends Cocos2dxActivity</code> 替换为 <code>extends com.sdkbox.plugin.SDKBoxActivity</code></li>
</ol>
<p>以下是 <strong>AppActivity.java</strong> 不同版本的引擎所在的目录：</p>
<pre><code>cpp
  - proj.android/src/org/cocos2dx/cpp/AppActivity.java
  - proj.android-studio/app/src/org/cocos2dx/cpp/AppActivity.java
  - proj.android/app/src/org/cocos2dx/cpp/AppActivity.java ( from cocos2d-x 3.17)

lua
  - frameworks/runtime-src/proj.android/src/org/cocos2dx/lua/AppActivity.java
  - frameworks/runtime-src/proj.android-studio/app/src/org/cocos2dx/lua/AppActivity.java
  - frameworks/runtime-src/proj.android/app/src/org/cocos2dx/lua/AppActivity.java (from cocos2d-x 3.17)

js
  - frameworks/runtime-src/proj.android/src/org/cocos2dx/javascript/AppActivity.java
  - frameworks/runtime-src/proj.android/app/src/org/cocos2dx/javascript/AppActivity.java ( from cocos2d-x 3.17)
</code></pre>

<h4 id="2403_1">插件版本 &lt; 2.4.0.3</h4>
<ul>
<li>
<p>如果您使用 cocos2d-x 源代码，假设您在 <code>proj.android</code> 目录下，那么您可以在如下位置找到 <code>Cocos2dxActivity.java</code> 文件：</p>
<p><code>../../cocos2d-x/cocos/platform/android/java/src/org/cocos2dx/
lib/Cocos2dxActivity.java</code></p>
</li>
<li>
<p>如果您使用 cocos2dx-x 预编译库， 假设您在 <code>proj.android</code> 目录下，那么您可以在如下位置找到 <code>Cocos2dxActivity.java</code> 文件：</p>
<p><code>./src/org/cocos2dx/lib/Cocos2dxActivity.java</code></p>
</li>
</ul>
<p><strong>Note:</strong> 当你使用 cocos2d-x 源代码时，不同的版本中 <code>Cocos2dxActivity.java</code> 文件的位置也不同。一个确定该文件位置的方法是查看 <code>proj.android/project.properties</code> 。比如：</p>
<pre><code>android.library.reference.1=../../cocos2d-x/cocos/platform/android/java
</code></pre>

<p>在这个例子中， <code>Cocos2dxActivity.java</code> 文件应该在如下位置：</p>
<pre><code>../../cocos2d-x/cocos/platform/android/java/src/org/cocos2dx/lib/Cocos2dxActivity.java
</code></pre>

<ul>
<li>修改 <code>Cocos2dxActivity.java</code> 文件，导入如下包：</li>
</ul>
<pre><code class="java">import android.content.Intent;
import com.sdkbox.plugin.SDKBox;
</code></pre>

<ul>
<li>然后，修改 <code>Cocos2dxActivity</code> 类的 <code>onCreate(final Bundle savedInstanceState)</code> 函数，添加一个调用语句 <code>SDKBox.init(this);</code> 。添加的位置非常重要，必须在调用 <code>onLoadNativeLibraries();</code> 之后。如下：</li>
</ul>
<pre><code class="java">onLoadNativeLibraries();
SDKBox.init(this);
</code></pre>

<ul>
<li>
<p>最后, 我需要提供合适的 <strong>overrides</strong> 方法的代码。这里有一些约定如下。</p>
<ul>
<li>
<p>如果这个被列出的方法没有在 <code>SDKBox</code> 中定义，那么__定义它__。</p>
</li>
<li>
<p>如果这个被列出的方法已经被定义在 <code>SDKBox</code> 中，那么请调用这个在 <code>SDKBox</code> 中的__同名方法__。</p>
</li>
</ul>
</li>
</ul>
<pre><code class="java">    @Override
    protected void onActivityResult(int requestCode, int resultCode, Intent data) {
          if(!SDKBox.onActivityResult(requestCode, resultCode, data)) {
            super.onActivityResult(requestCode, resultCode, data);
          }
    }
    @Override
    protected void onStart() {
          super.onStart();
          SDKBox.onStart();
    }
    @Override
    protected void onStop() {
          super.onStop();
          SDKBox.onStop();
    }
    @Override
    protected void onResume() {
          super.onResume();
          SDKBox.onResume();
    }
    @Override
    protected void onPause() {
          super.onPause();
          SDKBox.onPause();
    }
    @Override
    public void onBackPressed() {
          if(!SDKBox.onBackPressed()) {
            super.onBackPressed();
          }
    }
</code></pre>

<h3 id="projectproperties">修改 <code>project.properties</code></h3>
<p>添加 <strong>Google Play Services</strong> Android 库引用, 其路径因你的配置而有所不同.
并且 <strong>Google Play Services</strong> 不是默认下载的, 您需要打开 <strong>sdk installer</strong> ， 选择 <strong>extras-&gt;google play services</strong> 下载并安装。例子:</p>
<pre><code>android.library.reference.1=
../android/sdk.latest/extras/google/google_play_services/libproject/
google-play-services_lib
</code></pre>

<p><strong>注意:</strong> 如果已经存在 <code>android.library.reference.1</code>, 您可以递增数字, 例如 <code>android.library.reference.2</code>, 等等.</p>
<h2 id="proguard">Proguard (可选)</h2>
<ul>
<li>编辑 <code>project.properties</code>,写入一个 <code>Proguard</code> 配置. 例如:</li>
</ul>
<pre><code>proguard.config=${sdk.dir}/tools/proguard/proguard-android.txt:proguard-project.txt
</code></pre>

<ul>
<li>编辑你指定的这个文件，添加如下内容:</li>
</ul>
<pre><code># cocos2d-x
-keep public class org.cocos2dx.** { *; }
-dontwarn org.cocos2dx.**
-keep public class com.chukong.** { *; }
-dontwarn com.chukong.**

# google play service
-keep class com.google.android.gms.** { *; }
-dontwarn com.google.android.gms.**

-keep class * extends java.util.ListResourceBundle {
    protected Object[][] getContents();
}

-keep public class com.google.android.gms.common.internal.safeparcel.SafeParcelable {
    public static final *** NULL;
}

-keepnames @com.google.android.gms.common.annotation.KeepName class *
-keepclassmembernames class * {
    @com.google.android.gms.common.annotation.KeepName *;
}

-keepnames class * implements android.os.Parcelable {
    public static final ** CREATOR;
}

#sdkbox
-keep class com.sdkbox.** { *; }
-dontwarn com.sdkbox.**
</code></pre>

<p><strong>注意:</strong> Proguard 只在 <strong>Release</strong> 编译时有效 (比如 <code>cocos run -m release</code>), debug 不会触发 Proguard.</p></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Build Date UTC : 2020-06-02 04:02:16, Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        
        <script src="../../../js/jquery-1.10.2.min.js"></script>
        <script src="../../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../../js/highlight.pack.js"></script>
        <script>var base_url = '../../..';</script>
        <script src="../../../js/base.js"></script>
        


        
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-70044300-2', 'auto');
            ga('send', 'pageview');
        </script>
        
    </body>
</html>
