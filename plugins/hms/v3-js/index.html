<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">

	<title>Huawei Mobile Services(HMS) with Javascript - SDKBOX</title>
        
        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../../../css/base.css?2" rel="stylesheet">
        <link rel="stylesheet" href="../../../css/highlight.css">
        <link href="../../../css/custom.css" rel="stylesheet">
        

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="http://sdkbox.com"><img src="http://www.cocos2d-x.org/s/sdkbox/SDKBOX_logo.png">Docs</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">

            <ul class="nav navbar-nav navbar-right">


            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../../..">简介</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Cocos <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../cocos/">安装方式</a>
</li>

                        
                            
<li >
    <a href="../../../installer/">命令行工具</a>
</li>

                        
                            
<li >
    <a href="../../../qa/cocos_creator/">Creator集成</a>
</li>

                        
                            
  
  <li class="dropdown-submenu">
    <a tabindex="-1" class="non-link">SDK插件</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../achievement/">Achievements</a>
</li>

        
            
  

        
            
<li >
    <a href="../../adcolony/">AdColony</a>
</li>

        
            
  

        
            
<li >
    <a href="../../admob/">AdMob</a>
</li>

        
            
  

        
            
<li >
    <a href="../../agecheq/">AgeCheq</a>
</li>

        
            
  

        
            
<li >
    <a href="../../appnext/">Appnext</a>
</li>

        
            
  

        
            
<li >
    <a href="../../appodeal/">Appodeal</a>
</li>

        
            
  

        
            
<li >
    <a href="../../amazon/">Amazon</a>
</li>

        
            
  

        
            
<li >
    <a href="../../apteligent/">Apteligent</a>
</li>

        
            
  

        
            
<li >
    <a href="../../bee7/">Bee7</a>
</li>

        
            
  

        
            
<li >
    <a href="../../chartboost/">Chartboost</a>
</li>

        
            
  

        
            
<li >
    <a href="../../ethwallet/">EthWallet</a>
</li>

        
            
<li >
    <a href="../../facebook/">Facebook</a>
</li>

        
            
  

        
            
<li >
    <a href="../../gameroom/">Facebook Gameroom</a>
</li>

        
            
  

        
            
<li >
    <a href="../../firebase/">Firebase</a>
</li>

        
            
  

        
            
<li >
    <a href="../../flurryanalytics/">Flurry Analytics</a>
</li>

        
            
  

        
            
<li >
    <a href="../../fyber/">Fyber</a>
</li>

        
            
  

        
            
<li >
    <a href="../../googleanalytics/">Google Analytics</a>
</li>

        
            
  

        
            
<li >
    <a href="../../googleplay/">Google Play Game</a>
</li>

        
            
  

        
            
<li >
    <a href="../">Huawei Mobile Services</a>
</li>

        
            
  

        
            
<li >
    <a href="../../iap/">In-App Purchase</a>
</li>

        
            
  

        
            
<li >
    <a href="../../inmobi/">InMobi</a>
</li>

        
            
  

        
            
<li >
    <a href="../../kochava/">Kochava</a>
</li>

        
            
  

        
            
<li >
    <a href="../../leadbolt/">LeadBolt</a>
</li>

        
            
  

        
            
<li >
    <a href="../../leaderboard/">Leaderboard</a>
</li>

        
            
  

        
            
<li >
    <a href="../../misc/">Misc</a>
</li>

        
            
  

        
            
<li >
    <a href="../../playphone/">Playphone</a>
</li>

        
            
  

        
            
<li >
    <a href="../../review/">Ratings & Reviews</a>
</li>

        
            
  

        
            
<li >
    <a href="../../sdkboxads/">SDKBOX Ads</a>
</li>

        
            
  

        
            
<li >
    <a href="../../sdkboxplay/">SDKBOX Play</a>
</li>

        
            
  

        
            
<li >
    <a href="../../share/">Social Sharing</a>
</li>

        
            
  

        
            
<li >
    <a href="../../tune/">Tune</a>
</li>

        
            
  

        
            
<li >
    <a href="../../unityads/">UnityAds</a>
</li>

        
            
  

        
            
<li >
    <a href="../../valuepotion/">Valuepotion</a>
</li>

        
            
  

        
            
<li >
    <a href="../../vungle/">Vungle</a>
</li>

        
            
  

        
            
<li >
    <a href="../../youtube/">Youtube</a>
</li>

        
            
  

        
    </ul>
  </li>
  

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Unity <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../unity/iap/">In-App Purchase</a>
</li>

                        
                            
<li >
    <a href="../../../unity/review/">Ratings & Reviews</a>
</li>

                        
                            
<li >
    <a href="../../../unity/socialshare/">SocialShare</a>
</li>

                        
                            
<li >
    <a href="../../../unity/googleanalytics/documentation/">Google Analytics</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Unreal <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../unreal/iap/">In-App Purchase</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">LiveOps <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../liveops/">使用介绍</a>
</li>

                        
                            
<li >
    <a href="../../../liveops/remote-config/">远程配置</a>
</li>

                        
                            
<li >
    <a href="../../../liveops/receipt-verification/">服务器端IAP订单校验</a>
</li>

                        
                            
<li >
    <a href="../../../liveops/catalog-management/">即时可购买项目管理</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">指南 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../qa/installgoogleplaystore/">GooglePlay安装指南</a>
</li>

                        
                            
<li >
    <a href="../../../qa/integration-admob-to-creator/">AdMob集成指南</a>
</li>

                        
                            
<li >
    <a href="../../../qa/sdkbox-for-create-usage/">SDKBoxGUI For Creator介绍</a>
</li>

                        
                            
<li >
    <a href="../../../qa/crypt-sdkbox-config/">保护 sdkbox_config.json</a>
</li>

                        
                            
<li >
    <a href="../../../qa/sdkboxplay_troubleshoot/">SDKBoxPlay相关问题</a>
</li>

                        
                            
<li >
    <a href="../../../qa/iap_troubleshoot/">IAP相关问题</a>
</li>

                        
                            
<li >
    <a href="../../../qa/sdkbox_installer_issue/">Installer相关问题</a>
</li>

                        
                        </ul>
                    </li>
                
                

                <li style="margin-left:30px">
 <a href="http://sdkbox-doc.github.io/en/">English</a>
                </li>
                
                </ul>
            




            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#_1">集成</a></li>
        <li class="main "><a href="#china">~~从 China 服务器下载~~ 服务器已停止</a></li>
        <li class="main "><a href="#_2">重点注意事项</a></li>
            <li><a href="#_3">禁用应用程序安全传输策略</a></li>
            <li><a href="#bitcode">禁止 Bitcode 支持</a></li>
            <li><a href="#_4">游戏全屏配置</a></li>
            <li><a href="#canopenurl">canOpenURL 白名单</a></li>
            <li><a href="#json">JSON 配置</a></li>
            <li><a href="#ios">iOS 测试</a></li>
            <li><a href="#android">Android 测试</a></li>
        <li class="main "><a href="#_5">使用</a></li>
            <li><a href="#hms">初始化 HMS</a></li>
            <li><a href="#_6">登录</a></li>
            <li><a href="#_7">登出</a></li>
            <li><a href="#hms_1">请求托管在 HMS 的商品</a></li>
            <li><a href="#_8">购买托管商品</a></li>
            <li><a href="#_9">购买非托管商品</a></li>
            <li><a href="#_10">请求拥有的商品</a></li>
            <li><a href="#_11">消费商品</a></li>
            <li><a href="#_12">请求所有的消费记录</a></li>
            <li><a href="#_13">玩家信息</a></li>
            <li><a href="#_18">成就</a></li>
            <li><a href="#_25">事件</a></li>
            <li><a href="#_27">排行榜</a></li>
            <li><a href="#_32">存档</a></li>
            <li><a href="#_33">浮标</a></li>
            <li><a href="#hms_2">处理HMS事件</a></li>
        <li class="main "><a href="#api-reference">API Reference</a></li>
            <li><a href="#methods">Methods</a></li>
            <li><a href="#listeners">Listeners</a></li>
        <li class="main "><a href="#_34">手动集成</a></li>
        <li class="main "><a href="#ios_1">iOS 平台手动集成</a></li>
        <li class="main "><a href="#android_1">Android 平台手动集成</a></li>
            <li><a href="#_35">拷贝文件</a></li>
            <li><a href="#buildgradle">修改 build.gradle</a></li>
            <li><a href="#androidmanifestxml">编辑 AndroidManifest.xml</a></li>
            <li><a href="#androidmk">编辑 Android.mk</a></li>
            <li><a href="#applicationmk-cocos2d-x-v30-v32">编辑 Application.mk （只限 Cocos2d-x v3.0 到 v3.2 版本）</a></li>
            <li><a href="#appactivityjava">修改 AppActivity.java</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<p><a href="../">&#8249; HMS Doc Home</a></p>
<h1>HMS 集成指南</h1>

<h4><em><b>For the Javascript version of cocos2d-x v3.x</b> - (<a href="./../">all other versions</a>)</em></h4>

<h2 id="_1">集成</h2>
<p>用如下命令来集成 SDKBOX HMS 插件,请确保您可以正常执行的 SDKBOX 安装器.</p>
<pre><code class="bash">sdkbox import hms
</code></pre>

<h2 id="china">~~从 China 服务器下载~~ 服务器已停止</h2>
<p>如果你在中国, 并且下载插件的速度比较慢, 可以尝试使用位于中国的服务器来下载, 查询插件, 使用方法为在你的 <code>sdkbox import</code> 后加 <code>--server china</code> 及可, 比如:</p>
<pre><code class="bash">sdkbox import xxx  --server china
</code></pre>

<p>xxx 为你的插件名字</p>
<h2 id="_2">重点注意事项</h2>
<p>如果您升级到了 Xcode7, 则需要以下额外步骤来确保插件工作正常:</p>
<h4 id="_3">禁用应用程序安全传输策略</h4>
<p>添加以下项到 plist:</p>
<pre><code>&lt;key&gt;NSAppTransportSecurity&lt;/key&gt;
&lt;dict&gt;
    &lt;key&gt;NSAllowsArbitraryLoads&lt;/key&gt;
    &lt;true/&gt;
&lt;/dict&gt;
</code></pre>

<p>添加后的文件内容看起来就像这样：</p>
<p><img alt="" src="../../../imgs/ATS.png" /></p>
<h4 id="bitcode">禁止 Bitcode 支持</h4>
<p>您必须禁止 <strong>Bitcode</strong> 的支持，否则将会编译失败。</p>
<h4 id="_4">游戏全屏配置</h4>
<p>如果您的游戏不同时支持横竖屏，则必须在 Xcode 中选中 <code>Requires full screen</code>，否则将不会通过 Apple 的审核。</p>
<h4 id="canopenurl">canOpenURL 白名单</h4>
<p>取决于您使用哪些插件。需要在 <code>info.plist</code> 的 <code>LSApplicationQueriesSchemes</code> 下添加名单。</p>
<h3 id="json">JSON 配置</h3>
<p>SDKBOX 安装器会自动在您的工程中添加一个样例配置文件<code>sdkbox_config.json</code>.在您编译工程前,请修改里面的参数,用您自己的应用信息</p>
<p>这里HMS的配置样例.</p>
<pre><code class="json">&quot;ios&quot; :
{
    &quot;hms&quot;:{
    }
},
&quot;android&quot;:
{
    &quot;hms&quot;:{
        &quot;archive&quot;: true,
        &quot;key&quot;: &quot;MIIBojANBgkqhkiG9w0BAQEFAAOCAY8AMIIBigKCAYEAn9U6yC1QI8cXGRkOQxO9QG/WV8dR4jZDCYt/GJBM4OTTtRZeAIEyVifGPutwMAkPBLgdUsJwHuA2t2jrBAi/nagYJvh8UIazKJv5C4Hykw5Z2iKTWMmiMK9rQ2tMtRTAMiY+LwfaOH2258bEyt8mDQxyG3aRSAH28mZki/nGEbNfx7ZY9By/SSkuaCEWRDNYdiWkGDuZLhf8D97DoJJc6tTnrDPmzf1QqkVDjjudkHJwgCMWpLVACzGGuo4YQYt98Pu9cqbiYWJqSHqEbPYN0AmGXdJw+tO5f1wPcZWnJhn4JqCFmD9i/dSENNJWXVDgJc0DG2PiWX5j+qUaT7WkZMs4/WFtL6VRdRUDzITqYwKUUBYENVvkfdKlhjh+6V4BFKPsipvjOsRdXDpZ7sC6MY/7yn0eMOH3RoIQoiWeGYkxRTkKhdm/QQ/Xv/dvMbiicsNmUIkBce3w4hQG9XlhgjNrl5rI4p9Ho3Stq48s7DJlhWuUE6pXcjo2TJUSJ9+nAgMBAAE=&quot;,
        &quot;items&quot;: {
            &quot;remove_ads&quot;: {
                &quot;type&quot;: &quot;non_consumable&quot;,
                &quot;id&quot;: &quot;com.sdkbox.test.app.sample.noad&quot;
            },
            &quot;coin&quot;: {
                &quot;id&quot;: &quot;com.sdkbox.test.app.sample.coin1&quot;
            },
            &quot;vip&quot;: {
                &quot;type&quot;: &quot;subs&quot;,
                &quot;id&quot;: &quot;com.sdkbox.test.app.sample.vip&quot;
            }
        },
        &quot;achievements&quot;: [{
            &quot;name&quot;: &quot;freshman&quot;,
            &quot;id&quot;: &quot;A7346279E90AB8910AAC0CB71E552BFA2505DFD7591C79457F84D6B95F50FFEC&quot;,
            &quot;incremental&quot;: false
        }, {
            &quot;name&quot;: &quot;3shoot&quot;,
            &quot;id&quot;: &quot;BA8B1A486D422AEF28FF82F9BFF85C3F156824396E0BB62D92BECC63C3CAC46A&quot;,
            &quot;incremental&quot;: true
        }, {
            &quot;name&quot;: &quot;5shoot&quot;,
            &quot;id&quot;: &quot;001D38EC9E1A80A52ED3F47BFBA35F4B5BDF3776180A2B9AD778800C45CD6540&quot;,
            &quot;incremental&quot;: true
        }],
        &quot;events&quot;: [{
            &quot;name&quot;: &quot;gencoin&quot;,
            &quot;id&quot;: &quot;912764D10F0988B9DCB041A4E6FE453BCBDEDC4E35708A60E33C2DEBF05F2D2E&quot;
        }, {
            &quot;name&quot;: &quot;consumecoin&quot;,
            &quot;id&quot;: &quot;E8688F3D9625572F462F5999E7F83EB5628E0FC1F2044E84D026EC4AB33C09F5&quot;
        }],
        &quot;rankings&quot;: [{
            &quot;name&quot;: &quot;shooter&quot;,
            &quot;id&quot;: &quot;C8B96FA1EDFC2D87DFE9491409440E3F8B2E39AFB8BD7E95C3BE337FC207C253&quot;
        }]
    }
}
</code></pre>

<p>同时你还需要在 HMS 的 AppGallery 里将对应的应用信息文件 <code>agconnect-services.json</code> 下载下来，并放在应用工程目录下(一般来说是在 proj.android/app 目录).</p>
<h3 id="ios">iOS 测试</h3>
<ul>
<li>HMS 不支持 iOS 平台, 在 iOS 其实是一个空的实现</li>
</ul>
<h3 id="android">Android 测试</h3>
<ol>
<li>在 AppGallery 中创建一个 app</li>
<li>启起你想要使用的模块(比如你要使用登录, 就可以启用AccountKit)</li>
<li>添加app的签名hash</li>
<li>下载应用的信息文件 <code>agconnect-services.json</code></li>
</ol>
<p>HMS 的官方<a href="https://developer.huawei.com/consumer/hms">文档</a></p>
<h2 id="_5">使用</h2>
<h3 id="hms">初始化 HMS</h3>
<ul>
<li>在您的代码合适的地方调用 <code>init()</code> 完成初始化. 我们推荐在 <code>app.js</code> 中完成初始化.比如:</li>
</ul>
<pre><code class="javascript">sdkbox.HMS.init();
</code></pre>

<ul>
<li>修改 <code>./frameworks/runtime-src/Classes/AppDelegate.cpp</code> 包含如下头文件:</li>
</ul>
<pre><code class="javascript">#include &quot;PluginHMSJS.hpp&quot;
#include &quot;PluginHMSJSHelper.h&quot;
</code></pre>

<ul>
<li>修改 <code>./frameworks/runtime-src/Classes/AppDelegate.cpp</code> 确保调用了如下函数:</li>
</ul>
<pre><code class="javascript">sc-&gt;addRegisterCallback(register_all_PluginHMSJS);
sc-&gt;addRegisterCallback(register_all_PluginHMSJS_helper);
</code></pre>

<h3 id="_6">登录</h3>
<p>HMS 提供了三种登录方式:</p>
<ul>
<li>Signing In with HUAWEI ID(ID Token)</li>
</ul>
<pre><code class="javascript">sdkbox.HMS.login(1);
</code></pre>

<ul>
<li>Signing In with HUAWEI ID(Authorization Code)</li>
</ul>
<pre><code class="javascript">sdkbox.HMS.login(2);
</code></pre>

<ul>
<li>Silently Signing In With HUAWEI ID</li>
</ul>
<p>静默登录只能在上一次使用前两种方式已经登录成功的情况下，才能在静态登录下成功</p>
<pre><code class="javascript">sdkbox.HMS.login(0);
</code></pre>

<blockquote>
<p>以上三种登录方式, 不管成功还是失败, 最终都会触发 <code>onLogin</code> 事件.</p>
</blockquote>
<p>HMS 帐号相关的 <a href="https://developer.huawei.com/consumer/en/doc/development/HMS-Guides/account-guide-v4">文档</a></p>
<h3 id="_7">登出</h3>
<pre><code class="javascript">sdkbox.HMS.logout();
</code></pre>

<h3 id="hms_1">请求托管在 HMS 的商品</h3>
<p>托管商品是指在 HMS 管理后台配置的商品.</p>
<pre><code class="javascript">sdkbox.HMS.iapRequestProducts();
</code></pre>

<p>这个方法会触发 Listener 中的 <code>onIAPProducts</code> 方法</p>
<h3 id="_8">购买托管商品</h3>
<pre><code class="javascript">sdkbox.HMS.iapPurchase(&quot;coin&quot;);
</code></pre>

<p>这个方法会触发 Listener 中的 <code>onIAPPurchase</code> 方法</p>
<h3 id="_9">购买非托管商品</h3>
<p>非托管商品是指未在 HMS 后台配置商品, 但使用 HMS IAP 的来支付.</p>
<pre><code class="javascript">let productInfo = {
  priceType: 0, // 0:consumable 1:non-consumable 2:subscription
  productName: 'product name',
  productId: 'product id',
  amount: '1.00',
  currency: 'CNY',
  country: 'CN',
  sdkChannel: '1', // sdkChannel size must be between 0 and 4
  serviceCatalog: 'X58',
  reservedInfor: '{&quot;a&quot;: 1, &quot;b&quot;:&quot;s&quot;}', // reservedInfor must be json string
  developerPayload: 'payload1'
};
sdkbox.HMS.iapPurchaseWithPrice(JSON.stringify(productInfo));
</code></pre>

<p>这个方法会触发 Listener 中的 <code>onIAPPurchase</code> 方法</p>
<h3 id="_10">请求拥有的商品</h3>
<p>请求当前拥有的商品的购买记录, 包括 不可消费，订阅商品 和 非消费的可消费商品.</p>
<pre><code class="javascript">sdkbox.HMS.iapRequestOwnedPurchases();
</code></pre>

<p>这个方法会触发 Listener 中的 <code>onIAPOwnedPurchases</code> 方法</p>
<h3 id="_11">消费商品</h3>
<p>注意: 这里传的是 purchaseToken , 非不是商品名字或id</p>
<pre><code class="javascript">sdkbox.HMS.iapConsume(purchaseToken);
</code></pre>

<p>这个方法会触发 Listener 中的 <code>onIAPPConsume</code> 方法</p>
<h3 id="_12">请求所有的消费记录</h3>
<p>请求用户所有的消费记录</p>
<pre><code class="javascript">sdkbox.HMS.iapRequestOwnedPurchaseRecords(purchaseToken);
</code></pre>

<p>这个方法会触发 Listener 中的 <code>onIAPOwnedPurchaseRecords</code> 方法</p>
<h3 id="_13">玩家信息</h3>
<h4 id="_14">获取玩家信息</h4>
<p>将会触发 Listener 中的函数 <code>onPlayerInfo</code></p>
<pre><code class="javascript">sdkbox.HMS.playerRequestInfo();
</code></pre>

<h4 id="_15">获取玩家额外信息</h4>
<p>这里主要是针对 未成年防沉迷 机制, 可以取得玩家是否未成年人，它的游戏时间等信息, 开发者利用这些信息对防沉迷作相应处理.</p>
<p>将会触发 Listener 中的函数 <code>onPlayerExtraInfo</code></p>
<pre><code class="javascript">sdkbox.HMS.playerRequestInfo();
</code></pre>

<h4 id="_16">提交游戏开始</h4>
<p>提交玩家开始游戏事件</p>
<p>将会触发 Listener 中的函数 <code>onPlayerGameBegin</code></p>
<pre><code class="javascript">sdkbox.HMS.playerSubmitGameBegin();
</code></pre>

<h4 id="_17">提交游戏结束</h4>
<p>提交玩家结束游戏事件</p>
<p>将会触发 Listener 中的函数 <code>onPlayerGameEnd</code></p>
<pre><code class="javascript">sdkbox.HMS.playerSubmitGameEnd();
</code></pre>

<h3 id="_18">成就</h3>
<h4 id="_19">取成就列表</h4>
<p>获取成就列表, 开发者可以使用返回的数据来自行展示</p>
<p>将会触发 Listener 中的函数 <code>onAchievementList</code></p>
<pre><code class="javascript">sdkbox.HMS.achievementRequestList();
</code></pre>

<h4 id="_20">显示成就</h4>
<p>使用华为默认的成就显示列表</p>
<p>将会触发 Listener 中的函数 <code>onAchievementShow</code></p>
<pre><code class="javascript">sdkbox.HMS.achievementShow();
</code></pre>

<h4 id="_21">成就可见</h4>
<p>将会触发 Listener 中的函数 <code>onAchievementVisualize</code></p>
<pre><code class="javascript">sdkbox.HMS.achievementVisualize();
</code></pre>

<h4 id="_22">增长成就</h4>
<p>将会触发 Listener 中的函数 <code>onAchievementGrow</code></p>
<pre><code class="javascript">sdkbox.HMS.achievementGrow();
</code></pre>

<h4 id="_23">设置成就步骤</h4>
<p>将会触发 Listener 中的函数 <code>onAchievementMakeSteps</code></p>
<pre><code class="javascript">sdkbox.HMS.achievementMakeSteps();
</code></pre>

<h4 id="_24">解锁成就</h4>
<pre><code class="javascript">sdkbox.HMS.achievementReach();
</code></pre>

<h3 id="_25">事件</h3>
<h4 id="_26">增长事件</h4>
<pre><code class="javascript">sdkbox.HMS.eventGrow(event, amount);
</code></pre>

<h4 id="eventrequestlist">eventRequestList</h4>
<p>将会触发 Listener 中的函数 <code>onEventList</code></p>
<pre><code class="javascript">sdkbox.HMS.eventRequestList();
</code></pre>

<h3 id="_27">排行榜</h3>
<h4 id="_28">检查排行榜状态</h4>
<p>在进行排行榜相关api前，开发者必检查玩家是否允许上传分数.</p>
<p>将会触发 Listener 中的函数 <code>onRankingSwitchStatus</code></p>
<pre><code class="javascript">sdkbox.HMS.rankingRequestSwitchStatus();
</code></pre>

<p>将会触发 Listener 中的函数 <code>onRankingSetSwitchStatus</code></p>
<pre><code class="javascript">int status = 0;
// 0: allow open score in ranking
// 1: not allow open score in ranking

sdkbox.HMS.rankingSetSwitchStatus(int status);
</code></pre>

<h4 id="_29">提交分数</h4>
<p>将会触发 Listener 中的函数 <code>onRankingSubmitScore</code></p>
<pre><code class="javascript">sdkbox.HMS.rankingSubmitScore(rankingName, score, score_unit);
</code></pre>

<h4 id="_30">显示排行榜</h4>
<p>开发者自行显示</p>
<p>将会触发 Listener 中的函数 <code>onRankingList</code></p>
<pre><code class="javascript">bool realtime = true; // true, will request data from hms server; false, will use local cache data
sdkbox.HMS.rankingRequestList(realtime, rankingName);
</code></pre>

<p>用华为默认列表显示
(此方式必须保证玩家终端EMUI为9.0及以上版本，且必须安装10.3及以上版本的华为应用助手。)</p>
<p>将会触发 Listener 中的函数 <code>onRankingShow</code></p>
<pre><code class="javascript">int timeDimension = 2; // 0-&gt; day, 1-&gt; week, 2-&gt; all time
sdkbox.HMS.rankingShow(timeDimension, rankingName);
</code></pre>

<h4 id="_31">取分数</h4>
<p>当前玩家的分数</p>
<p>将会触发 Listener 中的函数 <code>onRankingCurPlayerScore</code></p>
<pre><code class="javascript">int timeDimension = 2; // 0-&gt; day, 1-&gt; week, 2-&gt; all time
sdkbox.HMS.rankingRequestCurPlayerScore(rankingName, timeDimension);
</code></pre>

<p>取以玩家分数为中心的分数列表</p>
<p>将会触发 Listener 中的函数 <code>onRankingPlayerCenteredScores</code></p>
<pre><code class="javascript">int timeDimension = 2; // 0-&gt; day, 1-&gt; week, 2-&gt; all time
sdkbox.HMS.rankingRequestPlayerCenteredScores(rankingName, timeDimension, realtime);
</code></pre>

<h3 id="_32">存档</h3>
<p>新增存档</p>
<p>将会触发 Listener 中的函数 <code>onArchiveAdd</code></p>
<pre><code class="javascript">sdkbox.HMS.archiveAdd(playedTime, progress, description, supportCache,
                               bmBytes, bmBytesLen, bmBytesType,
                               dataBytes, dataBytesLen);
</code></pre>

<p>更新存档</p>
<p>将会触发 Listener 中的函数 <code>onArchiveUpdate</code></p>
<pre><code class="javascript">sdkbox.HMS.archiveUpdate(archiveId,
                          playedTime, progress, description,
                          bmBytes, bmBytesLen, bmBytesType,
                          dataBytes, dataBytesLen);
</code></pre>

<p>读存档</p>
<p>将会触发 Listener 中的函数 <code>onArchiveLoad</code></p>
<pre><code class="javascript">int conflictPolicy = 3;
//-1 -&gt; hms willn't hand conflict, 
//1  -&gt; hms will resolved conflict by played time, 
//2  -&gt; hms will resolved conflict by progress,
//3  -&gt; hms will resolved conflict by last update time
sdkbox.HMS.archiveLoad(archiveId, conflictPolicy);
</code></pre>

<h3 id="_33">浮标</h3>
<p>如果你的游戏将在中国发行，那必须打开游戏浮标</p>
<pre><code class="javascript">sdkbox.HMS.buoyShow();
//or
sdkbox.HMS.buoyHide();
</code></pre>

<h3 id="hms_2">处理HMS事件</h3>
<p>您可以接收 <code>HMS</code> 事件, 不同事件对您的用户及 HMS 服务器做不同的处理.</p>
<p>所有的回调中都包含一个 code , 这值的含义可以参与如下 url :</p>
<ul>
<li>https://developer.huawei.com/consumer/cn/doc/development/HMS-References/game-return-code-v4</li>
<li>https://developer.huawei.com/consumer/cn/doc/development/HMS-References/hms-error-code</li>
</ul>
<p>这里单独列出常见的一些值的含义:</p>
<p>7020: 本地cache中没有数据
7022: 未实名或未成年人
7024: 手机中没有安装 "华为应用市场"
7218: 华为应用市场中的游戏服务未打开，或用户取消
7204: 需要安装应用助手最新版
7013: 未登录帐号 或 在调用 Archive 相关接口时报这个错，也可能是 sdkbox_config 中的 archive 未设置为 true</p>
<pre><code class="javascript">sdkbox.HMS.setListener({
    // Account
    onLogin: function (code, msg) {
        // login event
    },

    // Player Info
    onPlayerInfo: function(code, errorOrJson) {
    },

    onPlayerExtraInfo: function(code, errorOrJson) {
    },

    onPlayerGameBegin: function(code, errorOrJson) {
    },

    onPlayerGameEnd: function(code, errorOrJson) {
    },

    // IAP
    onIAPReady: function(code, msg) {
        self.log('HMS Listener onIAPReady:' + code);
        cc.log(msg);
    },
    onIAPProducts: function(code, msg) {
        self.log('HMS Listener onIAPProducts:' + code);
        cc.log(msg);
    },
    onIAPPurchase: function(code, msg) {
        self.log('HMS Listener onIAPPurchase:' + code);
        cc.log(msg);
    },
    onIAPPConsume: function(code, msg) {
        self.log('HMS Listener onIAPPConsume:' + code);
        cc.log(msg);
    },
    onIAPOwnedPurchases: function(code, msg) {
        self.log('HMS Listener onIAPOwnedPurchases:' + code);
        cc.log(msg);
    },
    onIAPOwnedPurchaseRecords: function(code, msg) {
        self.log('HMS Listener onIAPOwnedPurchaseRecords:' + code);
        cc.log(msg);
    },

    // Achievement
    onAchievementList(code, errorOrJson) {
    }

    onAchievementShow(code, errorOrJson) {
    }

    onAchievementVisualize(code, errorOrJson) {
    }

    onAchievementGrow(code, errorOrJson) {
    }

    onAchievementMakeSteps(code, errorOrJson) {
    }

    // Event
    onEventList(code, errorOrJson) {
    }

    // Ranking
    onRankingSwitchStatus(code, errorOrJson) {
    }

    onRankingSetSwitchStatus(code, errorOrJson) {
    }

    onRankingSubmitScore(code, errorOrJson) {
    }

    onRankingShow(code, errorOrJson) {
    }

    onRankingList(code, errorOrJson) {
    }

    onRankingCurPlayerScore(code, errorOrJson) {
    }

    onRankingPlayerCenteredScores(code, errorOrJson) {
    }

    onRankingMoreScores(code, errorOrJson) {
    }

    onRankingTopScores(code, errorOrJson) {
    }

    // Archive
    onArchiveLimitThumbnailSize(code, errorOrJson) {
    }

    onArchiveLimitDetailsSize(code, errorOrJson) {
    }

    onArchiveAdd(code, errorOrJson) {
    }

    onArchiveShow(code, errorOrJson) {
    }

    onArchiveSummaryList(code, errorOrJson) {
    }

    onArchiveSelect(code, errorOrJson) {
    }

    onArchiveThumbnail(code, errorOrJson, coverData:Uint8Array) {
    }

    onArchiveUpdate(code, errorOrJson) {
    }

    onArchiveLoad(code, errorOrJson, contentData:Uint8Array) {
    }

    onArchiveRemove(code, errorOrJson) {
    }

    // Game Stats
    onGamePlayerStats(code, errorOrJson) {
    }

    onGameSummary(code, errorOrJson) {
    }


});
</code></pre>

<h2 id="api-reference">API Reference</h2>
<h3 id="methods">Methods</h3>
<pre><code class="javascript">sdkbox.PluginHMS.setGDPR(enabled);
</code></pre>

<blockquote>
<p>Set GDPR</p>
</blockquote>
<pre><code class="javascript">sdkbox.PluginHMS.init();
</code></pre>

<blockquote>
<p>initialize the plugin instance.</p>
</blockquote>
<pre><code class="javascript">sdkbox.PluginHMS.setListener(listener);
</code></pre>

<blockquote>
<p>Set listener to listen for adcolony events</p>
</blockquote>
<pre><code class="javascript">sdkbox.PluginHMS.login(loginType);
</code></pre>

<blockquote>
<p>HMS provider three way to login
loginType: 0, slient login 1, login with HuaweiID(ID Token) 2, login with HuaweID(Authorization Code)</p>
</blockquote>
<pre><code class="javascript">sdkbox.PluginHMS.logout();
</code></pre>

<blockquote>
<p>logout HMS</p>
</blockquote>
<pre><code class="javascript">sdkbox.PluginHMS.playerRequestInfo();
</code></pre>

<blockquote>
<p>request current player info</p>
</blockquote>
<pre><code class="javascript">sdkbox.PluginHMS.playerRequestExtraInfo();
</code></pre>

<blockquote>
<p>request player extra info</p>
</blockquote>
<pre><code class="javascript">sdkbox.PluginHMS.playerSubmitGameBegin();
</code></pre>

<blockquote>
<p>submit game begin event</p>
</blockquote>
<pre><code class="javascript">sdkbox.PluginHMS.playerSubmitGameEnd();
</code></pre>

<blockquote>
<p>submit game end event</p>
</blockquote>
<pre><code class="javascript">sdkbox.PluginHMS.iapRequestProducts();
</code></pre>

<pre><code class="javascript">sdkbox.PluginHMS.iapPurchase(name);
</code></pre>

<pre><code class="javascript">sdkbox.PluginHMS.iapPurchaseWithPrice(productJson);
</code></pre>

<pre><code class="javascript">sdkbox.PluginHMS.iapRequestOwnedPurchases();
</code></pre>

<pre><code class="javascript">sdkbox.PluginHMS.iapConsume(purchaseToken);
</code></pre>

<pre><code class="javascript">sdkbox.PluginHMS.iapRequestOwnedPurchaseRecords();
</code></pre>

<pre><code class="javascript">sdkbox.PluginHMS.achievementRequestList();
</code></pre>

<pre><code class="javascript">sdkbox.PluginHMS.achievementShow();
</code></pre>

<pre><code class="javascript">sdkbox.PluginHMS.achievementVisualize(name);
</code></pre>

<pre><code class="javascript">sdkbox.PluginHMS.achievementGrow(achiveName, steps);
</code></pre>

<pre><code class="javascript">sdkbox.PluginHMS.achievementMakeSteps(achiveName, steps);
</code></pre>

<pre><code class="javascript">sdkbox.PluginHMS.achievementReach(achiveName);
</code></pre>

<pre><code class="javascript">sdkbox.PluginHMS.eventGrow(eventName, amount);
</code></pre>

<pre><code class="javascript">sdkbox.PluginHMS.eventRequestList(realtime, eventNamas);
</code></pre>

<pre><code class="javascript">sdkbox.PluginHMS.rankingRequestSwitchStatus();
</code></pre>

<blockquote>
<p>request if player allow open score in ranking</p>
</blockquote>
<pre><code class="javascript">sdkbox.PluginHMS.rankingSetSwitchStatus(status);
</code></pre>

<blockquote>
<p>request if player allow open score in ranking
status: 0-&gt;player allow submit score, 1-&gt;player not allow submit score</p>
</blockquote>
<pre><code class="javascript">sdkbox.PluginHMS.rankingSubmitScore(rankingName, score, unit);
</code></pre>

<blockquote>
<p>submit score to ranking</p>
</blockquote>
<pre><code class="javascript">sdkbox.PluginHMS.rankingShow(timeDimension, rankingName);
</code></pre>

<blockquote>
<p>use hms's ui to show ranking</p>
</blockquote>
<pre><code class="javascript">sdkbox.PluginHMS.rankingRequestList(realtime, rankingName);
</code></pre>

<blockquote>
<p>request ranking list</p>
</blockquote>
<pre><code class="javascript">sdkbox.PluginHMS.rankingRequestCurPlayerScore(rankingName, timeDimension);
</code></pre>

<blockquote>
<p>request current player ranking score</p>
</blockquote>
<pre><code class="javascript">sdkbox.PluginHMS.rankingRequestPlayerCenteredScores(rankingName,
                                                     timeDimension,
                                                     size,
                                                     realtime);
</code></pre>

<blockquote>
<p>request player centered scores</p>
</blockquote>
<pre><code class="javascript">sdkbox.PluginHMS.rankingRequestMoreScores(rankingName,
                                           timeDimension,
                                           offset,
                                           pageSize,
                                           pageDirection);
</code></pre>

<blockquote>
<p>request more scores</p>
</blockquote>
<pre><code class="javascript">sdkbox.PluginHMS.rankingRequestTopScores(rankingName,
                                          timeDimension,
                                          offset,
                                          pageSize,
                                          pageDirection);
</code></pre>

<blockquote>
<p>submit score to ranking</p>
</blockquote>
<pre><code class="javascript">sdkbox.PluginHMS.archiveRequestLimitThumbnailSize();
</code></pre>

<blockquote>
<p>get thumbnail max size</p>
</blockquote>
<pre><code class="javascript">sdkbox.PluginHMS.archiveRequestLimitDetailsSize();
</code></pre>

<blockquote>
<p>get detail max size</p>
</blockquote>
<pre><code class="javascript">sdkbox.PluginHMS.archiveAdd(playedTime,
                             progress,
                             description,
                             supportCache,
                             bmBytes,
                             bmBytesLen,
                             bmBytesType,
                             dataBytes,
                             dataBytesLen);
</code></pre>

<blockquote>
<p>add archive</p>
</blockquote>
<pre><code class="javascript">sdkbox.PluginHMS.archiveShow(title, allowAdd, allowDelete, pageSize);
</code></pre>

<blockquote>
<p>use hms's default ui to show archive</p>
</blockquote>
<pre><code class="javascript">sdkbox.PluginHMS.archiveRequestSummaryList(realtime);
</code></pre>

<blockquote>
<p>request archive summay list, developer can show custome archive list with the returned data</p>
</blockquote>
<pre><code class="javascript">sdkbox.PluginHMS.archiveRequestThumbnail(archiveId);
</code></pre>

<blockquote>
<p>request archive cover thumbnail</p>
</blockquote>
<pre><code class="javascript">sdkbox.PluginHMS.archiveUpdate(archiveId,
                                playedTime,
                                progress,
                                description,
                                bmBytes,
                                bmBytesLen,
                                bmBytesType,
                                dataBytes,
                                dataBytesLen);
</code></pre>

<blockquote>
<p>update archive</p>
</blockquote>
<pre><code class="javascript">sdkbox.PluginHMS.archiveLoad(archiveId, conflictPolicy);
</code></pre>

<blockquote>
<p>load archive</p>
</blockquote>
<pre><code class="javascript">sdkbox.PluginHMS.archiveRemove(archiveId);
</code></pre>

<blockquote>
<p>remvoe archive</p>
</blockquote>
<pre><code class="javascript">sdkbox.PluginHMS.gamePlayerStatsRequest(realtime);
</code></pre>

<blockquote>
<p>request game player statistics</p>
</blockquote>
<pre><code class="javascript">sdkbox.PluginHMS.gameSummaryRequest(realtime);
</code></pre>

<blockquote>
<p>request game summary</p>
</blockquote>
<pre><code class="javascript">sdkbox.PluginHMS.buoyShow();
</code></pre>

<pre><code class="javascript">sdkbox.PluginHMS.buoyHide();
</code></pre>

<h3 id="listeners">Listeners</h3>
<pre><code class="javascript">onLogin(code, errorOrJson);
</code></pre>

<pre><code class="javascript">onPlayerInfo(code, errorOrJson);
</code></pre>

<pre><code class="javascript">onPlayerExtraInfo(code, errorOrJson);
</code></pre>

<pre><code class="javascript">onPlayerGameBegin(code, errorOrJson);
</code></pre>

<pre><code class="javascript">onPlayerGameEnd(code, errorOrJson);
</code></pre>

<pre><code class="javascript">onIAPReady(code, errorOrJson);
</code></pre>

<pre><code class="javascript">onIAPProducts(code, errorOrJson);
</code></pre>

<pre><code class="javascript">onIAPPurchase(code, errorOrJson);
</code></pre>

<pre><code class="javascript">onIAPPConsume(code, errorOrJson);
</code></pre>

<pre><code class="javascript">onIAPOwnedPurchases(code, errorOrJson);
</code></pre>

<pre><code class="javascript">onIAPOwnedPurchaseRecords(code, errorOrJson);
</code></pre>

<pre><code class="javascript">onAchievementList(code, errorOrJson);
</code></pre>

<pre><code class="javascript">onAchievementShow(code, errorOrJson);
</code></pre>

<pre><code class="javascript">onAchievementVisualize(code, errorOrJson);
</code></pre>

<pre><code class="javascript">onAchievementGrow(code, errorOrJson);
</code></pre>

<pre><code class="javascript">onAchievementMakeSteps(code, errorOrJson);
</code></pre>

<pre><code class="javascript">onAchievementReach(code, errorOrJson);
</code></pre>

<pre><code class="javascript">onEventList(code, errorOrJson);
</code></pre>

<pre><code class="javascript">onRankingSwitchStatus(code, errorOrJson);
</code></pre>

<pre><code class="javascript">onRankingSetSwitchStatus(code, errorOrJson);
</code></pre>

<pre><code class="javascript">onRankingSubmitScore(code, errorOrJson);
</code></pre>

<blockquote>
<p>callback for rankingSubmitScore</p>
</blockquote>
<pre><code class="javascript">onRankingShow(code, errorOrJson);
</code></pre>

<blockquote>
<p>callback for rankingShow</p>
</blockquote>
<pre><code class="javascript">onRankingList(code, errorOrJson);
</code></pre>

<blockquote>
<p>callback for rankingRequestList</p>
</blockquote>
<pre><code class="javascript">onRankingCurPlayerScore(code, errorOrJson);
</code></pre>

<blockquote>
<p>callback for rankingRequestCurPlayerScore</p>
</blockquote>
<pre><code class="javascript">onRankingPlayerCenteredScores(code, errorOrJson);
</code></pre>

<blockquote>
<p>callback for rankingRequestPlayerCenteredScores</p>
</blockquote>
<pre><code class="javascript">onRankingMoreScores(code, errorOrJson);
</code></pre>

<blockquote>
<p>callback for rankingRequestMoreScores</p>
</blockquote>
<pre><code class="javascript">onRankingTopScores(code, errorOrJson);
</code></pre>

<blockquote>
<p>callback for rankingRequestTopScores</p>
</blockquote>
<pre><code class="javascript">onArchiveLimitThumbnailSize(code, errorOrJson);
</code></pre>

<blockquote>
<p>callback for archiveRequestLimitThumbnailSize</p>
</blockquote>
<pre><code class="javascript">onArchiveLimitDetailsSize(code, errorOrJson);
</code></pre>

<blockquote>
<p>callback for archiveRequestLimitDetailsSize</p>
</blockquote>
<pre><code class="javascript">onArchiveAdd(code, errorOrJson);
</code></pre>

<blockquote>
<p>callback for archiveAdd</p>
</blockquote>
<pre><code class="javascript">onArchiveShow(code, errorOrJson);
</code></pre>

<blockquote>
<p>callback for archiveShow</p>
</blockquote>
<pre><code class="javascript">onArchiveSummaryList(code, errorOrJson);
</code></pre>

<blockquote>
<p>callback for archiveRequestSummaryList</p>
</blockquote>
<pre><code class="javascript">onArchiveSelect(code, errorOrJson);
</code></pre>

<blockquote>
<p>callback when user select archive</p>
</blockquote>
<pre><code class="javascript">onArchiveThumbnail(code, errorOrJson, coverData, coverDataLen);
</code></pre>

<blockquote>
<p>callback for archiveRequestThumbnail</p>
</blockquote>
<pre><code class="javascript">onArchiveUpdate(code, errorOrJson);
</code></pre>

<blockquote>
<p>callback for archiveUpdate</p>
</blockquote>
<pre><code class="javascript">onArchiveLoad(code, errorOrJson, contentData, contentDataLen);
</code></pre>

<blockquote>
<p>callback for archiveLoad</p>
</blockquote>
<pre><code class="javascript">onArchiveRemove(code, errorOrJson);
</code></pre>

<blockquote>
<p>callback for archiveRemove</p>
</blockquote>
<pre><code class="javascript">onGamePlayerStats(code, errorOrJson);
</code></pre>

<blockquote>
<p>callback for gamePlayerStatsRequest</p>
</blockquote>
<pre><code class="javascript">onGameSummary(code, errorOrJson);
</code></pre>

<blockquote>
<p>callback for gameSummaryRequest</p>
</blockquote>
<h2 id="_34">手动集成</h2>
<p>如果 <em>SDKBOX 安装器</em> 安装插件失败了，那么需要手动集成插件.如果安装器安装插件成功了,那么不需要，也没必要,按文档再手动集成一次.</p>
<p>下面列出的的步骤一般很少用到.如果你按下面的步骤完成了集成，请在完成集成后，再按步骤检查一次.</p>
<h2 id="ios_1">iOS 平台手动集成</h2>
<p>Drag and drop the following frameworks from the <strong>plugins/ios</strong> folder of the <code>HMS</code> bundle into your Xcode project, check <code>Copy items if needed</code> when adding frameworks:
拖拽下列 framework 从 <code>HMS</code> 插件包的 <strong>plugins/ios</strong> 目录到您的 Xcode 工程中，在添加 frameworks 的时候，请勾选 <code>Copy items if needed</code> 。</p>
<blockquote>
<p>sdkbox.framework</p>
<p>PluginHMS.framework</p>
</blockquote>
<p>上面的 frameworks 依赖于其他 frameworks。如果您没有添加它们，您也需要添加下列这些 frameworks：</p>
<blockquote>
<p>SystemConfiguration.framework</p>
</blockquote>
<p>把 <code>plugin/jsbindings</code> 文件夹中所有的头文件和源文件都拷贝到你的工程的 <code>Classes</code> 文件夹中.</p>
<p>把刚刚拷贝的文件拖动到 Xcode 中或使用 <strong>File -&gt; Add files to...</strong> 来添加.</p>
<h2 id="android_1">Android 平台手动集成</h2>
<h3 id="_35">拷贝文件</h3>
<p>从插件安装包中的 <code>plugin/android/libs</code> 目录拷贝下列 <strong>jar</strong> 文件到您的工程的 <strong>proj.android/libs</strong> 目录。</p>
<blockquote>
<p>PluginHMS.jar</p>
<p>sdkbox.jar</p>
</blockquote>
<ul>
<li>
<p>如果你使用 cocos2d-x 源码，拷贝 <strong>jar</strong> 文件到：</p>
<p>Android command-line:
<code>cocos2d/cocos/platform/android/java/libs</code></p>
<p>Android Studio:
<code>cocos2d/cocos/platform/android/libcocos2dx/libs</code></p>
</li>
<li>
<p>如果你使用 cocos2d-js 或者 lua ，拷贝 <strong>jar</strong> 文件到:</p>
<p>Android command-line:
<code>frameworks/cocos2d-x/cocos/platform/android/java/libs</code></p>
<p>Android Studio:
<code>frameworks/cocos2d-x/cocos/platform/android/libcocos2dx/libs</code></p>
</li>
<li>
<p>如果你使用 cocos2d-x 预编译包，拷贝 <strong>jar</strong> 文件到：</p>
<p>Android command-line:
<code>proj.android/libs</code></p>
</li>
</ul>
<p>从 <code>plugin/android/jni</code> 目录拷贝 <code>pluginhms</code> 以及 <code>sdkbox</code> 目录到您的工程的 <code>proj.android/jni</code> 目录。如果 <code>sdkbox</code> 目录在工程中已经存在，请覆盖它。</p>
<h3 id="buildgradle">修改 <code>build.gradle</code></h3>
<p>你对 build.gradle 的修改可能会类似于下面的修改:</p>
<p>工程的根目录下的 build.gradle 修改</p>
<pre><code class="gradle">
buildscript {
    repositories {
        google()
        jcenter()
        maven { url 'https://developer.huawei.com/repo/' } // for hms
    }
    dependencies {
        classpath 'com.android.tools.build:gradle:3.4.1'
        classpath 'com.huawei.agconnect:agcp:1.2.1.301' // for hms
    }
}

allprojects {
    repositories {
        google()
        jcenter()
        maven { url 'https://developer.huawei.com/repo/' } // for hms
    }
}

</code></pre>

<p>应用级的 build.gradle 修改</p>
<pre><code class="gradle">apply plugin: 'com.android.application'
apply plugin: 'com.huawei.agconnect' // for hms

...

dependencies {
    ...
    implementation 'com.huawei.hms:base:4.0.4.301' // for hms
    implementation 'com.huawei.hms:hwid:4.0.4.300' // for hms
    implementation 'com.huawei.hms:iap:4.0.2.300' // for hms
    implementation 'com.huawei.hms:game:4.0.3.301' // for hms
}

</code></pre>

<h3 id="androidmanifestxml">编辑 <code>AndroidManifest.xml</code></h3>
<p>在标签 <strong>application tag</strong> 上添加下列权限：</p>
<pre><code class="xml">&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;
&lt;uses-permission android:name=&quot;android.permission.ACCESS_NETWORK_STATE&quot; /&gt;
&lt;uses-permission android:name=&quot;com.android.vending.BILLING&quot;/&gt;
</code></pre>

<h3 id="androidmk">编辑 <code>Android.mk</code></h3>
<p>编辑 <code>proj.android/jni/Android.mk</code>：</p>
<p>为 <strong>LOCAL_STATIC_LIBRARIES</strong> 添加额外的库：</p>
<pre><code>LOCAL_STATIC_LIBRARIES += PluginHMS
LOCAL_STATIC_LIBRARIES += sdkbox
</code></pre>

<p>在所有 <strong>import-module</strong> 语句之前添加一条 call 语句：</p>
<pre><code>$(call import-add-path,$(LOCAL_PATH))
</code></pre>

<p>在最后添加额外的 <strong>import-module</strong> 语句：</p>
<pre><code>$(call import-module, ./sdkbox)
$(call import-module, ./pluginhms)
</code></pre>

<p>这意味着您的语句顺序看起来像是这样：</p>
<pre><code>$(call import-add-path,$(LOCAL_PATH))
$(call import-module, ./sdkbox)
$(call import-module, ./pluginhms)
</code></pre>

<p><strong>Note:</strong> 如果您使用的是 cocos2d-x 预编译库，那么保证这些语句在已有的 <code>$(call import-module,./prebuilt-mk)</code> 语句之上非常重要。</p>
<h3 id="applicationmk-cocos2d-x-v30-v32">编辑 <code>Application.mk</code> （只限 Cocos2d-x v3.0 到 v3.2 版本）</h3>
<p>编辑 <code>proj.android/jni/Application.mk</code> 保证 <strong>APP_STL</strong> 的定义正确。如果 <code>Application.mk</code> 包含了 <code>APP_STL := c++_static</code> 语句，那么这条语句应该被改为：</p>
<pre><code>APP_STL := gnustl_static
</code></pre>

<p>把 <code>plugin/jsbindings</code> 文件夹中所有的头文件和源文件都拷贝到你的工程的 <code>Classes</code> 文件夹中.</p>
<p>把你刚刚拷贝的 <code>.cpp</code> 文件添加到 <code>Android.mk</code> 文件的的 <strong>LOCAL_SRC_FILES</strong> 项.比如</p>
<pre><code>LOCAL_SRC_FILES := hellocpp/main.cpp \
                  ../../Classes/AppDelegate.cpp \
                  ../../Classes/HelloWorldScene.cpp \
                                    ../../Classes/NewSourceFile.cpp
</code></pre>

<h3 id="appactivityjava">修改 <code>AppActivity.java</code></h3>
<h4 id="2403">插件版本 &gt;= 2.4.0.3</h4>
<ol>
<li>找到 <strong>AppActivity.java</strong> 文件</li>
</ol>
<pre><code class="bash">find . -name &quot;AppActivity.java&quot;
</code></pre>

<ol>
<li>把 <code>extends Cocos2dxActivity</code> 替换为 <code>extends com.sdkbox.plugin.SDKBoxActivity</code></li>
</ol>
<p>以下是 <strong>AppActivity.java</strong> 不同版本的引擎所在的目录：</p>
<pre><code>cpp
  - proj.android/src/org/cocos2dx/cpp/AppActivity.java
  - proj.android-studio/app/src/org/cocos2dx/cpp/AppActivity.java
  - proj.android/app/src/org/cocos2dx/cpp/AppActivity.java ( from cocos2d-x 3.17)

lua
  - frameworks/runtime-src/proj.android/src/org/cocos2dx/lua/AppActivity.java
  - frameworks/runtime-src/proj.android-studio/app/src/org/cocos2dx/lua/AppActivity.java
  - frameworks/runtime-src/proj.android/app/src/org/cocos2dx/lua/AppActivity.java (from cocos2d-x 3.17)

js
  - frameworks/runtime-src/proj.android/src/org/cocos2dx/javascript/AppActivity.java
  - frameworks/runtime-src/proj.android/app/src/org/cocos2dx/javascript/AppActivity.java ( from cocos2d-x 3.17)
</code></pre>

<h4 id="2403_1">插件版本 &lt; 2.4.0.3</h4>
<ul>
<li>
<p>如果您使用 cocos2d-x 源代码，假设您在 <code>proj.android</code> 目录下，那么您可以在如下位置找到 <code>Cocos2dxActivity.java</code> 文件：</p>
<p><code>../../cocos2d-x/cocos/platform/android/java/src/org/cocos2dx/
lib/Cocos2dxActivity.java</code></p>
</li>
<li>
<p>如果您使用 cocos2dx-x 预编译库， 假设您在 <code>proj.android</code> 目录下，那么您可以在如下位置找到 <code>Cocos2dxActivity.java</code> 文件：</p>
<p><code>./src/org/cocos2dx/lib/Cocos2dxActivity.java</code></p>
</li>
</ul>
<p><strong>Note:</strong> 当你使用 cocos2d-x 源代码时，不同的版本中 <code>Cocos2dxActivity.java</code> 文件的位置也不同。一个确定该文件位置的方法是查看 <code>proj.android/project.properties</code> 。比如：</p>
<pre><code>android.library.reference.1=../../cocos2d-x/cocos/platform/android/java
</code></pre>

<p>在这个例子中， <code>Cocos2dxActivity.java</code> 文件应该在如下位置：</p>
<pre><code>../../cocos2d-x/cocos/platform/android/java/src/org/cocos2dx/lib/Cocos2dxActivity.java
</code></pre>

<ul>
<li>修改 <code>Cocos2dxActivity.java</code> 文件，导入如下包：</li>
</ul>
<pre><code class="java">import android.content.Intent;
import com.sdkbox.plugin.SDKBox;
</code></pre>

<ul>
<li>然后，修改 <code>Cocos2dxActivity</code> 类的 <code>onCreate(final Bundle savedInstanceState)</code> 函数，添加一个调用语句 <code>SDKBox.init(this);</code> 。添加的位置非常重要，必须在调用 <code>onLoadNativeLibraries();</code> 之后。如下：</li>
</ul>
<pre><code class="java">onLoadNativeLibraries();
SDKBox.init(this);
</code></pre>

<ul>
<li>
<p>最后, 我需要提供合适的 <strong>overrides</strong> 方法的代码。这里有一些约定如下。</p>
<ul>
<li>
<p>如果这个被列出的方法没有在 <code>SDKBox</code> 中定义，那么__定义它__。</p>
</li>
<li>
<p>如果这个被列出的方法已经被定义在 <code>SDKBox</code> 中，那么请调用这个在 <code>SDKBox</code> 中的__同名方法__。</p>
</li>
</ul>
</li>
</ul>
<pre><code class="java">    @Override
    protected void onActivityResult(int requestCode, int resultCode, Intent data) {
          if(!SDKBox.onActivityResult(requestCode, resultCode, data)) {
            super.onActivityResult(requestCode, resultCode, data);
          }
    }
    @Override
    protected void onStart() {
          super.onStart();
          SDKBox.onStart();
    }
    @Override
    protected void onStop() {
          super.onStop();
          SDKBox.onStop();
    }
    @Override
    protected void onResume() {
          super.onResume();
          SDKBox.onResume();
    }
    @Override
    protected void onPause() {
          super.onPause();
          SDKBox.onPause();
    }
    @Override
    public void onBackPressed() {
          if(!SDKBox.onBackPressed()) {
            super.onBackPressed();
          }
    }
</code></pre></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Build Date UTC : 2020-06-19 04:17:28, Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        
        <script src="../../../js/jquery-1.10.2.min.js"></script>
        <script src="../../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../../js/highlight.pack.js"></script>
        <script>var base_url = '../../..';</script>
        <script src="../../../js/base.js"></script>
        


        
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-70044300-2', 'auto');
            ga('send', 'pageview');
        </script>
        
    </body>
</html>
