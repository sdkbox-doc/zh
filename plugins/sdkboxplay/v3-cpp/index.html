<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">

	<title>Play with C++ - SDKBOX</title>
        
        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../../../css/base.css?2" rel="stylesheet">
        <link rel="stylesheet" href="../../../css/highlight.css">
        <link href="../../../css/custom.css" rel="stylesheet">
        

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="http://sdkbox.com"><img src="http://www.cocos2d-x.org/s/sdkbox/SDKBOX_logo.png">Docs</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">

            <ul class="nav navbar-nav navbar-right">


            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../../..">简介</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Cocos <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../cocos/">安装方式</a>
</li>

                        
                            
<li >
    <a href="../../../installer/">命令行工具</a>
</li>

                        
                            
<li >
    <a href="../../../qa/cocos_creator/">Creator集成</a>
</li>

                        
                            
  
  <li class="dropdown-submenu">
    <a tabindex="-1" class="non-link">SDK插件</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../achievement/">Achievements</a>
</li>

        
            
  

        
            
<li >
    <a href="../../adcolony/">AdColony</a>
</li>

        
            
  

        
            
<li >
    <a href="../../admob/">AdMob</a>
</li>

        
            
  

        
            
<li >
    <a href="../../agecheq/">AgeCheq</a>
</li>

        
            
  

        
            
<li >
    <a href="../../appnext/">Appnext</a>
</li>

        
            
  

        
            
<li >
    <a href="../../appodeal/">Appodeal</a>
</li>

        
            
  

        
            
<li >
    <a href="../../amazon/">Amazon</a>
</li>

        
            
  

        
            
<li >
    <a href="../../apteligent/">Apteligent</a>
</li>

        
            
  

        
            
<li >
    <a href="../../bee7/">Bee7</a>
</li>

        
            
  

        
            
<li >
    <a href="../../chartboost/">Chartboost</a>
</li>

        
            
  

        
            
<li >
    <a href="../../ethwallet/">EthWallet</a>
</li>

        
            
<li >
    <a href="../../facebook/">Facebook</a>
</li>

        
            
  

        
            
<li >
    <a href="../../gameroom/">Facebook Gameroom</a>
</li>

        
            
  

        
            
<li >
    <a href="../../firebase/">Firebase</a>
</li>

        
            
  

        
            
<li >
    <a href="../../flurryanalytics/">Flurry Analytics</a>
</li>

        
            
  

        
            
<li >
    <a href="../../fyber/">Fyber</a>
</li>

        
            
  

        
            
<li >
    <a href="../../googleanalytics/">Google Analytics</a>
</li>

        
            
  

        
            
<li >
    <a href="../../googleplay/">Google Play Game</a>
</li>

        
            
  

        
            
<li >
    <a href="../../hms/">Huawei Mobile Services</a>
</li>

        
            
  

        
            
<li >
    <a href="../../iap/">In-App Purchase</a>
</li>

        
            
  

        
            
<li >
    <a href="../../inmobi/">InMobi</a>
</li>

        
            
  

        
            
<li >
    <a href="../../kochava/">Kochava</a>
</li>

        
            
  

        
            
<li >
    <a href="../../leadbolt/">LeadBolt</a>
</li>

        
            
  

        
            
<li >
    <a href="../../leaderboard/">Leaderboard</a>
</li>

        
            
  

        
            
<li >
    <a href="../../misc/">Misc</a>
</li>

        
            
  

        
            
<li >
    <a href="../../playphone/">Playphone</a>
</li>

        
            
  

        
            
<li >
    <a href="../../review/">Ratings & Reviews</a>
</li>

        
            
  

        
            
<li >
    <a href="../../sdkboxads/">SDKBOX Ads</a>
</li>

        
            
  

        
            
<li >
    <a href="../">SDKBOX Play</a>
</li>

        
            
  

        
            
<li >
    <a href="../../share/">Social Sharing</a>
</li>

        
            
  

        
            
<li >
    <a href="../../signinwithapple/">Sign in with Apple</a>
</li>

        
            
  

        
            
<li >
    <a href="../../tune/">Tune</a>
</li>

        
            
  

        
            
<li >
    <a href="../../unityads/">UnityAds</a>
</li>

        
            
  

        
            
<li >
    <a href="../../valuepotion/">Valuepotion</a>
</li>

        
            
  

        
            
<li >
    <a href="../../vungle/">Vungle</a>
</li>

        
            
  

        
            
<li >
    <a href="../../youtube/">Youtube</a>
</li>

        
            
  

        
    </ul>
  </li>
  

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Unity <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../unity/iap/">In-App Purchase</a>
</li>

                        
                            
<li >
    <a href="../../../unity/review/">Ratings & Reviews</a>
</li>

                        
                            
<li >
    <a href="../../../unity/socialshare/">SocialShare</a>
</li>

                        
                            
<li >
    <a href="../../../unity/googleanalytics/documentation/">Google Analytics</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Unreal <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../unreal/iap/">In-App Purchase</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">LiveOps <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../liveops/">使用介绍</a>
</li>

                        
                            
<li >
    <a href="../../../liveops/remote-config/">远程配置</a>
</li>

                        
                            
<li >
    <a href="../../../liveops/receipt-verification/">服务器端IAP订单校验</a>
</li>

                        
                            
<li >
    <a href="../../../liveops/catalog-management/">即时可购买项目管理</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">指南 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../qa/installgoogleplaystore/">GooglePlay安装指南</a>
</li>

                        
                            
<li >
    <a href="../../../qa/integration-admob-to-creator/">AdMob集成指南</a>
</li>

                        
                            
<li >
    <a href="../../../qa/install_sdkbox/">SDKBox安装</a>
</li>

                        
                            
<li >
    <a href="../../../qa/crypt-sdkbox-config/">保护 sdkbox_config.json</a>
</li>

                        
                            
<li >
    <a href="../../../qa/sdkboxplay_troubleshoot/">SDKBoxPlay相关问题</a>
</li>

                        
                            
<li >
    <a href="../../../qa/iap_troubleshoot/">IAP相关问题</a>
</li>

                        
                            
<li >
    <a href="../../../qa/sdkbox_installer_issue/">Installer相关问题</a>
</li>

                        
                            
<li >
    <a href="../../../qa/cmake_xcframework/">CMake With XCFramework</a>
</li>

                        
                        </ul>
                    </li>
                
                

                <li style="margin-left:30px">
 <a href="http://sdkbox-doc.github.io/en/">English</a>
                </li>
                
                </ul>
            




            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#_1">前提条件</a></li>
            <li><a href="#google-play">Google play</a></li>
            <li><a href="#game-center">Game Center</a></li>
        <li class="main "><a href="#_2">集成</a></li>
            <li><a href="#json">JSON 配置</a></li>
        <li class="main "><a href="#_3">使用</a></li>
            <li><a href="#sdkboxplay">初始化 SdkboxPlay</a></li>
            <li><a href="#sdkboxplay_1">使用 SdkboxPlay</a></li>
            <li><a href="#sdkboxplay_2">SdkboxPlay 事件</a></li>
        <li class="main "><a href="#api-reference">API Reference</a></li>
            <li><a href="#methods">Methods</a></li>
            <li><a href="#listeners">Listeners</a></li>
        <li class="main "><a href="#_6">手动集成</a></li>
        <li class="main "><a href="#ios">iOS 平台手动集成</a></li>
        <li class="main "><a href="#android">Android 手动集成</a></li>
            <li><a href="#_7">拷贝文件</a></li>
            <li><a href="#androidmanifestxml">编辑 AndroidManifest.xml</a></li>
            <li><a href="#androidmk">编辑 Android.mk</a></li>
            <li><a href="#applicationmk">编辑 Application.mk</a></li>
            <li><a href="#appactivityjava">修改 AppActivity.java</a></li>
        <li class="main "><a href="#proguard-release">使用 Proguard （release模式下可选）</a></li>
        <li class="main "><a href="#_8">游戏存档</a></li>
            <li><a href="#ios_1">iOS 云存储</a></li>
            <li><a href="#_9">用法</a></li>
        <li class="main "><a href="#_13">服务器认证</a></li>
            <li><a href="#ios_2">iOS</a></li>
            <li><a href="#android_1">Android</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<p><a href="../">&#8249; SdkboxAds Doc Home</a></p>
<h1>SdkboxPlay 集成指南</h1>

<h4><em><b>For the C++ version of cocos2d-x v3.x</b> - (<a href="./../">all other versions</a>)</em></h4>

<h2 id="_1">前提条件</h2>
<h3 id="google-play">Google play</h3>
<ul>
<li>根据 <a href="https://developers.google.com/games/services/console/enabling#step_2_add_your_game_to_the_dev_console">这篇 google 官方文档</a> 为您的工程打开游戏服务并且创建一个 app 。否则，您的工程将不能连接到 google play 。</li>
<li>使用开发者控制台配置 Leaderboards 以及 Achievements 。</li>
</ul>
<h3 id="game-center">Game Center</h3>
<ul>
<li>在 XCode 上打开 Game Center 选项。</li>
<li>使用开发者平台配置 Leaderboards 以及 Achievements，必须要至少添加一条。</li>
<li>Game Center需要登录你设置ITunesconnect设置过的测试帐号（不用有些资料说的必需新建帐号）。</li>
</ul>
<h2 id="_2">集成</h2>
<p>在您确保正确安装了 SDKBOX installer 的情况下，运行下面的命令来集成 SDKBOX Youtube 插件。</p>
<pre><code class="bash">$ sdkbox import sdkboxplay
</code></pre>

<!--## Configuration
### SDKBOX Cloud
SDKBOX Cloud enables developers to receive the benefits of a centralized application management interface, by helping to boost their applications with extended functionality. The two main features are: __Remote Application Management__ which provides the abilities of updating and testing, and __IAP Receipt Verification__.

Developers must register at Chukong’s website to get __developers credentials__. After receiving __developers credentials__, developers can register an unlimited number of __applications__. Each __application__ will have an associated __application token__ and a __application secret__. These are used to securely transmit new plugin configurations to the clients as well as grant access to all the remotely accessible services.

### Remote Application Configuration
SDKBOX allows developers to create a __Remote Application Configuration__ for each application they are developing.

Registering the applications’ allows for on-the-fly update of its plugin’s configuration. For example, it will allow the change of the Google Analytics tracking code, switch to a new AdColony campaign or add new in-app purchase products without rebuilding and redeploying your apps to the app stores.

To enable this cloud service in your applications is as easy as calling a single __init()__ function and passing in your __application token__ and __application secret__ that were provided when you created the app in the previous section.

<pre><code>sdkbox::init( &lt;application token&gt;, &lt;application secret&gt; );
</code></pre>

  __Note__: each application will have it’s own __application token__ and each configuration for each game will have it’s own __application secret__. The __application secret__ is the actual encryption key used to decipher the remote configuration.

When the developer updates a __Remote Application Configuration__ the application will automatically pull the new configuration and put it into effect. This means that you can update configuration information on the fly and everyone playing your game will get updated the next time the user starts the application!

To ensure security, during normal execution the new configuration is locally saved in the applications’s private folder, and the next time it restarts it is applied. Also, configurations are cyphered and its contents are not exposed, even if your application runs on a rooted/jailbroken device.
-->

<h3 id="json">JSON 配置</h3>
<p>SDKBOX Installer 将会自动在您的 <code>sdkbox_config.json</code> 中插入一份配置样例。请修改这份配置样例，使其能用于您自己的 app 。</p>
<p>这里有一份 SdkboxPlay 配置的例子：</p>
<pre><code class="json">    &quot;sdkboxplay&quot; : {
      &quot;leaderboards&quot; : [
        {
          &quot;id&quot; : &quot;CgkI0sux8sMWEAIQAA&quot;,
          &quot;name&quot; : &quot;ldb1&quot;
        }
      ],
      &quot;achievements&quot; : [
        {
          &quot;id&quot; : &quot;CgkI0sux8sMWEAIQAg&quot;,
          &quot;name&quot; : &quot;ten-games&quot;,
          &quot;incremental&quot; : false
        },
        {
          &quot;id&quot; : &quot;CgkI0sux8sMWEAIQAw&quot;,
          &quot;name&quot; : &quot;hunter&quot;,
          &quot;incremental&quot; : false
        },
        ...
      ],
      &quot;debug&quot; : true,
      &quot;connect_on_start&quot; : false
    }

</code></pre>

<p>如上例所示，Leaderboards 以及 Achievements 都有一个可读性较高的 name, 以及一个机器生成的 id 。这样做的目的是能够通过它们在不同的平台下使用 API 。相比 Google Play 产生的如上所示的随机 ID ，iOS Game Center 产生的 ID 更具可读性。
无论哪个平台，开发者总是通过 name 去使用 Leaderboards 以及 Achievements， 就像下面的示例代码中所看到的那样。</p>
<!---->

<h2 id="_3">使用</h2>
<h3 id="sdkboxplay">初始化 SdkboxPlay</h3>
<p>在您的代码的合适的位置初始化这个插件，我们建议您在 <code>AppDelegate:applicationDidFinishLaunching()</code> 或者 <code>AppController:didFinishLaunchingWithOptions()</code> 中进行初始化。并确保您的代码中包含了正确的头文件。举例如下：</p>
<pre><code class="cpp">#include &quot;PluginSdkboxPlay/PluginSdkboxPlay.h&quot;
AppDelegate::applicationDidFinishLaunching()
{
     sdkbox::PluginSdkboxPlay::init();
}
</code></pre>

<h3 id="sdkboxplay_1">使用 SdkboxPlay</h3>
<h4 id="_4">介绍</h4>
<p>SdkboxPlay 插件 是一个针对 Google Play 以及 Game Center 社交服务的抽象。针对每个平台，在通用的 API 下访问 Leaderboards 以及 Achievements 插件。
为了能适用于两个插件平台，SdkboxPlay 在实现上做了一些权衡，具体细节将在文档的相关部分描述。</p>
<h5 id="achievements">Achievements</h5>
<p>Achievements 插件在不同的开发者平台上有不同的定义。
以下是在 GooglePlay 以及 GameCenter 下 Achievements 插件一些概念上的不同：
* Google Play 区分普通成就以及可累积的成就。Google 保持对可累计成就的进度持续追踪。而普通成就只能达成一次。
* 在 Game Center 下 Achievements 所有的成就都是可累计成就， 但是 Game Center 并不持续跟踪这些成就的进度。这些成就将在游戏过程中被达成。并且这些成就可以被重复解锁多次。
* Google Play 有新解锁成就的概念（第一次解锁），而Game Center则有可周期性解锁的成就。这两个概念是互补的。</p>
<p>为了使以上概念统一， SdkboxPlay API 做了如下设计：</p>
<ul>
<li>允许您定义非累计式的成就。对于 iOS 平台来说，就是将累计值设为100的累计式的成就，因为这表明这个成就即将被解锁（并只解锁一次）。</li>
<li>允许您定义累计式的成就。在 GooglePlay 平台下，累计式插件可以在 app 控制台定义自己的解锁值。</li>
<li>为了保持一致，建议您定义 Google Play 下的成就的解锁值为100。这个值也是 Game Center 下的成就解锁值。</li>
</ul>
<h5 id="leaderboards">Leaderboards</h5>
<p>Leaderboards 插件在不同的开发者平台上有不同的定义。
为了简单，当前的 SdkboxPlay 实现不允许定义组队排行榜。但是对于两个平台您都可以定义任意数量的排行榜。
尽管 GooglePlay 和 GameCenter 都可以采用相同的方式定义排行榜，但是在运行是二者还是有区别的：</p>
<ul>
<li>Google Play 会为每一个排行榜创建三种时间表的排行：每天，每周以及全时间段的排行。</li>
<li>Game Center 则只会创建一个时间表的排行。</li>
</ul>
<p>这一点不同在下面的回调方法中也将会看到。</p>
<h4 id="usage">Usage</h4>
<p>调用 <code>sdkbox::SdkboxPlay::init()</code> 将会配置在 sdkox_config.json 文件中定义的排行榜以及成就系统。</p>
<p>首先，为了连接一个游戏服务平台必须调用下列方法：</p>
<pre><code class="cpp">sdkbox::PluginSdkboxPlay::signin();
</code></pre>

<p>如果连接成功，您将可以通过下列 API 来使用 SdkboxPlay：</p>
<h5 id="leaderboards_1">Leaderboards</h5>
<pre><code class="cpp">void submitScore(   const std::string&amp; leaderboard_name, int score )
</code></pre>

<p>这个方法发送一个更新请求给排行榜。排行榜的名字必须是在配置文件中所定义的。
如果该请求发送给一个不存在的排行榜，那么该请求将不起任何作用。
是否存储这个更新请求的值，取决与开发者控制台配置（比如：总是存储最新的分数，或者总是存储最高分）。
这个方法还将触发下面的毁掉方法：</p>
<pre><code class="cpp">void onScoreSubmitted(
        const std::string&amp; leaderboard_name,
        int score,
        bool maxScoreAllTime,
        bool maxScoreWeek,
        bool maxScoreToday )
</code></pre>

<p>对于 iOS 来说，仅有一个时间表排行，所以后面3个参数都是 false 。</p>
<pre><code class="cpp">void showLeaderboard( const std::string&amp; leaderboard_name );
</code></pre>

<p>这个方法请求显示排行榜信息。这将会在不同平台下显示平台特有的 UI 。对于 iOS 来说，显示排行榜与显示成就的 UI 并没有什么区别，所以这个方法在 iOS 下只是会显示排行榜的视图。</p>
<h5 id="achievements_1">Achievements</h5>
<pre><code class="cpp">void unlockAchievement( const std::string&amp; achievement_name );
</code></pre>

<p>解锁一个非累计式的成就。这在 iOS 平台上， 将会发送一个请求给 Game Center 使得一个累计式成就直接达到100点从而解锁。
如果这个成就在配置文件中定义的不正确（错误的 ID），或者 SdkboxPlay 认为成就的类型不正确（是在Google Play下的累计式成就）,那么这个方法就会静默失败。
如果该方法成功，那么就会触发一个监听事件：onAchievementUnlocked( const std::string&amp; achievement_name, bool newlyUnlocked) 。</p>
<pre><code class="cpp">void incrementAchievement(
    const std::string&amp; achievement_name,
    int increment );
</code></pre>

<p>增加累计式成就的解锁点数。
如果这个成就在配置文件里定义不正确（错误的或者已经存在的 ID ），或者 SdkboxPlay 认为成就的类型不正确，那么这个方法就会静默失败。
如果这个方法调用成功，它将触发下列两个回调事件：</p>
<ul>
<li>如果这个累计式成就还没有达到解锁的点数，那么就触发 <code>onIncrementalAchievementStep( const std::string&amp; achievement_name, int step )</code> 。</li>
<li>如果这个累计式成就达到点数第一次被解锁，那么就触发 <code>onIncrementalAchievementUnlocked( const std::string&amp; achievement_name, bool newlyUnlocked)</code> 。</li>
</ul>
<pre><code class="cpp">void showAchievements( );
</code></pre>

<p>这个方法显示默认的成就视图。这个视图将只显示公开的成就。针对不同的平台显示特定的信息。比如该成就是否解锁，剩余的解锁步骤（仅适用于 Google Play ）平台，总共获得的经验值等等。</p>
<h5 id="_5">游戏数据云保存</h5>
<pre><code class="cpp">void loadAllGameData();
</code></pre>

<p>加载所有保存在云中的数据(iOS中用iCloud, Android中用Google Drive 来存储).</p>
<pre><code class="cpp">void saveGameDataBinary(const std::string&amp; name, const void* data, int length);
</code></pre>

<p>保存二进制数据. 字符串也是看成二进制数据来存储.</p>
<h3 id="sdkboxplay_2">SdkboxPlay 事件</h3>
<p>该插件允许您捕捉事件。</p>
<ul>
<li>您的类可以继承 <code>sdkbox::SdkboxPlayListener</code> 并且覆盖（override）下列函数的实现：</li>
</ul>
<pre><code class="cpp">#include &quot;PluginSdkboxPlay/PluginSdkboxPlay.h&quot;
class MyClass : public sdkbox::SdkboxPlayListener
{
protected:
    /**
     * Call method invoked when the Plugin connection changes its status.
     * Values are as follows:
     *   + GPS_CONNECTED:       successfully connected.
     *   + GPS_DISCONNECTED:    successfully disconnected.
     *   + GPS_CONNECTION_ERROR:error with google play services connection.
     */
    void onConnectionStatusChanged( int status );

    /**
     * Callback method invoked when an score has been successfully submitted to a leaderboard.
     * It notifies back with the leaderboard_name (not id, see the sdkbox_config.json file) and the
     * subbmited score, as well as whether the score is the daily, weekly, or all time best score.
     * Since Game center can't determine if submitted score is maximum, it will send the max score flags as false.
     */
    void onScoreSubmitted( const std::string&amp; leaderboard_name, int score, bool maxScoreAllTime, bool maxScoreWeek, bool maxScoreToday );

    /**
     * Callback method invoked when the request call to increment an achievement is succeessful and
     * that achievement gets unlocked. This happens when the incremental step count reaches its maximum value.
     * Maximum step count for an incremental achievement is defined in the google play developer console.
     */
    void onIncrementalAchievementUnlocked( const std::string&amp; achievement_name );

    /**
     * Callback method invoked when the request call to increment an achievement is successful.
     * If possible (Google play only) it notifies back with the current achievement step count.
     */
    void onIncrementalAchievementStep( const std::string&amp; achievement_name, int step );

    /**
     * Call method invoked when the request call to unlock a non-incremental achievement is successful.
     * If this is the first time the achievement is unlocked, newUnlocked will be true.
     */
    void onAchievementUnlocked( const std::string&amp; achievement_name, bool newlyUnlocked );
};
</code></pre>

<ul>
<li>创建一个 <strong>listener</strong> 处理回调：</li>
</ul>
<pre><code class="cpp">sdkbox::PluginSdkboxPlay::setListener( new MyClass() );
</code></pre>

<h2 id="api-reference">API Reference</h2>
<h3 id="methods">Methods</h3>
<pre><code class="cpp">static bool init ( ) ;
</code></pre>

<blockquote>
<p>Initialize the plugin instance.
The plugin initializes from the sdkbox_config.json file, and reads a configuration of the form:
{
    "leaderboards"     : LeaderboardObject[],
    "achievements"     : AchievementObject[],
    "connect_on_start" : boolean,
    "debug"            : boolean,
    "enabled"          : boolean
}</p>
</blockquote>
<pre>
debug:
   is a common value to all plugins which enables debug info to be sent to the console. Useful when developing.
enabled:
   is a common value to all plugins, which enables or disables the plugin. If enabled is false, the plugin methods will do nothing.
connect_on_start:
   tells the plugin to make an automatic connection to Google Play Services on application startup.
leaderboards:
   a collection of objects of the form:
   {
       "id"   : // google play's assigned leaderboard id
       "name" : // human readable leaderboard name. You'll request leaderboard actions with this name.
   }
achievements:
   a collection of objects of the form:
   {
       "id"          : // google play's assigned achievement id.
       "name"        : // human readable achievement name. You'll request achievement actions with this name.
       "incremental" : // boolean
   }
</pre>

<pre><code class="cpp">static void setListener ( SdkboxPlayListener * listener ) ;
</code></pre>

<blockquote>
<p>Set SdkboxPlay plugin listener.</p>
</blockquote>
<pre><code class="cpp">static SdkboxPlayListener * getListener ( ) ;
</code></pre>

<blockquote>
<p>Get the plugin's listener.</p>
</blockquote>
<pre><code class="cpp">static void removeListener ( ) ;
</code></pre>

<blockquote>
<p>Remove the listener.
This plugin allows only for one listener which will be disabled after calling this method.</p>
</blockquote>
<pre><code class="cpp">static std::string getVersion ( ) ;
</code></pre>

<blockquote>
<p>Use this to get the version of the SDK.
@return The version of the SDK.</p>
</blockquote>
<pre><code class="cpp">static void submitScore ( const std::string &amp; leaderboard_name , long score ) ;
</code></pre>

<blockquote>
<p>Request submission of an score value to a leaderboard name defined in sdkbox_config.json file.
If the leaderboard name does not exists, or the id associated is not defined in the Developer Console for the application,
the call will silently fail.
If everything's right, it will notify the method <code>onScoreSubmitted</code>.</p>
</blockquote>
<pre><code class="cpp">static void showAllLeaderboards ( ) ;
</code></pre>

<blockquote>
<p>Request to show all leaderboards.</p>
</blockquote>
<pre><code class="cpp">static void showLeaderboard ( const std::string &amp; leaderboard_name = &quot;&quot; ) ;
</code></pre>

<blockquote>
<p>Request to show the default Leaderboard view.
In this view you'll be able to interactively select between daily, weekly or all-time leaderboard time frames and the scope
to global or you google play's friends results.</p>
</blockquote>
<pre>
Android only:
 if empty string or __ALL__ is used as leaderboard_name, sdkbox play will invoke an activity
 with all game-defined leader boards.
</pre>

<pre><code class="cpp">static void getMyScore ( const std::string &amp; leaderboard_name ,
                         int time_span ,
                         int collection_type ) ;
</code></pre>

<blockquote>
<p>Get The signed-in user score for an specified leaderboard.
This method notifies its result in a call to SdkboxPlay's listener <code>onMyScore</code> method.
<code>time_span</code> offers the abbility to filter leaderboard for one of the three time spans each
leaderboard offers. Values are:
 + 0 : daily time span
 + 1 : weekly time span
 + any other value : all time time span.
<code>collection_type</code> is to filter the leaderboard between social or global scopes.
Values are:
 + 1 : social collection type
 + any other value : global collection type</p>
</blockquote>
<pre><code class="cpp">static void getPlayerCenteredScores ( const std::string &amp; leaderboard_name ,
                                      int time_span ,
                                      int collection_type ,
                                      int number_of_entries ) ;
</code></pre>

<blockquote>
<p>Get leaderboard information.
This method notifies its result in a call to SdkboxPlay's listener <code>onPlayerCenteredScores</code> method.
The information supplied is a json array encoded string.
Each json element contains the following information:</p>
</blockquote>
<pre><code class="json">  {
     &quot;display_rank&quot;          : string,
     &quot;display_score&quot;         : string,
     &quot;rank&quot;                  : number,   // long
     &quot;score&quot;                 : number,   // long,
     &quot;holder_display_name&quot;   : string,
     &quot;hires_imageuri&quot;        : string,    // content:// protocol
     &quot;lowres_imageuri&quot;       : string,
     &quot;tag&quot;                   : string,
     &quot;timestamp_millis&quot;      : long
   }
</code></pre>

<p><code>time_span</code> offers the abbility to filter leaderboard for one of the three time spans each
leaderboard offers. Values are:
 + 0 : daily time span
 + 1 : weekly time span
 + any other value : all time time span.
<code>collection_type</code> is to filter the leaderboard between social or global scopes.
Values are:
 + 1 : social collection type
 + any other value : global collection type</p>
<pre><code class="cpp">static void loadAchievements ( bool force_reload ) ;
</code></pre>

<blockquote>
<p>Load achievements metadata.
A forece reload will force a cloud-side requery of the achievements information.
See <code>onAchievementsLoaded</code> for a description on the returned information.</p>
</blockquote>
<pre><code class="cpp">static void unlockAchievement ( const std::string &amp; achievement_name ) ;
</code></pre>

<blockquote>
<p>Request to unlock an achievement defined by its name.
This method assumes the achievement is non incremental.
If the achievement type is incorrectly defined in the configuration file, or the play services determines it is of the wrong type,
this method will fail silently.
Otherwise, if everything is right, the method <code>onAchievementUnlocked</code> will be invoked on the plugin listener.</p>
</blockquote>
<pre><code class="cpp">static void incrementAchievement ( const std::string &amp; achievement_name ,
                                   double increment ) ;
</code></pre>

<blockquote>
<p>Request to increment the step count of an incremental achievement by the specified number of steps.
This method assumes the achievement is incremental.
If the achievement type is incorrectly defined in the configuration file, or the play services determines it is of the wrong type,
this method will fail silently.
If the call is successful, this method may invoke two different methods:
  + <code>onIncrementalAchievementStep</code> if the achievement is not unlocked.
  + <code>onIncrementalAchievementUnlocked</code> the first time it's been newly unlocked.
On Android, the achievement is set to a fixed number of incremental steps. On iOS, the achievment is set as
a percentage value (0..100). In either case, the <code>increment</code> value will be added to the current achievement's
value.</p>
</blockquote>
<pre><code class="cpp">static void showAchievements ( ) ;
</code></pre>

<blockquote>
<p>Request to show the default Achievements view.
In this view, you'll only see public achievements.
It will show wether or not achievements are unlocked, and the steps towards unlocking it for incremental achievements.
Total experience count is measured as well.</p>
</blockquote>
<pre><code class="cpp">static void reveal ( const std::string &amp; achievement_name ) ;
</code></pre>

<blockquote>
<p>Reveal a hidden achievement.
This method will notify on plugin's listener <code>onReveal</code> or <code>onRevelError</code> methods.</p>
</blockquote>
<pre><code class="cpp">static void setSteps ( const std::string &amp; achievement_name , double steps ) ;
</code></pre>

<blockquote>
<p>Set an incremental achievement to the given amount of steps.
If achievement's current steps are already equal or bigger the specified steps, nothing will happen.
This method will  notify on plugin's listener <code>onSetSteps</code> or <code>onSetStepsError</code> methods.</p>
</blockquote>
<pre><code class="cpp">static bool isConnected ( ) ;
</code></pre>

<blockquote>
<p>Fast method to know plugin's connection status.
@deprecated</p>
</blockquote>
<pre><code class="cpp">static bool isSignedIn ( ) ;
</code></pre>

<blockquote>
<p>Same as isConnected (deprecated) but more consistent with naming.</p>
</blockquote>
<pre><code class="cpp">static void signin ( bool showLoginUI = true ) ;
</code></pre>

<blockquote>
<p>Request connection to the platform-specific services backend.
This method will invoke plugin's listener <code>onConnectionStatusChanged</code> method.</p>
</blockquote>
<pre><code class="cpp">static void signout ( ) ;
</code></pre>

<blockquote>
<p>Request disconnection from the GooglePlay/Game Center backend.
This method will invoke plugin's listener <code>onConnectionStatusChanged</code> method.</p>
</blockquote>
<pre><code class="cpp">static std::string getPlayerId ( ) ;
</code></pre>

<blockquote>
<p>Get the currently logged in player's id.</p>
</blockquote>
<pre><code class="cpp">static std::string getPlayerAccountField ( const std::string &amp; field ) ;
</code></pre>

<blockquote>
<p>Get a field from the user account's info obtained after authentication.
Current values are:
iOS/Android</p>
</blockquote>
<hr />
<ul>
<li>display_name</li>
<li>name</li>
<li>player_id
Android only:</li>
</ul>
<hr />
<ul>
<li>title</li>
<li>icon_image_uri</li>
<li>hires_image_uri</li>
<li>last_play_timestamp</li>
<li>retrieved_timestamp</li>
<li>server_auth_code
If a field not valid is queried an empty string will be returned.</li>
</ul>
<pre><code class="cpp">static void resetAchievements ( ) ;
</code></pre>

<blockquote>
<p>Calling this class method deletes all progress towards achievements
previously reported for the local player. Hidden achievements that
were previously visible are now hidden again.</p>
</blockquote>
<pre>
iOS Only
</pre>

<pre><code class="cpp">static void loadAllData ( ) ;
</code></pre>

<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>DEPRECATED &gt;&gt;&gt;&gt;&gt;&gt; Please use loadAllGameData to replace
load all saved user game data in clound
will trigger onGameData callback</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
<pre><code class="cpp">static void loadGameData ( const std::string &amp; save_name ) ;
</code></pre>

<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>DEPRECATED &gt;&gt;&gt;&gt;&gt;&gt; Please use loadAllGameData to replace
load one saved user game data in clound
will trigger onGameData callback</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
<pre><code class="cpp">static void saveGameData ( const std::string &amp; save_name ,
                           const std::string &amp; data ) ;
</code></pre>

<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>DEPRECATED &gt;&gt;&gt;&gt;&gt;&gt; Please use saveGameDataBinary(name, data, length) to replace
save user game data in cloud
will trigger onGameData callback</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
<pre><code class="cpp">static void fetchGameDataNames ( ) ;
</code></pre>

<blockquote>
<p>fetch game data names
will trigger onGameDataNames</p>
</blockquote>
<pre><code class="cpp">static void loadOneGameData ( const std::string &amp; name ) ;
</code></pre>

<blockquote>
<p>load game data item
will trigger onLoadGameData</p>
</blockquote>
<pre><code class="cpp">static void loadAllGameData ( ) ;
</code></pre>

<blockquote>
<p>load all saved game data
will trigger onLoadGameData callback</p>
</blockquote>
<pre><code class="cpp">static void saveGameDataBinary ( const std::string &amp; name ,
                                 const void * data ,
                                 int length ) ;
</code></pre>

<blockquote>
<p>save user game data
will trigger onSaveGameData callback</p>
</blockquote>
<pre>
Note: if you want to save string, please translate to void>
</pre>

<pre><code class="cpp">static void generateIdentityVerificationSignature();
</code></pre>

<blockquote>
<p>Generates a signature that allows a third party server to authenticate the local player.</p>
<p>just vaild on iOS</p>
<p><a href="https://developer.apple.com/documentation/gamekit/gklocalplayer/1515407-generateidentityverificationsign">iOS Ref Document</a></p>
<p>Note: on Android, you can get server_auth_code from getPlayerAccountField</p>
</blockquote>
<h3 id="listeners">Listeners</h3>
<pre><code class="cpp">void onConnectionStatusChanged ( int status );
</code></pre>

<blockquote>
<p>Call method invoked when the Plugin connection changes its status.
Values are as follows:
  + GPS_CONNECTED:       successfully connected.
  + GPS_DISCONNECTED:    successfully disconnected.
  + GPS_CONNECTION_ERROR:error with google play services connection.</p>
</blockquote>
<pre><code class="cpp">void onScoreSubmitted ( const std::string &amp; leaderboard_name ,
                        long score ,
                        bool maxScoreAllTime ,
                        bool maxScoreWeek ,
                        bool maxScoreToday );
</code></pre>

<blockquote>
<p>Callback method invoked when an score has been successfully submitted to a leaderboard.
It notifies back with the leaderboard_name (not id, see the sdkbox_config.json file) and the
subbmited score, as well as whether the score is the daily, weekly, or all time best score.
Since Game center can't determine if submitted score is maximum, it will send the max score flags as false.</p>
</blockquote>
<pre><code class="cpp">void onMyScore ( const std::string &amp; leaderboard_name ,
                 int time_span ,
                 int collection_type ,
                 long score ) 
</code></pre>

<blockquote>
<p>Callback method invoked from a call to <code>getMyScore</code> method.
<code>time_span</code> and <code>collection_type</code> are the supplied values to <code>getMyScore</code> method call.</p>
</blockquote>
<pre><code class="cpp">void onMyScoreError ( const std::string &amp; leaderboard_name ,
                      int time_span ,
                      int collection_type ,
                      int error_code ,
                      const std::string &amp; error_description ) 
</code></pre>

<blockquote>
<p>Callback method invoked from a call to <code>getMyScore</code> method and the method was errored.
<code>time_span</code> and <code>collection_type</code> are the supplied values to <code>getMyScore</code> method call.
<code>error_code</code> and <code>error_description</code> give extended info about the error.</p>
</blockquote>
<pre><code class="cpp">void onPlayerCenteredScores ( const std::string &amp; leaderboard_name ,
                              int time_span ,
                              int collection_type ,
                              const std::string &amp; json_with_score_entries ) 
</code></pre>

<blockquote>
<p>Callback method invoked from a call to <code>getPlayerCenteredScores</code> method.
<code>json_with_score_entries</code> is an json array enconded string, each of which elements is of the form:
Each json element contains the following information:</p>
</blockquote>
<pre><code class="json">  {
     &quot;display_rank&quot;          : string,
     &quot;display_score&quot;         : string,
     &quot;rank&quot;                  : number,   // long
     &quot;score&quot;                 : number,   // long,
     &quot;holder_display_name&quot;   : string,
     &quot;hires_imageuri&quot;        : string,    // content:// protocol
     &quot;lowres_imageuri&quot;       : string,
     &quot;tag&quot;                   : string,
     &quot;timestamp_millis&quot;      : long
   }
</code></pre>

<p><code>time_span</code> and <code>collection_type</code> are the values supplied to <code>getPlayerCenteredScores</code> method.</p>
<pre><code class="cpp">void onPlayerCenteredScoresError ( const std::string &amp; leaderboard_name ,
                                   int time_span ,
                                   int collection_type ,
                                   int error_code ,
                                   const std::string &amp; error_description ) 
</code></pre>

<blockquote>
<p>Callback method invoked from a call to <code>getPlayerCenteredScores</code> method was errored.
<code>time_span</code> and <code>collection_type</code> are the values supplied to <code>getPlayerCenteredScores</code> method.
<code>error_code</code> and <code>error_description</code> give extended info about the error.</p>
</blockquote>
<pre><code class="cpp">void onIncrementalAchievementUnlocked ( const std::string &amp; achievement_name );
</code></pre>

<blockquote>
<p>Callback method invoked when the request call to increment an achievement is succeessful and
that achievement gets unlocked. This happens when the incremental step count reaches its maximum value.
Maximum step count for an incremental achievement is defined in the google play developer console.</p>
</blockquote>
<pre><code class="cpp">void onIncrementalAchievementStep ( const std::string &amp; achievement_name ,
                                    double step );
</code></pre>

<blockquote>
<p>Callback method invoked when the request call to increment an achievement is successful.
If possible (Google play only) it notifies back with the current achievement step count.</p>
</blockquote>
<pre><code class="cpp">void onIncrementalAchievementStepError ( const std::string &amp; name ,
                                         double steps ,
                                         int error_code ,
                                         const std::string &amp; error_description ) 
</code></pre>

<pre><code class="cpp">void onAchievementUnlocked ( const std::string &amp; achievement_name ,
                             bool newlyUnlocked );
</code></pre>

<blockquote>
<p>Call method invoked when the request call to unlock a non-incremental achievement is successful.
If this is the first time the achievement is unlocked, newUnlocked will be true.</p>
</blockquote>
<pre><code class="cpp">void onAchievementUnlockError ( const std::string &amp; achievement_name ,
                                int error_code ,
                                const std::string &amp; error_description ) 
</code></pre>

<pre><code class="cpp">void onAchievementsLoaded ( bool reload_forced ,
                            const std::string &amp; json_achievements_info ) 
</code></pre>

<blockquote>
<p>Method invoked after calling plugin's <code>loadAchievements</code> method.
The <code>json_achievements_info</code> parameter is a json array encoded string.</p>
</blockquote>
<h4 id="android-fields">Android fields:</h4>
<p>each array element is of the form:</p>
<pre><code class="json">  {
     &quot;id&quot;                        : string,
     &quot;name&quot;                      : string,
     &quot;xp_value&quot;                  : string,   // experience value
     &quot;last_updated_timestamp&quot;    : number,
     &quot;description&quot;               : string,
     &quot;type&quot;                      : number,   // 0 = standard, 1 = incremental
     &quot;state&quot;                     : number,   // 0 = unlocked, 1 = revealed,   2 = hidden
     &quot;unlocked_image_uri&quot;        : string,   // content:// protocol
     &quot;revealed_image_uri&quot;        : string,   // content:// protocol
  }
</code></pre>

<p>If the achievement is incremental, these fileds will also be available:</p>
<pre><code class="json">  {
     &quot;formatted_current_steps&quot;   : string,
     &quot;formatted_total_steps&quot;     : string,
     current_steps&quot;              : number,
     &quot;total_steps&quot;               : number
  }
</code></pre>

<h4 id="ios-fields">IOS fields:</h4>
<pre><code class="json">  {
     &quot;id&quot;                        : string,
     &quot;name&quot;                      : string,
     &quot;xp_value&quot;                  : number, int
     &quot;last_updated_timestamp&quot;    : number,
     &quot;description&quot;               : string,   // maybe empty if no achievemnt submission happened before.
     &quot;state&quot;                     : number,   // 0 = unlocked, 1 = revealed,   2 = hidden
     &quot;type&quot;                      : 1,        // on ios all achievemtns are incremental.
     &quot;current_steps&quot;             : number,   // double value. percentage 0.0 .. 100.0
     &quot;total_steps&quot;               : number,   // 100.0
  }
 ```
 iOS only fields:
```json
  {
     &quot;replayable&quot;                : boolean,
  }
</code></pre>

<pre><code class="cpp">void onSetSteps ( const std::string &amp; name , double steps ) 
</code></pre>

<pre><code class="cpp">void onSetStepsError ( const std::string &amp; name ,
                       double steps ,
                       int error_code ,
                       const std::string &amp; error_description ) 
</code></pre>

<pre><code class="cpp">void onReveal ( const std::string &amp; name ) 
</code></pre>

<pre><code class="cpp">void onRevealError ( const std::string &amp; name ,
                     int error_code ,
                     const std::string &amp; error_description ) 
</code></pre>

<pre><code class="cpp">void onGameData ( const std::string &amp; action ,
                  const std::string &amp; name ,
                  const std::string &amp; data ,
                  const std::string &amp; error ) 
</code></pre>

<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>DEPRECATED &gt;&gt;&gt;&gt;&gt;&gt;</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
<pre><code class="cpp">void onSaveGameData ( bool success , const std::string &amp; error ) 
</code></pre>

<blockquote></blockquote>
<pre><code class="cpp">void onLoadGameData ( const SavedGameData * savedData ,
                      const std::string &amp; error ) 
</code></pre>

<blockquote></blockquote>
<pre><code class="cpp">void onGameDataNames ( const std::vector &lt;std::string&gt; &amp; names ,
                       const std::string &amp; error ) 
</code></pre>

<blockquote></blockquote>
<h2 id="_6">手动集成</h2>
<p>如果 <em>SDKBOX 安装器</em> 安装插件失败了，那么需要手动集成插件.如果安装器安装插件成功了,那么不需要，也没必要,按文档再手动集成一次.</p>
<p>下面列出的的步骤一般很少用到.如果你按下面的步骤完成了集成，请在完成集成后，再按步骤检查一次.</p>
<h2 id="ios">iOS 平台手动集成</h2>
<p>拖拽下列 framework 从 <code>SdkboxPlay</code> 插件包的 <strong>plugins/ios</strong> 目录到您的 Xcode 工程中，在添加 frameworks 的时候，请勾选 <code>Copy items if needed</code> 。</p>
<blockquote>
<p>sdkbox.framework</p>
<p>PluginSdkboxPlay.framework</p>
</blockquote>
<p>如果您没有添加下面这些系统库，您有需要添加它们：</p>
<blockquote>
<p>GameKit.framework</p>
<p>UIKit.framework</p>
</blockquote>
<h2 id="android">Android 手动集成</h2>
<p>SDKBox 支持三种 <strong>Android</strong> 工程, <strong>command-line</strong>, <strong>eclipse</strong> 和 <strong>Android Studio</strong>.</p>
<ul>
<li><strong>command-line</strong> 和 <strong>eclipse</strong> 类型的项目, <code>&lt;project_root&gt;</code> 指代 <code>proj.android</code> .</li>
<li><strong>Android Studio</strong> 类型的项目, <code>&lt;project_root&gt;</code> 指代 <code>proj.android-studio</code> .</li>
</ul>
<h3 id="_7">拷贝文件</h3>
<p>从插件安装包中的 <code>plugin/android/libs</code> 目录拷贝下列 <strong>jar</strong> 文件到您的工程的 <strong>proj.android/libs</strong> 目录。</p>
<blockquote>
<p>PluginSdkboxPlay.jar</p>
<p>sdkbox.jar</p>
</blockquote>
<ul>
<li>
<p>如果你使用 cocos2d-x 源码，拷贝 <strong>jar</strong> 文件到：</p>
<p>Android command-line:
<code>cocos2d/cocos/platform/android/java/libs</code></p>
<p>Android Studio:
<code>cocos2d/cocos/platform/android/libcocos2dx/libs</code></p>
</li>
<li>
<p>如果你使用 cocos2d-js 或者 lua ，拷贝 <strong>jar</strong> 文件到:</p>
<p>Android command-line:
<code>frameworks/cocos2d-x/cocos/platform/android/java/libs</code></p>
<p>Android Studio:
<code>frameworks/cocos2d-x/cocos/platform/android/libcocos2dx/libs</code></p>
</li>
<li>
<p>如果你使用 cocos2d-x 预编译包，拷贝 <strong>jar</strong> 文件到：</p>
<p>Android command-line:
<code>proj.android/libs</code></p>
</li>
</ul>
<p>从 <code>plugin/android/libs</code> 目录下拷贝 <code>sdkboxads_lib</code> 目录到您的 <code>proj.android/libs/</code> 目录下。</p>
<h4 id="jni">拷贝 jni 库</h4>
<p>从 <code>plugin/android/jni/</code> 拷贝并覆盖 <code>&lt;your_project_root&gt;/jni/</code> 目录.</p>
<h3 id="androidmanifestxml">编辑 <code>AndroidManifest.xml</code></h3>
<p>在标签 <strong>application tag</strong> 上添加下列权限：</p>
<pre><code class="xml">&lt;uses-permission android:name=&quot;android.permission.GET_ACCOUNTS&quot; /&gt;
</code></pre>

<p>设置 <strong>application tag</strong> 下的 <strong>hardware acceleration</strong> 为真。这一选项在新版本的 sdk 上可以生效，但不适用于 2.3.3的 cocos2d-x 版本。</p>
<pre><code class="xml">&lt;android:hardwareAccelerated=&quot;true&quot; /&gt;
</code></pre>

<h3 id="androidmk">编辑 <code>Android.mk</code></h3>
<p>Edit <code>proj.android/jni/Android.mk</code> to:</p>
<p>为 <strong>LOCAL_WHOLE_STATIC_LIBRARIES</strong> 添加额外的库：</p>
<pre><code>LOCAL_WHOLE_STATIC_LIBRARIES += android_native_app_glue
LOCAL_LDLIBS += -landroid
LOCAL_LDLIBS += -llog
LOCAL_WHOLE_STATIC_LIBRARIES += PluginSdkboxPlay
LOCAL_WHOLE_STATIC_LIBRARIES += sdkbox
</code></pre>

<p>在所有 <strong>import-module</strong> 语句之前添加一条 call 语句：</p>
<pre><code>$(call import-add-path,$(LOCAL_PATH))
</code></pre>

<p>在最后添加额外的 <strong>import-module</strong> 语句：</p>
<pre><code>$(call import-module, ./sdkbox)
$(call import-module, ./pluginsdkboxplay)
</code></pre>

<p>Add additional <strong>import-module</strong> statements at the end:</p>
<pre><code>$(call import-add-path,$(LOCAL_PATH))
$(call import-module, ./sdkbox)
$(call import-module, ./pluginsdkboxplay)
</code></pre>

<h3 id="applicationmk">编辑 <code>Application.mk</code></h3>
<p>编辑 <code>proj.android/jni/Application.mk</code>：</p>
<p>为 <strong>APP_PATFORM</strong> 添加版本：</p>
<pre><code>APP_PLATFORM := android-10
</code></pre>

<h3 id="appactivityjava">修改 <code>AppActivity.java</code></h3>
<h4 id="2403">插件版本 &gt;= 2.4.0.3</h4>
<ol>
<li>找到 <strong>AppActivity.java</strong> 文件</li>
</ol>
<pre><code class="bash">find . -name &quot;AppActivity.java&quot;
</code></pre>

<ol>
<li>把 <code>extends Cocos2dxActivity</code> 替换为 <code>extends com.sdkbox.plugin.SDKBoxActivity</code></li>
</ol>
<p>以下是 <strong>AppActivity.java</strong> 不同版本的引擎所在的目录：</p>
<pre><code>cpp
  - proj.android/src/org/cocos2dx/cpp/AppActivity.java
  - proj.android-studio/app/src/org/cocos2dx/cpp/AppActivity.java
  - proj.android/app/src/org/cocos2dx/cpp/AppActivity.java ( from cocos2d-x 3.17)

lua
  - frameworks/runtime-src/proj.android/src/org/cocos2dx/lua/AppActivity.java
  - frameworks/runtime-src/proj.android-studio/app/src/org/cocos2dx/lua/AppActivity.java
  - frameworks/runtime-src/proj.android/app/src/org/cocos2dx/lua/AppActivity.java (from cocos2d-x 3.17)

js
  - frameworks/runtime-src/proj.android/src/org/cocos2dx/javascript/AppActivity.java
  - frameworks/runtime-src/proj.android/app/src/org/cocos2dx/javascript/AppActivity.java ( from cocos2d-x 3.17)
</code></pre>

<h4 id="2403_1">插件版本 &lt; 2.4.0.3</h4>
<ul>
<li>
<p>如果您使用 cocos2d-x 源代码，假设您在 <code>proj.android</code> 目录下，那么您可以在如下位置找到 <code>Cocos2dxActivity.java</code> 文件：</p>
<p><code>../../cocos2d-x/cocos/platform/android/java/src/org/cocos2dx/
lib/Cocos2dxActivity.java</code></p>
</li>
<li>
<p>如果您使用 cocos2dx-x 预编译库， 假设您在 <code>proj.android</code> 目录下，那么您可以在如下位置找到 <code>Cocos2dxActivity.java</code> 文件：</p>
<p><code>./src/org/cocos2dx/lib/Cocos2dxActivity.java</code></p>
</li>
</ul>
<p><strong>Note:</strong> 当你使用 cocos2d-x 源代码时，不同的版本中 <code>Cocos2dxActivity.java</code> 文件的位置也不同。一个确定该文件位置的方法是查看 <code>proj.android/project.properties</code> 。比如：</p>
<pre><code>android.library.reference.1=../../cocos2d-x/cocos/platform/android/java
</code></pre>

<p>在这个例子中， <code>Cocos2dxActivity.java</code> 文件应该在如下位置：</p>
<pre><code>../../cocos2d-x/cocos/platform/android/java/src/org/cocos2dx/lib/Cocos2dxActivity.java
</code></pre>

<ul>
<li>修改 <code>Cocos2dxActivity.java</code> 文件，导入如下包：</li>
</ul>
<pre><code class="java">import android.content.Intent;
import com.sdkbox.plugin.SDKBox;
</code></pre>

<ul>
<li>然后，修改 <code>Cocos2dxActivity</code> 类的 <code>onCreate(final Bundle savedInstanceState)</code> 函数，添加一个调用语句 <code>SDKBox.init(this);</code> 。添加的位置非常重要，必须在调用 <code>onLoadNativeLibraries();</code> 之后。如下：</li>
</ul>
<pre><code class="java">onLoadNativeLibraries();
SDKBox.init(this);
</code></pre>

<ul>
<li>
<p>最后, 我需要提供合适的 <strong>overrides</strong> 方法的代码。这里有一些约定如下。</p>
<ul>
<li>
<p>如果这个被列出的方法没有在 <code>SDKBox</code> 中定义，那么__定义它__。</p>
</li>
<li>
<p>如果这个被列出的方法已经被定义在 <code>SDKBox</code> 中，那么请调用这个在 <code>SDKBox</code> 中的__同名方法__。</p>
</li>
</ul>
</li>
</ul>
<pre><code class="java">    @Override
    protected void onActivityResult(int requestCode, int resultCode, Intent data) {
          if(!SDKBox.onActivityResult(requestCode, resultCode, data)) {
            super.onActivityResult(requestCode, resultCode, data);
          }
    }
    @Override
    protected void onStart() {
          super.onStart();
          SDKBox.onStart();
    }
    @Override
    protected void onStop() {
          super.onStop();
          SDKBox.onStop();
    }
    @Override
    protected void onResume() {
          super.onResume();
          SDKBox.onResume();
    }
    @Override
    protected void onPause() {
          super.onPause();
          SDKBox.onPause();
    }
    @Override
    public void onBackPressed() {
          if(!SDKBox.onBackPressed()) {
            super.onBackPressed();
          }
    }
</code></pre>

<h2 id="proguard-release">使用 Proguard （release模式下可选）</h2>
<ul>
<li>编辑 <code>project.properties</code> 文件， 指定一个 <code>Proguard</code> 配置文件。比如：</li>
</ul>
<pre><code>proguard.config=${sdk.dir}/tools/proguard/proguard-android.txt:proguard-project.txt
</code></pre>

<p>只要有需要，您可以使用任何 Google Play 的混淆配置文件。
默认的混淆配置如下：</p>
<pre><code>-keep class * extends java.util.ListResourceBundle {
    protected Object[][] getContents();
}

-keep public class com.google.android.gms.common.internal.safeparcel.SafeParcelable {
    public static final *** NULL;
}

-keepnames @com.google.android.gms.common.annotation.KeepName class *
-keepclassmembernames class * {
    @com.google.android.gms.common.annotation.KeepName *;
}

-keepnames class * implements android.os.Parcelable {
    public static final ** CREATOR;
}
</code></pre>

<p><strong>Note:</strong> Proguard 只能工作在 <strong>Release</strong> 模式下 （比如： <code>cocos run -m release</code>） debug 模式下不会触发 Proguard 。</p>
<h2 id="_8">游戏存档</h2>
<p>SDKBoxPlay 支持 iOS/Google的游戏云存档功能. 开发者可以使用此接口存储用户的游戏数据.</p>
<h3 id="ios_1">iOS 云存储</h3>
<ul>
<li>玩家自己的 iCloud 帐号必须是开启状态</li>
<li>开发者在对应的工程的必须把 iCloud <a href="https://developer.apple.com/library/content/documentation/DataManagement/Conceptual/CloudKitQuickStart/EnablingiCloudandConfiguringCloudKit/EnablingiCloudandConfiguringCloudKit.html#//apple_ref/doc/uid/TP40014987-CH2-SW2">打开</a></li>
</ul>
<h3 id="_9">用法</h3>
<h4 id="_10">加载所有的游戏数据</h4>
<pre><code class="cpp">sdkbox::PluginSdkboxPlay::loadAllData();
</code></pre>

<h4 id="_11">加载某一项游戏数据</h4>
<pre><code class="cpp">sdkbox::PluginSdkboxPlay::loadGameData(&quot;key2&quot;);
</code></pre>

<h4 id="_12">保持数据</h4>
<pre><code class="cpp">sdkbox::PluginSdkboxPlay::saveGameData(&quot;key1&quot;, &quot;{\&quot;game_name\&quot;: \&quot;sdkbox go\&quot;, \&quot;stage\&quot;: 3}&quot;);
</code></pre>

<p>iOS 存档<a href="https://developer.apple.com/library/content/documentation/NetworkingInternet/Conceptual/GameKit_Guide/SavedGames/SavedGames.html">官方文档</a></p>
<p>Android 存档<a href="https://developers.google.com/games/services/common/concepts/savedgames">官方文档</a></p>
<h2 id="_13">服务器认证</h2>
<p>如果需要用开发者自己的服务器来作认证，可以按下面的步骤</p>
<h3 id="ios_2">iOS</h3>
<ol>
<li>实现 <code>SdkboxPlayListener</code> 中的 <code>onGenerateIdentityVerificationSignature</code></li>
<li>调用 <code>sdkbox::PluginSdkboxPlay::generateIdentityVerificationSignature();</code></li>
</ol>
<h3 id="android_1">Android</h3>
<ul>
<li>在 <code>sdkbox_config.json</code> 中添加 <code>web_client_id</code></li>
</ul>
<pre><code class="json">    &quot;sdkboxplay&quot; : {
        &quot;web_client_id&quot;: &quot;.......&quot;
    }
</code></pre>

<p>web_client_id的生成可以参见这个<a href="https://developers.google.com/identity/protocols/OAuth2WebServer">文档</a></p>
<ul>
<li>登录</li>
<li>调用 <code>sdkbox::PluginSdkboxPlay::getPlayerAccountField("server_auth_code")</code> 以获取 google server auth code</li>
</ul></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Build Date UTC : 2021-09-10 06:47:50, Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        
        <script src="../../../js/jquery-1.10.2.min.js"></script>
        <script src="../../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../../js/highlight.pack.js"></script>
        <script>var base_url = '../../..';</script>
        <script src="../../../js/base.js"></script>
        


        
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-70044300-2', 'auto');
            ga('send', 'pageview');
        </script>
        
    </body>
</html>
